import{j as t,u as d,a1 as _,ap as H,T as y,Z as b,W as O}from"./index-S--WvUSo.js";import{J as $}from"./json-view-section-Dui2O31i.js";import{c as A,a as L,t as k}from"./tax-regions-jathV60U.js";import{r as h}from"./react-PzSkSLoa.js";import{L as I,c as B,O as E}from"./react-router-dom-aSYyayiN.js";import{A as F}from"./action-menu-olZwXQ3q.js";import{u as Q,a as J,D as K}from"./use-data-table-TeZp00wg.js";import{b as G,c as W}from"./tax-rates-TgwHqykr.js";import{T as p,a as x}from"./text-cell-OtkuJsO8.js";import{B as Z}from"./badge-99FyByJO.js";import{c as w}from"./index-JDlOzmVl.js";import{P as V}from"./pencil-square-u3fizEAQ.js";import{T as Y}from"./trash-nTjeUaCp.js";import{u as U}from"./use-prompt-wB0F2CxI.js";import{H as R}from"./heading-cSlef4Su.js";import{B as X}from"./button-Pc5Xo8ua.js";import{f as ee}from"./format-vrL-wy9v.js";import{g as te}from"./countries-QR_y0WJ_.js";import"./react-dom-Og6--24v.js";import"./drawer-H3TI1lDZ.js";import"./index-sF0hA49A.js";import"./x-mark-mini-aYDSd38M.js";import"./empty-table-content-i72rBIA2.js";import"./plus-mini-IRJECoWI.js";import"./index-1Zwdg31z.js";import"./use-date-Putn0_Ur.js";import"./date-picker-s8-9mila.js";import"./input-A29ux7yj.js";import"./minus-E5-czcFC.js";import"./index-7dV3TD85.js";import"./index-Hm2Uj9Gg.js";import"./lodash-5s15_I2H.js";import"./label-HFq5fzpT.js";import"./command-bar-wUgfUfvQ.js";import"./placeholder-cell-O6UVTGmQ.js";import"./prompt-LzbVPZYR.js";const ae=({is_combinable:e})=>t.jsx("div",{className:"flex h-full w-full items-center gap-x-3 overflow-hidden",children:t.jsx("span",{className:"truncate",children:e?t.jsx(Z,{size:"2xsmall",color:"green",children:"Combinable"}):""})}),se=({text:e})=>t.jsx("div",{className:" flex h-full w-full items-center",children:t.jsx("span",{children:e})}),l=w(),re=()=>{const{t:e}=d();return h.useMemo(()=>[l.display({id:"name",header:()=>t.jsx(p,{text:e("fields.name")}),cell:({row:a})=>t.jsx(x,{text:a.original.name})}),l.display({id:"province",header:()=>t.jsx(p,{text:e("fields.province")}),cell:({row:a})=>t.jsx(x,{text:a.original.tax_region.province_code})}),l.display({id:"rate",header:()=>t.jsx(p,{text:e("fields.rate")}),cell:({row:a})=>t.jsx(x,{text:`${a.original.rate} %`})}),l.display({id:"is_combinable",header:()=>t.jsx(se,{text:e("fields.type")}),cell:({row:a})=>t.jsx(ae,{is_combinable:a.original.is_combinable})}),l.display({id:"code",header:()=>t.jsx(p,{text:e("fields.code")}),cell:({row:a})=>t.jsx(x,{text:a.original.code||"-"})})],[])},ie=()=>{const{t:e}=d();return[...[{label:e("fields.createdAt"),key:"created_at"},{label:e("fields.updatedAt"),key:"updated_at"}].map(r=>({key:r.key,label:r.label,type:"date"}))]},oe=({prefix:e,pageSize:a=20})=>{const s=Q(["offset","q","order","created_at","updated_at"],e),{offset:r,q:i,order:o,created_at:m,updated_at:u}=s;return{searchParams:{limit:a,offset:r?Number(r):0,order:o,created_at:m?JSON.parse(m):void 0,updated_at:u?JSON.parse(u):void 0,q:i},raw:s}},g=10,v=({taxRegion:e,isDefault:a=!1})=>{var T;const[s,r]=h.useState({}),{searchParams:i,raw:o}=oe({pageSize:g}),m=((T=e.children)==null?void 0:T.map(c=>c.id))||[],{tax_rates:u,count:f,isLoading:D,isError:M,error:S}=G({...i,tax_region_id:[e.id,...m],is_default:a},{placeholderData:H}),j=ce(),N=ie(),{table:C}=J({data:u??[],columns:j,count:f,enablePagination:!0,enableRowSelection:!0,pageSize:g,getRowId:c=>c.id,rowSelection:{state:s,updater:r},meta:{taxRegionId:e.id}}),{mutateAsync:P}=A(e.id),q=U(),{t:n}=d(),z=async()=>{await q({title:n("general.areYouSure"),description:n("taxRegions.removeWarning",{tax_region_name:e.name}),confirmText:n("actions.delete"),cancelText:n("actions.cancel")})&&await P(void 0,{onSuccess:()=>{r({})}})};if(M)throw S;return t.jsxs(_,{className:"divide-y p-0",children:[t.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[t.jsx(R,{level:"h2",children:a?`Default ${n("taxRates.domain")}`:"Tax Rate Overrides"}),t.jsx(I,{to:a?`/settings/taxes/${e.id}/create-default`:`/settings/taxes/${e.id}/create-override`,children:t.jsx(X,{size:"small",variant:"secondary",children:"Create"})})]}),t.jsx(K,{table:C,columns:j,pageSize:g,commands:[{action:z,label:n("actions.remove"),shortcut:"r"}],count:f,pagination:!0,search:!0,filters:N,navigateTo:c=>`/settings/taxes/${e.id}/tax-rates/${c.id}/edit`,isLoading:D,orderBy:["is_default","rate","created_at","updated_at"],queryObject:o})]})},ne=w(),ce=()=>{const e=re();return h.useMemo(()=>[...e,ne.display({id:"actions",cell:({row:a,table:s})=>{const{taxRegionId:r}=s.options.meta;return t.jsx(le,{taxRateId:a.original.id,taxRegionId:r})}})],[e])},le=({taxRateId:e,taxRegionId:a})=>{const{t:s}=d(),{mutateAsync:r}=W(e),i=async()=>await r();return t.jsx(F,{groups:[{actions:[{icon:t.jsx(V,{}),label:s("actions.edit"),to:`/settings/taxes/${a}/tax-rates/${e}/edit`}]},{actions:[{icon:t.jsx(Y,{}),label:s("actions.remove"),onClick:i}]}]})};function de(e){const a=new Date(e);a.setMinutes(a.getMinutes()-a.getTimezoneOffset());const r=Intl.DateTimeFormat().resolvedOptions().hour12?"dd MMM yyyy hh:MM a":"dd MMM yyyy HH:MM";return ee(a,r)}const me=({taxRegion:e})=>{var i,o;const{t:a}=d(),s=((i=e.parent)==null?void 0:i.country_code)||e.country_code,r=((o=te(s))==null?void 0:o.display_name)||s;return t.jsxs(_,{className:"divide-y p-0",children:[t.jsx("div",{className:"flex items-center justify-between px-6 py-4",children:t.jsxs("div",{children:[t.jsx(R,{children:r}),t.jsx(y,{className:"text-ui-fg-subtle",size:"small",children:a("taxRegions.description")})]})}),t.jsxs("div",{className:"grid grid-cols-2 items-center px-6 py-4",children:[t.jsx(y,{size:"small",leading:"compact",weight:"plus",children:a("fields.created")}),t.jsx(y,{size:"small",leading:"compact",children:de(e.created_at)})]})]})},Ze=()=>{const{id:e}=B(),{tax_region:a,isLoading:s,isError:r,error:i}=L(e);if(s)return t.jsx("div",{children:"Loading..."});if(r)throw i;return a&&t.jsxs("div",{className:"flex flex-col gap-y-2",children:[t.jsx(me,{taxRegion:a}),t.jsx(v,{taxRegion:a,isDefault:!0}),t.jsx(v,{taxRegion:a,isDefault:!1}),t.jsx($,{data:a,root:"tax_region"}),t.jsx(E,{})]})},ue=e=>({queryKey:k.detail(e),queryFn:async()=>O.taxes.retrieveTaxRegion(e)}),Ve=async({params:e})=>{const a=e.id,s=ue(a);return b.getQueryData(s.queryKey)??await b.fetchQuery(s)};export{Ze as Component,Ze as TaxRegionDetail,Ve as loader};
