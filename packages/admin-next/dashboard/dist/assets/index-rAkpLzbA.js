import{a as E,u as C,ax as L,ay as P,Z as R,az as F,j as e,T as w,l as A}from"./index-S--WvUSo.js";import{c as I,b as M}from"./react-router-dom-aSYyayiN.js";import{u as O,R as u}from"./route-focus-modal-MMx5Xnk0.js";import{r as T}from"./react-PzSkSLoa.js";import{u as z,F as r}from"./form-0PHaH8g8.js";import{t as D}from"./zod-jt04JUtm.js";import{z as m}from"./index-JzuMwgWW.js";import{c as H}from"./cast-number-oeIUIgsb.js";import{g as V}from"./currencies-bd3ADI6s.js";import{b as B,a as k}from"./money-amount-helpers--myf8Rla.js";import{C as q}from"./currency-input-k1bgGOuE.js";import{S as f}from"./select-Z4sV_-wF.js";import{T as Q}from"./textarea-D4fuXHvE.js";import{S as Z}from"./switch-VR1xZXYU.js";import{A as $}from"./alert-dyv3SYtc.js";import{B as b}from"./button-Pc5Xo8ua.js";import{o as G}from"./constants-_5zevAUU.js";import{H as J}from"./heading-cSlef4Su.js";import"./react-dom-Og6--24v.js";import"./drawer-H3TI1lDZ.js";import"./index-sF0hA49A.js";import"./prompt-LzbVPZYR.js";import"./information-circle-solid-rXH6vJ5W.js";import"./label-HFq5fzpT.js";import"./tooltip-Ixyw9oT8.js";import"./index-Hm2Uj9Gg.js";import"./triangles-mini-HukRlWGp.js";import"./input-A29ux7yj.js";import"./x-mark-mini-aYDSd38M.js";import"./x-circle-solid-rnqhxvfk.js";import"./check-circle-solid-7j4QonPK.js";var v=(n=>(n.Discount="discount",n.Other="other",n))(v||{});const K=m.object({amount:m.union([m.number(),m.string()]),reason:m.nativeEnum(v,{errorMap:()=>({message:E.t("orders.refund.error.reasonRequired")})}),note:m.string().optional(),notification_enabled:m.boolean().optional()}),U=[{label:"Discount",value:"discount"},{label:"Other",value:"other"}];function W({order:n,payment:l}){const{t:o}=C(),{handleSuccess:x}=O(),a=!!l,p=T.useMemo(()=>n.paid_total-n.refunded_total,[n]),s=z({defaultValues:{amount:a?B(l.amount,n.currency_code):"",note:"",reason:"",notification_enabled:!n.no_notification},resolver:D(K)});let{mutateAsync:h,isLoading:j}=L(n.id),{mutateAsync:g,isLoading:y}=P(l==null?void 0:l.id);const N=s.handleSubmit(async t=>{if(t.amount===""||t.amount===void 0){s.setError("amount",{type:"manual",message:o("Please enter an amount for refund")});return}const i=H(t.amount),d=k(i,n.currency_code);if(d>p){s.setError("amount",{type:"manual",message:o("orders.refund.error.amountToLarge")});return}if(i<0){s.setError("amount",{type:"manual",message:o("orders.refund.error.amountNegative")});return}const c={amount:d,note:t.note,reason:t.reason,no_notification:!t.notification_enabled},S=a?g:h;a&&delete c.no_notification,await S(c),a&&await R.invalidateQueries(F.detail(n.id)),x()}),_=n.payments.some(t=>t.provider_id==="system");return e.jsx(u.Form,{form:s,children:e.jsxs("form",{onSubmit:N,className:"flex size-full flex-col overflow-hidden",children:[e.jsx(u.Body,{className:"size-full flex-1 overflow-auto",children:e.jsxs("div",{className:"flex flex-col gap-y-4",children:[e.jsx(r.Field,{control:s.control,name:"amount",led:a,render:({field:{onChange:t,...i}})=>e.jsxs(r.Item,{children:[e.jsx(r.Label,{children:o("fields.refundAmount")}),e.jsx(r.Control,{children:e.jsx(q,{min:0,max:p,onValueChange:t,code:n.currency_code,symbol:V(n.currency_code),...i})}),e.jsx(r.ErrorMessage,{})]})}),e.jsx(r.Field,{control:s.control,name:"reason",render:({field:{onChange:t,ref:i,...d}})=>e.jsxs(r.Item,{children:[e.jsx(r.Label,{children:o("fields.reason")}),e.jsx(r.Control,{children:e.jsxs(f,{onValueChange:t,...d,children:[e.jsx(f.Trigger,{className:"txt-small",ref:i,children:e.jsx(f.Value,{})}),e.jsx(f.Content,{children:U.map(c=>e.jsx(f.Item,{value:c.value,children:c.label},c.value))})]})}),e.jsx(r.ErrorMessage,{})]})}),e.jsx(r.Field,{control:s.control,name:"note",render:({field:t})=>e.jsxs(r.Item,{children:[e.jsx(r.Label,{children:o("fields.note")}),e.jsx(r.Control,{children:e.jsx(Q,{...t})}),e.jsx(r.ErrorMessage,{})]})}),e.jsx(r.Field,{control:s.control,name:"notification_enabled",render:({field:{onChange:t,value:i,...d}})=>e.jsxs(r.Item,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(r.Label,{children:o("orders.returns.sendNotification")}),e.jsx(r.Control,{children:e.jsx(r.Control,{children:e.jsx(Z,{checked:!!i,onCheckedChange:t,...d})})})]}),e.jsx(r.Hint,{className:"!mt-1",children:o("orders.refund.sendNotificationHint")}),e.jsx(r.ErrorMessage,{})]})}),_&&e.jsxs($,{variant:"warning",dismissible:!0,className:"mt-8 p-5",children:[e.jsx("div",{className:"text-ui-fg-subtle txt-small pb-2 font-medium leading-[20px]",children:o("orders.refund.systemPayment")}),e.jsx(w,{className:"text-ui-fg-subtle txt-small leading-normal",children:o("orders.refund.systemPaymentDesc")})]})]})}),e.jsx(u.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(u.Close,{asChild:!0,children:e.jsx(b,{variant:"secondary",size:"small",children:o("actions.cancel")})}),e.jsx(b,{type:"submit",isLoading:j||y,size:"small",children:o("actions.complete")})]})})]})})}const Re=()=>{const{t:n}=C(),{id:l}=I(),[o]=M(),x=o.get("paymentId"),{order:a,isLoading:p,isError:s,error:h}=A(l,{expand:G}),j=!p&&a;if(s)throw h;const g=x?a.payments.find(y=>y.id===x):void 0;return e.jsxs(u,{children:[e.jsx(u.Header,{children:e.jsx(J,{children:n("orders.refund.title")})}),j&&e.jsx(W,{order:a,payment:g})]})};export{Re as Component};
