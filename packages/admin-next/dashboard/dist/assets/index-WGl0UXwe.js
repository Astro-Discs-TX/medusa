import{u as _,a4 as S,a8 as D,i as T,j as e,a6 as H,T as N,a7 as $,a9 as L}from"./index-S--WvUSo.js";import{u as I,R as c}from"./route-focus-modal-MMx5Xnk0.js";import{t as V}from"./zod-jt04JUtm.js";import{r as k}from"./react-PzSkSLoa.js";import{u as A,F as s}from"./form-0PHaH8g8.js";import{o as B,s as p,b as G,d as M}from"./index-JzuMwgWW.js";import{c as P}from"./currencies-bd3ADI6s.js";import{b as j,a as f}from"./money-amount-helpers--myf8Rla.js";import{C as R}from"./currency-input-k1bgGOuE.js";import{S as d}from"./select-Z4sV_-wF.js";import{S as b}from"./switch-VR1xZXYU.js";import{D as z}from"./date-picker-s8-9mila.js";import{B as g}from"./button-Pc5Xo8ua.js";import{c as U}from"./react-router-dom-aSYyayiN.js";import{H as K}from"./heading-cSlef4Su.js";import"./react-dom-Og6--24v.js";import"./drawer-H3TI1lDZ.js";import"./index-sF0hA49A.js";import"./prompt-LzbVPZYR.js";import"./information-circle-solid-rXH6vJ5W.js";import"./label-HFq5fzpT.js";import"./tooltip-Ixyw9oT8.js";import"./index-Hm2Uj9Gg.js";import"./triangles-mini-HukRlWGp.js";import"./index-1Zwdg31z.js";import"./input-A29ux7yj.js";import"./minus-E5-czcFC.js";const O=B({region_id:p(),balance:p(),is_enabled:G(),ends_at:M().nullable()}),Z=({giftCard:r})=>{const{t:a}=_(),{handleSuccess:m}=I(),[x,u]=k.useState(!!r.ends_at),o=A({defaultValues:{region_id:r.region_id,balance:j(r.balance,r.region.currency_code).toString(),is_enabled:!r.is_disabled,ends_at:r.ends_at?new Date(r.ends_at):null},resolver:V(O)}),{setValue:y}=o,{regions:h}=S({limit:1e3,fields:"id,name"}),{mutateAsync:C,isLoading:v}=D(r.id),E=n=>{n||y("ends_at",null,{shouldDirty:!0}),u(n)},F=o.handleSubmit(async n=>{const t=f(parseFloat(n.balance),r.region.currency_code);if(t>r.value){o.setError("balance",{type:"manual",message:a("giftCards.balanceHigherThanValue")});return}if(t<0){o.setError("balance",{type:"manual",message:a("giftCards.balanceLowerThanZero")});return}await C({region_id:n.region_id,balance:f(parseFloat(n.balance),r.region.currency_code),is_disabled:!n.is_enabled,ends_at:n.ends_at},{onSuccess:()=>{m()},onError:l=>{var i;T(l)&&o.setError("balance",{type:"manual",message:(i=l.response)==null?void 0:i.data.message})}})});return e.jsx(c.Form,{form:o,children:e.jsxs("form",{onSubmit:F,className:"flex flex-1 flex-col overflow-hidden",children:[e.jsxs(c.Body,{className:"flex flex-1 flex-col gap-y-8 overflow-auto",children:[e.jsx(s.Field,{control:o.control,name:"balance",render:({field:{onChange:n,...t}})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{children:a("giftCards.balance")}),e.jsx(s.Control,{children:e.jsx(R,{code:r.region.currency_code.toUpperCase(),symbol:`/ ${j(r.value,r.region.currency_code)} ${P[r.region.currency_code.toUpperCase()].symbol_native}`,min:0,onValueChange:n,...t})}),e.jsx(s.ErrorMessage,{})]})}),e.jsx(s.Field,{control:o.control,name:"region_id",render:({field:{onChange:n,ref:t,...l}})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{children:a("fields.region")}),e.jsx(s.Control,{children:e.jsxs(d,{...l,onValueChange:n,children:[e.jsx(d.Trigger,{ref:t,children:e.jsx(d.Value,{})}),e.jsx(d.Content,{children:h==null?void 0:h.map(i=>e.jsx(d.Item,{value:i.id,children:i.name},i.id))})]})}),e.jsx(s.Hint,{children:a("giftCards.regionHint")}),e.jsx(s.ErrorMessage,{})]})}),e.jsx(s.Field,{control:o.control,name:"is_enabled",render:({field:{value:n,onChange:t,...l}})=>e.jsxs(s.Item,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(s.Label,{children:a("general.enabled")}),e.jsx(s.Control,{children:e.jsx(b,{checked:n,onCheckedChange:t,...l})})]}),e.jsx(s.Hint,{className:"!mt-1",children:a("giftCards.enabledHint")}),e.jsx(s.ErrorMessage,{})]})}),e.jsx(s.Field,{control:o.control,name:"ends_at",render:({field:{value:n,onChange:t,ref:l,...i}})=>e.jsx(s.Item,{children:e.jsxs(H,{open:x,children:[e.jsxs("div",{className:"flex flex-col gap-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(s.Label,{optional:!0,children:a("fields.expiryDate")}),e.jsx(b,{checked:x,onCheckedChange:E})]}),e.jsx(N,{size:"small",className:"text-ui-fg-subtle text-pretty",children:a("giftCards.expiryDateHint")})]}),e.jsx($,{children:e.jsx("div",{className:"pt-4",children:e.jsx(s.Control,{children:e.jsx(z,{value:n??void 0,onChange:w=>{t(w??null)},...i})})})})]})})})]}),e.jsx(c.Footer,{children:e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx(c.Close,{asChild:!0,children:e.jsx(g,{size:"small",variant:"secondary",children:a("actions.cancel")})}),e.jsx(g,{size:"small",type:"submit",isLoading:v,children:a("actions.save")})]})})]})})},ye=()=>{const{id:r}=U(),{t:a}=_(),{gift_card:m,isLoading:x,isError:u,error:o}=L(r);if(u)throw o;return e.jsxs(c,{children:[e.jsx(c.Header,{children:e.jsx(K,{children:a("giftCards.editGiftCard")})}),!x&&m&&e.jsx(Z,{giftCard:m})]})};export{ye as Component};
