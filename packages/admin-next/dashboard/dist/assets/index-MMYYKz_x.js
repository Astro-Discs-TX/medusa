import{u as F,j as e,T as f,I as Q,Z as _,W as V}from"./index-S--WvUSo.js";import{u as K,a as u}from"./route-focus-modal-MMx5Xnk0.js";import{u as X,F as m}from"./form-0PHaH8g8.js";import{t as W}from"./zod-jt04JUtm.js";import{o as $,s as k,a as G}from"./index-JzuMwgWW.js";import{S as h}from"./split-view-l-bJVVse.js";import{f as J,s as U}from"./stock-locations-5f5MPAbM.js";import{r as d}from"./react-PzSkSLoa.js";import{u as Y,a as ee,b as te}from"./use-country-table-query-o2jH7Fmc.js";import{c as N}from"./countries-QR_y0WJ_.js";import{a as se,D as re}from"./use-data-table-TeZp00wg.js";import{X as oe}from"./x-mark-mini-aYDSd38M.js";import{B as l}from"./button-Pc5Xo8ua.js";import{H as ne}from"./heading-cSlef4Su.js";import{I as ie}from"./input-A29ux7yj.js";import{A as Z}from"./alert-dyv3SYtc.js";import{B as ae}from"./badge-99FyByJO.js";import{C as I}from"./checkbox-8MlXzZCx.js";import{c as le}from"./index-JDlOzmVl.js";import{c as ce,d as me}from"./react-router-dom-aSYyayiN.js";import"./react-dom-Og6--24v.js";import"./drawer-H3TI1lDZ.js";import"./index-sF0hA49A.js";import"./prompt-LzbVPZYR.js";import"./information-circle-solid-rXH6vJ5W.js";import"./label-HFq5fzpT.js";import"./tooltip-Ixyw9oT8.js";import"./empty-table-content-i72rBIA2.js";import"./plus-mini-IRJECoWI.js";import"./index-1Zwdg31z.js";import"./use-date-Putn0_Ur.js";import"./format-vrL-wy9v.js";import"./date-picker-s8-9mila.js";import"./minus-E5-czcFC.js";import"./index-7dV3TD85.js";import"./index-Hm2Uj9Gg.js";import"./lodash-5s15_I2H.js";import"./command-bar-wUgfUfvQ.js";import"./x-circle-solid-rnqhxvfk.js";import"./check-circle-solid-7j4QonPK.js";const y="ac",v=50,ue=({onSave:o})=>{const{t:r}=F();return e.jsxs("div",{className:"flex items-center justify-end gap-x-2 border-t p-4",children:[e.jsx(h.Close,{type:"button",asChild:!0,children:e.jsx(l,{variant:"secondary",size:"small",children:r("actions.cancel")})}),e.jsx(l,{size:"small",type:"button",onClick:o,children:r("actions.save")})]})},de=$({name:k().min(1),countries:G(k().length(2)).min(1)});function pe({fulfillmentSet:o,locationId:r}){var w;const{t:s}=F(),{handleSuccess:n}=K(),[c,g]=d.useState(!1),[p,x]=d.useState({}),i=X({defaultValues:{name:"",countries:[]},resolver:W(de)}),{mutateAsync:P,isPending:z}=J(r,o.id),R=i.handleSubmit(async t=>{await P({name:t.name,geo_zones:t.countries.map(a=>({country_code:a,type:"country"}))}),n()}),T=t=>{g(t)},{searchParams:A,raw:E}=Y({pageSize:v,prefix:y}),{countries:L,count:C}=ee({countries:N.map((t,a)=>({display_name:t.display_name,name:t.name,id:a,iso_2:t.iso_2,iso_3:t.iso_3,num_code:t.num_code,region_id:null,region:{}})),...A}),S=fe(),{table:B}=se({data:L||[],columns:S,count:C,enablePagination:!0,enableRowSelection:!0,getRowId:t=>t.iso_2,pageSize:v,rowSelection:{state:p,updater:x},prefix:y}),j=i.watch("countries"),M=()=>{i.setValue("countries",Object.keys(p)),g(!1)},q=t=>{const a={...p};delete a[t],x(a),i.setValue("countries",j.filter(O=>O!==t))},D=()=>{x({}),i.setValue("countries",[])},b=d.useMemo(()=>N.filter(t=>t.iso_2 in p),[j]);d.useEffect(()=>{c&&x(j.reduce((t,a)=>(t[a]=!0,t),{}))},[c]);const H=((w=i.formState.errors.countries)==null?void 0:w.type)==="too_small";return e.jsx(u.Form,{form:i,children:e.jsxs("form",{className:"flex h-full flex-col overflow-hidden",onSubmit:R,children:[e.jsx(u.Header,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(u.Close,{asChild:!0,children:e.jsx(l,{variant:"secondary",size:"small",children:s("actions.cancel")})}),e.jsx(l,{type:"submit",size:"small",isLoading:z,children:s("actions.save")})]})}),e.jsx(u.Body,{className:"m-auto flex h-full w-full  flex-col items-center divide-y overflow-hidden",children:e.jsxs(h,{open:c,onOpenChange:T,children:[e.jsxs(h.Content,{className:"mx-auto max-w-[720px]",children:[e.jsxs("div",{className:"container  w-fit px-1 py-8",children:[e.jsx(ne,{className:"mb-12 mt-8 text-2xl",children:s("shipping.fulfillmentSet.create.title",{fulfillmentSet:o.name})}),e.jsx("div",{className:"flex max-w-[340px] flex-col gap-y-6",children:e.jsx(m.Field,{control:i.control,name:"name",render:({field:t})=>e.jsxs(m.Item,{children:[e.jsx(m.Label,{children:s("shipping.serviceZone.create.zoneName")}),e.jsx(m.Control,{children:e.jsx(ie,{placeholder:s("fields.name"),...t})}),e.jsx(m.ErrorMessage,{})]})})})]}),e.jsxs(Z,{children:[e.jsx(f,{weight:"plus",children:s("shipping.serviceZone.create.subtitle")}),e.jsx(f,{className:"text-ui-fg-subtle mt-2",children:s("shipping.serviceZone.create.description")})]}),e.jsxs("div",{className:"container flex items-center justify-between py-8 pr-1",children:[e.jsxs("div",{children:[e.jsx(f,{weight:"plus",children:s("shipping.serviceZone.areas.title")}),e.jsx(f,{className:"text-ui-fg-subtle mt-2",children:s("shipping.serviceZone.areas.description")})]}),e.jsx(l,{onClick:()=>g(!0),variant:"secondary",type:"button",children:s("shipping.serviceZone.areas.manage")})]}),!!b.length&&e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[b.map(t=>e.jsxs(ae,{className:"text-ui-fg-subtle txt-small flex items-center gap-1 divide-x pr-0",children:[t.display_name,e.jsx(Q,{type:"button",onClick:()=>q(t.iso_2),className:"text-ui-fg-subtle p-0 px-1 pt-[1px]",variant:"transparent",children:e.jsx(oe,{})})]},t.iso_2)),e.jsx(l,{type:"button",onClick:D,variant:"transparent",className:"txt-small text-ui-fg-muted font-medium",children:s("actions.clearAll")})]}),H&&e.jsx(Z,{dismissible:!0,variant:"error",children:s("shipping.serviceZone.areas.error")})]}),e.jsx(h.Drawer,{children:e.jsxs("div",{className:"flex size-full flex-col overflow-hidden",children:[e.jsx(re,{table:B,columns:S,pageSize:v,count:C,search:!0,pagination:!0,layout:"fill",orderBy:["name","code"],queryObject:E,prefix:y}),e.jsx(ue,{onSave:M})]})})]})})]})})}const xe=le(),fe=()=>{const o=te();return d.useMemo(()=>[xe.display({id:"select",header:({table:r})=>e.jsx(I,{checked:r.getIsSomePageRowsSelected()?"indeterminate":r.getIsAllPageRowsSelected(),onCheckedChange:s=>r.toggleAllPageRowsSelected(!!s)}),cell:({row:r})=>{const s=!r.getCanSelect();return e.jsx(I,{checked:r.getIsSelected()||s,disabled:s,onCheckedChange:n=>r.toggleSelected(!!n),onClick:n=>{n.stopPropagation()}})}}),...o],[o])};function rt(){const{fset_id:o,location_id:r}=ce(),{stock_location:s}=me(),n=s.fulfillment_sets.find(c=>c.id===o);if(!n)throw new Error("Fulfillment set doesn't exist");return e.jsx(u,{children:e.jsx(pe,{locationId:r,fulfillmentSet:n})})}const he=o=>({queryKey:U.detail(o),queryFn:async()=>V.stockLocations.retrieve(o,{fields:"*fulfillment_sets"})}),ot=async({params:o})=>{const r=o.location_id,s=he(r);return _.getQueryData(s.queryKey)??await _.fetchQuery(s)};export{rt as Component,ot as loader};
