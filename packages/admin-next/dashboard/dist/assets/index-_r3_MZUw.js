import{Z as v,aN as k,m as D,u as g,j as t,a1 as S,T as x}from"./index-S--WvUSo.js";import{J as I}from"./json-view-section-Dui2O31i.js";import{a as w,d as q,b as z}from"./regions-en8xSoIX.js";import{r as T}from"./react-PzSkSLoa.js";import{A as h}from"./action-menu-olZwXQ3q.js";import{a as E,D as H}from"./use-data-table-TeZp00wg.js";import{u as O,a as Q,b as B}from"./use-country-table-query-o2jH7Fmc.js";import{P as M}from"./plus-mini-IRJECoWI.js";import{t as m}from"./toast-4oQfF9Sm.js";import{T as R}from"./trash-nTjeUaCp.js";import{u as j}from"./use-prompt-wB0F2CxI.js";import{H as P}from"./heading-cSlef4Su.js";import{C}from"./checkbox-8MlXzZCx.js";import{c as W}from"./index-JDlOzmVl.js";import{L as Y}from"./list-summary-5vNt7oxx.js";import{c as F}from"./currencies-bd3ADI6s.js";import{f as G}from"./format-provider-yygkXOZ0.js";import{a as J,d as K,c as U,O as Z}from"./react-router-dom-aSYyayiN.js";import{P as V}from"./pencil-square-u3fizEAQ.js";import{B as X}from"./badge-99FyByJO.js";import"./react-dom-Og6--24v.js";import"./drawer-H3TI1lDZ.js";import"./index-sF0hA49A.js";import"./x-mark-mini-aYDSd38M.js";import"./empty-table-content-i72rBIA2.js";import"./button-Pc5Xo8ua.js";import"./index-1Zwdg31z.js";import"./use-date-Putn0_Ur.js";import"./format-vrL-wy9v.js";import"./date-picker-s8-9mila.js";import"./input-A29ux7yj.js";import"./minus-E5-czcFC.js";import"./index-7dV3TD85.js";import"./index-Hm2Uj9Gg.js";import"./lodash-5s15_I2H.js";import"./label-HFq5fzpT.js";import"./command-bar-wUgfUfvQ.js";import"./information-circle-solid-rXH6vJ5W.js";import"./x-circle-solid-rnqhxvfk.js";import"./check-circle-solid-7j4QonPK.js";import"./prompt-LzbVPZYR.js";import"./tooltip-Ixyw9oT8.js";const $=i=>({queryKey:k.detail(i),queryFn:async()=>D.admin.regions.retrieve(i,{fields:"*payment_providers"})}),Ke=async({params:i})=>{const s=i.id,e=$(s);return v.getQueryData(e.queryKey)??await v.fetchQuery(e)},f="c",y=10,ee=({region:i})=>{const{t:s}=g(),e=j(),[o,r]=T.useState({}),{searchParams:n,raw:d}=O({pageSize:y,prefix:f}),{countries:l,count:a}=Q({countries:i.countries||[],...n}),p=te(),{table:_}=E({data:l||[],columns:p,count:a,enablePagination:!0,enableRowSelection:!0,getRowId:u=>u.iso_2,pageSize:y,rowSelection:{state:o,updater:r},prefix:f,meta:{region:i}}),{mutateAsync:L}=w(i.id),N=async()=>{const u=Object.keys(o).filter(c=>o[c]);if(!await e({title:s("general.areYouSure"),description:s("regions.removeCountriesWarning",{count:u.length}),verificationText:s("actions.remove"),verificationInstruction:s("general.typeToConfirm"),cancelText:s("actions.cancel"),confirmText:s("actions.remove")}))return;const A=i.countries.filter(c=>!u.includes(c.iso_2)).map(c=>c.iso_2);try{await L({countries:A}),m.success(s("general.success"),{description:s("regions.toast.countries"),dismissLabel:s("actions.close")})}catch(c){m.error(s("general.error"),{description:c.message,dismissLabel:s("actions.close")})}};return t.jsxs(S,{className:"divide-y p-0",children:[t.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[t.jsx(P,{level:"h2",children:s("fields.countries")}),t.jsx(h,{groups:[{actions:[{label:s("regions.addCountries"),icon:t.jsx(M,{}),to:"countries/add"}]}]})]}),t.jsx(H,{table:_,columns:p,pageSize:y,count:a,orderBy:["name","code"],search:!0,pagination:!0,queryObject:d,prefix:f,commands:[{action:N,label:s("actions.remove"),shortcut:"r"}]})]})},se=({country:i,region:s})=>{var l;const{t:e}=g(),o=j(),{mutateAsync:r}=w(s.id),n=(l=s.countries)==null?void 0:l.filter(a=>a.iso_2!==i.iso_2).map(a=>a.iso_2),d=async()=>{if(await o({title:e("general.areYouSure"),description:e("regions.removeCountryWarning",{name:i.display_name}),verificationText:i.display_name,verificationInstruction:e("general.typeToConfirm"),cancelText:e("actions.cancel"),confirmText:e("actions.remove")}))try{await r({countries:n}),m.success(e("general.success"),{description:e("regions.toast.countries"),dismissLabel:e("actions.close")})}catch(p){m.error(e("general.error"),{description:p.message,dismissLabel:e("actions.close")})}};return t.jsx(h,{groups:[{actions:[{label:e("actions.remove"),onClick:d,icon:t.jsx(R,{})}]}]})},b=W(),te=()=>{const i=B();return T.useMemo(()=>[b.display({id:"select",header:({table:s})=>t.jsx(C,{checked:s.getIsSomePageRowsSelected()?"indeterminate":s.getIsAllPageRowsSelected(),onCheckedChange:e=>s.toggleAllPageRowsSelected(!!e)}),cell:({row:s})=>t.jsx(C,{checked:s.getIsSelected(),onCheckedChange:e=>s.toggleSelected(!!e),onClick:e=>{e.stopPropagation()}})}),...i,b.display({id:"actions",cell:({row:s,table:e})=>{const{region:o}=e.options.meta;return t.jsx(se,{country:s.original,region:o})}})],[i])},ie=({region:i})=>{var e;const{t:s}=g();return t.jsxs(S,{className:"divide-y p-0",children:[t.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[t.jsx(P,{children:i.name}),t.jsx(oe,{region:i})]}),t.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[t.jsx(x,{size:"small",leading:"compact",weight:"plus",children:s("fields.currency")}),t.jsxs("div",{className:"flex items-center gap-x-2",children:[t.jsx(X,{size:"2xsmall",className:"uppercase",children:i.currency_code}),t.jsx(x,{size:"small",leading:"compact",children:F[i.currency_code.toUpperCase()].name})]})]}),t.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[t.jsx(x,{size:"small",leading:"compact",weight:"plus",children:s("fields.paymentProviders")}),t.jsx("div",{className:"inline-flex",children:((e=i.payment_providers)==null?void 0:e.length)>0?t.jsx(Y,{list:i.payment_providers.map(o=>G(o.id))}):"-"})]})]})},oe=({region:i})=>{const s=J(),{t:e}=g(),{mutateAsync:o}=q(i.id),r=j(),n=async()=>{if(await r({title:e("general.areYouSure"),description:e("regions.deleteRegionWarning",{name:i.name}),verificationText:i.name,verificationInstruction:e("general.typeToConfirm"),confirmText:e("actions.delete"),cancelText:e("actions.cancel")})){try{await o(void 0),m.success(e("general.success"),{description:e("regions.toast.delete"),dismissLabel:e("actions.close")})}catch(l){m.error(e("general.error"),{description:l.message,dismissLabel:e("actions.close")})}s("/settings/regions",{replace:!0})}};return t.jsx(h,{groups:[{actions:[{icon:t.jsx(V,{}),label:e("actions.edit"),to:`/settings/regions/${i.id}/edit`}]},{actions:[{icon:t.jsx(R,{}),label:e("actions.delete"),onClick:n}]}]})},Ue=()=>{const i=K(),{id:s}=U(),{region:e,isPending:o,isError:r,error:n}=z(s,{fields:"*payment_providers,*countries"},{initialData:i});if(o||!e)return t.jsx("div",{children:"Loading..."});if(r)throw n;return t.jsxs("div",{className:"flex flex-col gap-y-2",children:[t.jsx(ie,{region:e}),t.jsx(ee,{region:e}),t.jsx(I,{data:e}),t.jsx(Z,{})]})};export{Ue as Component,Ke as loader};
