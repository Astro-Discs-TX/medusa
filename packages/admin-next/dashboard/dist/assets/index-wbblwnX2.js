import{u as f,a4 as C,al as F,j as e,T,am as D}from"./index-S--WvUSo.js";import{u as S,R as a}from"./route-focus-modal-MMx5Xnk0.js";import{t as E}from"./zod-jt04JUtm.js";import{u as I,F as r}from"./form-0PHaH8g8.js";import{o as L,s as u,n as M,a as N}from"./index-JzuMwgWW.js";import{C as P}from"./combobox-DjjFlb75.js";import{P as R}from"./percentage-input-hee_tAkG.js";import{g as V}from"./currencies-bd3ADI6s.js";import{b as _,a as H}from"./money-amount-helpers--myf8Rla.js";import{T as w}from"./Trans-9IhttDMi.js";import{I as z}from"./input-A29ux7yj.js";import{S as m}from"./select-Z4sV_-wF.js";import{C as A}from"./currency-input-k1bgGOuE.js";import{T as B}from"./textarea-D4fuXHvE.js";import{B as h}from"./button-Pc5Xo8ua.js";import{c as k}from"./react-router-dom-aSYyayiN.js";import{H as K}from"./heading-cSlef4Su.js";import"./react-PzSkSLoa.js";import"./react-dom-Og6--24v.js";import"./drawer-H3TI1lDZ.js";import"./index-sF0hA49A.js";import"./prompt-LzbVPZYR.js";import"./information-circle-solid-rXH6vJ5W.js";import"./label-HFq5fzpT.js";import"./tooltip-Ixyw9oT8.js";import"./x-mark-mini-aYDSd38M.js";import"./triangles-mini-HukRlWGp.js";import"./plus-mini-IRJECoWI.js";import"./index-Hm2Uj9Gg.js";const $=L({code:u().min(1),description:u(),value:M(),regions:N(u())}),q=({discount:o})=>{const{t:i}=f(),{handleSuccess:d}=S(),{regions:x}=C(),t=o.rule.type==="fixed",p=o.rule.type==="free_shipping",l=I({defaultValues:{code:o.code,description:o.rule.description||"",regions:o.regions.map(s=>s.id),value:t?_(o.rule.value,o.regions[0].currency_code):o.rule.value},resolver:E($)}),{mutateAsync:g,isLoading:y}=F(o.id),b=l.handleSubmit(async s=>{await g({code:s.code,regions:s.regions,rule:{id:o.rule.id,description:s.description,value:t?H(s.value,o.regions[0].currency_code):s.value}},{onSuccess:()=>{d()}})});return e.jsx(a.Form,{form:l,children:e.jsxs("form",{onSubmit:b,className:"flex h-full flex-col",children:[e.jsx(a.Body,{children:e.jsxs("div",{className:"flex h-full flex-col gap-y-8",children:[e.jsxs("div",{className:"flex flex-col gap-y-4",children:[e.jsx(r.Field,{control:l.control,name:"code",render:({field:s})=>e.jsxs(r.Item,{children:[e.jsx(r.Label,{children:i("fields.code")}),e.jsx(r.Control,{children:e.jsx(z,{...s})}),e.jsx(r.ErrorMessage,{})]})}),e.jsx(T,{size:"small",leading:"compact",className:"text-ui-fg-subtle",children:e.jsx(w,{t:i,i18nKey:"discounts.titleHint",components:[e.jsx("br",{},"break")]})})]}),e.jsx(r.Field,{control:l.control,name:"regions",render:({field:{onChange:s,value:c,ref:v,...j}})=>e.jsxs(r.Item,{children:[e.jsx(r.Label,{children:i("discounts.chooseValidRegions")}),e.jsx(r.Control,{children:t?e.jsxs(m,{value:c[0],onValueChange:n=>s([n]),...j,children:[e.jsx(m.Trigger,{ref:v,children:e.jsx(m.Value,{})}),e.jsx(m.Content,{children:(x||[]).map(n=>e.jsx(m.Item,{value:n.id,children:n.name},n.id))})]}):e.jsx(P,{options:(x||[]).map(n=>({label:n.name,value:n.id})),value:c,onChange:s,...j})}),e.jsx(r.ErrorMessage,{})]})}),!p&&e.jsx(r.Field,{control:l.control,name:"value",render:({field:{onChange:s,...c}})=>e.jsxs(r.Item,{children:[e.jsx(r.Label,{children:i(t?"fields.amount":"fields.percentage")}),e.jsx(r.Control,{children:t?e.jsx(A,{min:0,onValueChange:s,code:o.regions[0].currency_code,symbol:V(o.regions[0].currency_code),...c}):e.jsx(R,{onChange:s,min:0,max:100,...c})}),e.jsx(r.ErrorMessage,{})]})}),e.jsx(r.Field,{control:l.control,name:"description",render:({field:s})=>e.jsxs(r.Item,{children:[e.jsx(r.Label,{optional:!0,children:i("fields.description")}),e.jsx(r.Control,{children:e.jsx(B,{...s})}),e.jsx(r.ErrorMessage,{})]})})]})}),e.jsx(a.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(a.Close,{asChild:!0,children:e.jsx(h,{size:"small",variant:"secondary",children:i("actions.cancel")})}),e.jsx(h,{size:"small",type:"submit",isLoading:y,children:i("actions.save")})]})})]})})},be=()=>{const{id:o}=k(),{t:i}=f(),{discount:d,isLoading:x,isError:t,error:p}=D(o);if(t)throw p;return e.jsxs(a,{children:[e.jsx(a.Header,{children:e.jsx(K,{children:i("discounts.editDiscountDetails")})}),!x&&d&&e.jsx(q,{discount:d})]})};export{be as Component};
