import{u as $,j as e,d as q,T as p,an as G}from"./index-S--WvUSo.js";import{u as Q,a as j}from"./route-focus-modal-MMx5Xnk0.js";import{t as U}from"./zod-jt04JUtm.js";import{r as _}from"./react-PzSkSLoa.js";import{u as W,a as Z,F as t}from"./form-0PHaH8g8.js";import{o as P,s as h,b as J,a as R}from"./index-JzuMwgWW.js";import{C as K}from"./combobox-DjjFlb75.js";import{S as y}from"./split-view-l-bJVVse.js";import{a as Y,D as ee}from"./use-data-table-TeZp00wg.js";import{u as se}from"./regions-en8xSoIX.js";import{c as T}from"./countries-QR_y0WJ_.js";import{f as re}from"./format-provider-yygkXOZ0.js";import{u as oe,a as te,b as ie}from"./use-country-table-query-o2jH7Fmc.js";import{t as I}from"./toast-4oQfF9Sm.js";import{X as ne}from"./x-mark-mini-aYDSd38M.js";import{B as f}from"./button-Pc5Xo8ua.js";import{H as le}from"./heading-cSlef4Su.js";import{I as ae}from"./input-A29ux7yj.js";import{S as g}from"./select-Z4sV_-wF.js";import{S as ce}from"./switch-VR1xZXYU.js";import{C as z}from"./checkbox-8MlXzZCx.js";import{c as de}from"./index-JDlOzmVl.js";import{c as me}from"./currencies-bd3ADI6s.js";import{u as ue}from"./payments-6lBoSQZk.js";import"./react-dom-Og6--24v.js";import"./react-router-dom-aSYyayiN.js";import"./drawer-H3TI1lDZ.js";import"./index-sF0hA49A.js";import"./prompt-LzbVPZYR.js";import"./information-circle-solid-rXH6vJ5W.js";import"./label-HFq5fzpT.js";import"./tooltip-Ixyw9oT8.js";import"./triangles-mini-HukRlWGp.js";import"./plus-mini-IRJECoWI.js";import"./empty-table-content-i72rBIA2.js";import"./index-1Zwdg31z.js";import"./use-date-Putn0_Ur.js";import"./format-vrL-wy9v.js";import"./date-picker-s8-9mila.js";import"./minus-E5-czcFC.js";import"./index-7dV3TD85.js";import"./index-Hm2Uj9Gg.js";import"./lodash-5s15_I2H.js";import"./command-bar-wUgfUfvQ.js";import"./x-circle-solid-rnqhxvfk.js";import"./check-circle-solid-7j4QonPK.js";const xe=P({name:h().min(1),currency_code:h().min(2,"Select a currency"),includes_tax:J(),countries:R(P({code:h(),name:h()})),payment_providers:R(h()).min(1)}),C="cr",S=50,pe=({currencies:n,paymentProviders:i})=>{const[m,d]=_.useState(!1),[x,u]=_.useState({}),{handleSuccess:v}=Q(),a=W({defaultValues:{name:"",currency_code:"",includes_tax:!1,countries:[],payment_providers:[]},resolver:U(xe)}),b=Z({control:a.control,name:"countries",defaultValue:[]}),{t:o}=$(),{mutateAsync:k,isPending:F}=se(),E=a.handleSubmit(async s=>{await k({name:s.name,countries:s.countries.map(r=>r.code),currency_code:s.currency_code,payment_providers:s.payment_providers,automatic_taxes:s.includes_tax},{onSuccess:({region:r})=>{I.success(o("general.success"),{description:o("regions.toast.create"),dismissLabel:o("actions.close")}),v(`../${r.id}`)},onError:r=>{I.error(o("general.error"),{description:r.message,dismissLabel:o("actions.close")})}})}),{searchParams:H,raw:M}=oe({pageSize:S,prefix:C}),{countries:L,count:w}=te({countries:T.map((s,r)=>({display_name:s.display_name,name:s.name,id:r,iso_2:s.iso_2,iso_3:s.iso_3,num_code:s.num_code,region_id:null,region:{}})),...H}),N=fe(),{table:V}=Y({data:L||[],columns:N,count:w,enablePagination:!0,enableRowSelection:!0,rowSelection:{state:x,updater:u},getRowId:s=>s.iso_2,pageSize:S,prefix:C}),D=()=>{const s=Object.keys(x).filter(r=>x[r]);a.setValue("countries",s.map(r=>({code:r,name:T.find(c=>c.iso_2===r).display_name})),{shouldDirty:!0,shouldTouch:!0}),d(!1)},A=s=>{if(d(s),!s){const r=b.reduce((c,l)=>(c[l.code]=!0,c),{});requestAnimationFrame(()=>{u(r)})}},B=s=>{const r=b.filter(l=>l.code!==s),c=r.map(l=>l.code).reduce((l,X)=>(l[X]=!0,l),{});a.setValue("countries",r,{shouldDirty:!0,shouldTouch:!0}),u(c)},O=()=>{a.setValue("countries",[],{shouldDirty:!0,shouldTouch:!0}),u({})};return e.jsx(j.Form,{form:a,children:e.jsxs("form",{className:"flex h-full flex-col overflow-hidden",onSubmit:E,children:[e.jsx(j.Header,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(j.Close,{asChild:!0,children:e.jsx(f,{size:"small",variant:"secondary",children:o("actions.cancel")})}),e.jsx(f,{size:"small",type:"submit",isLoading:F,children:o("actions.save")})]})}),e.jsx(j.Body,{className:"flex overflow-hidden",children:e.jsxs(y,{open:m,onOpenChange:A,children:[e.jsx(y.Content,{children:e.jsx("div",{className:q("flex h-full w-full flex-col items-center overflow-y-auto p-16"),id:"form-section",children:e.jsxs("div",{className:"flex w-full max-w-[720px] flex-col gap-y-8",children:[e.jsxs("div",{children:[e.jsx(le,{children:o("regions.createRegion")}),e.jsx(p,{size:"small",className:"text-ui-fg-subtle",children:o("regions.createRegionHint")})]}),e.jsx("div",{className:"flex flex-col gap-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(t.Field,{control:a.control,name:"name",render:({field:s})=>e.jsxs(t.Item,{children:[e.jsx(t.Label,{children:o("fields.name")}),e.jsx(t.Control,{children:e.jsx(ae,{...s})}),e.jsx(t.ErrorMessage,{})]})}),e.jsx(t.Field,{control:a.control,name:"currency_code",render:({field:{onChange:s,ref:r,...c}})=>e.jsxs(t.Item,{children:[e.jsx(t.Label,{children:o("fields.currency")}),e.jsx(t.Control,{children:e.jsxs(g,{...c,onValueChange:s,children:[e.jsx(g.Trigger,{ref:r,children:e.jsx(g.Value,{})}),e.jsx(g.Content,{children:n.map(l=>e.jsx(g.Item,{value:l.code,children:l.name},l.code))})]})}),e.jsx(t.ErrorMessage,{})]})})]})}),e.jsx(t.Field,{control:a.control,name:"includes_tax",render:({field:{value:s,onChange:r,...c}})=>e.jsx(t.Item,{children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx(t.Label,{children:o("fields.taxInclusivePricing")}),e.jsx(t.Control,{children:e.jsx(ce,{...c,checked:s,onCheckedChange:r})})]}),e.jsx(t.Hint,{children:o("regions.taxInclusiveHint")}),e.jsx(t.ErrorMessage,{})]})})}),e.jsx("div",{className:"bg-ui-border-base h-px w-full"}),e.jsxs("div",{className:"flex flex-col gap-y-4",children:[e.jsxs("div",{children:[e.jsx(p,{size:"small",leading:"compact",weight:"plus",children:o("fields.countries")}),e.jsx(p,{size:"small",className:"text-ui-fg-subtle",children:o("regions.countriesHint")})]}),b.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-2",children:[b.map(s=>e.jsx(ge,{country:s,onRemove:B},s.code)),e.jsx(f,{variant:"transparent",size:"small",className:"text-ui-fg-muted hover:text-ui-fg-subtle",onClick:O,children:o("actions.clearAll")})]}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx(f,{variant:"secondary",size:"small",onClick:()=>d(!0),type:"button",children:o("regions.addCountries")})})]}),e.jsx("div",{className:"bg-ui-border-base h-px w-full"}),e.jsxs("div",{className:"flex flex-col gap-y-4",children:[e.jsxs("div",{children:[e.jsx(p,{size:"small",leading:"compact",weight:"plus",children:o("fields.providers")}),e.jsx(p,{size:"small",className:"text-ui-fg-subtle",children:o("regions.providersHint")})]}),e.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:e.jsx(t.Field,{control:a.control,name:"payment_providers",render:({field:s})=>e.jsxs(t.Item,{children:[e.jsx(t.Label,{children:o("fields.paymentProviders")}),e.jsx(t.Control,{children:e.jsx(K,{options:i.map(r=>({label:re(r.id),value:r.id})),...s})}),e.jsx(t.ErrorMessage,{})]})})})]})]})})}),e.jsx(y.Drawer,{children:e.jsxs("div",{className:"flex size-full flex-col overflow-hidden",children:[e.jsx(ee,{table:V,columns:N,count:w,pageSize:S,orderBy:["name","code"],pagination:!0,search:!0,layout:"fill",queryObject:M,prefix:C}),e.jsxs("div",{className:"flex items-center justify-end gap-x-2 border-t p-4",children:[e.jsx(y.Close,{type:"button",children:o("actions.cancel")}),e.jsx(f,{size:"small",type:"button",onClick:D,children:o("actions.save")})]})]})})]})})]})})},he=de(),fe=()=>{const n=ie();return _.useMemo(()=>[he.display({id:"select",header:({table:i})=>e.jsx(z,{checked:i.getIsSomePageRowsSelected()?"indeterminate":i.getIsAllPageRowsSelected(),onCheckedChange:m=>i.toggleAllPageRowsSelected(!!m)}),cell:({row:i})=>{const m=!i.getCanSelect();return e.jsx(z,{checked:i.getIsSelected()||m,disabled:m,onCheckedChange:d=>i.toggleSelected(!!d),onClick:d=>{d.stopPropagation()}})}}),...n],[n])},ge=({country:n,onRemove:i})=>e.jsxs("div",{className:"bg-ui-bg-field shadow-borders-base transition-fg hover:bg-ui-bg-field-hover flex h-7 items-center overflow-hidden rounded-md",children:[e.jsx("div",{className:"txt-compact-small-plus flex h-full select-none items-center justify-center px-2 py-0.5",children:n.name}),e.jsx("button",{type:"button",onClick:()=>i(n.code),className:"focus-visible:bg-ui-bg-field-hover transition-fg hover:bg-ui-bg-field-hover flex h-full w-7 items-center justify-center border-l outline-none",children:e.jsx(ne,{className:"text-ui-fg-muted"})})]}),ds=()=>{const{store:n,isPending:i,isError:m,error:d}=G(),x=((n==null?void 0:n.supported_currency_codes)??[]).map(v=>me[v.toUpperCase()]),{payment_providers:u=[]}=ue();if(m)throw d;return e.jsx(j,{children:!i&&n&&e.jsx(pe,{currencies:x,paymentProviders:u})})};export{ds as Component};
