import{j as e,a1 as v,u as d,aY as S,a_ as I,b0 as E,T as r,b1 as q,S as N,aP as M,b2 as R,e as $,Z as w,b3 as H,m as V}from"./index-S--WvUSo.js";import{J as B}from"./json-view-section-Dui2O31i.js";import{A as y}from"./action-menu-olZwXQ3q.js";import{C as p,F,E as K}from"./customer-info-JjeQDtDl.js";import{A as Q}from"./arrow-path-LhKlAL5K.js";import{H as b}from"./heading-cSlef4Su.js";import{I as L}from"./inline-link-mCSkZwyp.js";import{a as J,c as W,d as Y,O as Z}from"./react-router-dom-aSYyayiN.js";import{r as f}from"./react-PzSkSLoa.js";import{T as G}from"./trash-nTjeUaCp.js";import{u as U}from"./use-prompt-wB0F2CxI.js";import{C as j}from"./copy-jbaNBJoS.js";import{f as X}from"./format-vrL-wy9v.js";import{S as _}from"./status-badge-sML89E1A.js";import{D as O}from"./divider-GiVPCNCn.js";import{T as ee}from"./thumbnail-gerN888-.js";import{c as m,g as se}from"./money-amount-helpers--myf8Rla.js";import"./react-dom-Og6--24v.js";import"./badge-99FyByJO.js";import"./drawer-H3TI1lDZ.js";import"./index-sF0hA49A.js";import"./x-mark-mini-aYDSd38M.js";import"./addresses-d8YOe6mI.js";import"./countries-QR_y0WJ_.js";import"./prompt-LzbVPZYR.js";import"./button-Pc5Xo8ua.js";import"./input-A29ux7yj.js";import"./label-HFq5fzpT.js";import"./tooltip-Ixyw9oT8.js";import"./check-circle-solid-7j4QonPK.js";import"./currencies-bd3ADI6s.js";var te=Object.defineProperty,h=Object.getOwnPropertySymbols,z=Object.prototype.hasOwnProperty,A=Object.prototype.propertyIsEnumerable,C=(s,t,a)=>t in s?te(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a,ae=(s,t)=>{for(var a in t||(t={}))z.call(t,a)&&C(s,a,t[a]);if(h)for(var a of h(t))A.call(t,a)&&C(s,a,t[a]);return s},ie=(s,t)=>{var a={};for(var i in s)z.call(s,i)&&t.indexOf(i)<0&&(a[i]=s[i]);if(s!=null&&h)for(var i of h(s))t.indexOf(i)<0&&A.call(s,i)&&(a[i]=s[i]);return a};const P=f.forwardRef((s,t)=>{var a=s,{color:i="currentColor"}=a,n=ie(a,["color"]);return f.createElement("svg",ae({xmlns:"http://www.w3.org/2000/svg",width:21,height:21,fill:"none",ref:t},n),f.createElement("path",{stroke:i,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M2.163 7.294h16.674m-16.674.641h16.674M4.729 12.113h5.075M4.73 14.348h2.565m-3.207 2.565h12.826a1.924 1.924 0 0 0 1.924-1.924V6.011a1.924 1.924 0 0 0-1.924-1.924H4.087a1.924 1.924 0 0 0-1.924 1.924v8.978a1.924 1.924 0 0 0 1.924 1.924Z"}))});P.displayName="CreditCard";const k=({draftOrder:s})=>e.jsxs(v,{className:"divide-y p-0",children:[e.jsx(re,{}),e.jsx(p.ID,{data:s.cart}),e.jsx(p.Contact,{data:s.cart}),e.jsx(p.Company,{data:s.cart}),e.jsx(p.Addresses,{data:s.cart})]}),re=()=>{const{t:s}=d();return e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(b,{level:"h2",children:s("fields.customer")}),e.jsx(y,{groups:[{actions:[{label:s("transferOwnership.label"),to:"transfer-ownership",icon:e.jsx(Q,{})}]},{actions:[{label:s("addresses.shippingAddress.editLabel"),to:"shipping-address",icon:e.jsx(F,{})},{label:s("addresses.billingAddress.editLabel"),to:"billing-address",icon:e.jsx(S,{})}]},{actions:[{label:s("email.editLabel"),to:"email",icon:e.jsx(K,{})}]}]})]})},le=({draftOrder:s})=>{const{t}=d(),a=U(),i=J(),{color:n,label:c}={open:{color:"orange",label:t("draftOrders.status.open")},completed:{color:"green",label:t("draftOrders.status.completed")}}[s.status],{mutateAsync:o}=I(s.id),{mutateAsync:l}=E(s.id),x=async()=>{await a({title:t("general.areYouSure"),description:t("orders.cancelWarning",{id:`#${s.display_id}`}),confirmText:t("actions.continue"),cancelText:t("actions.cancel")})&&await o(void 0)},u=async()=>{await a({title:t("draftOrders.markAsPaid.warningTitle"),description:t("draftOrders.markAsPaid.warningDescription"),confirmText:t("actions.continue"),cancelText:t("actions.cancel"),variant:"confirmation"})&&await l(void 0,{onSuccess:({order:T})=>{i(`/orders/${T.id}`)}})};return e.jsxs(v,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-x-1",children:[e.jsxs(b,{children:["#",s.display_id]}),e.jsx(j,{content:`#${s.display_id}`,className:"text-ui-fg-muted"})]}),e.jsx(r,{size:"small",className:"text-ui-fg-subtle",children:X(new Date(s.created_at),"dd MMM, yyyy, HH:mm:ss")})]}),e.jsxs("div",{className:"flex items-center gap-x-4",children:[e.jsx(_,{color:n,children:c}),e.jsx(y,{groups:[{actions:[{label:t("draftOrders.markAsPaid.label"),onClick:u,icon:e.jsx(P,{})}]},{actions:[{label:t("actions.delete"),onClick:x,icon:e.jsx(G,{})}]}]})]})]}),e.jsx(ne,{order:s.order}),!s.order&&e.jsx(oe,{cartId:s.cart_id})]})},ne=({order:s})=>{const{t}=d();return s?e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center gap-x-4 px-6 py-4",children:[e.jsx(r,{size:"small",leading:"compact",weight:"plus",children:t("fields.order")}),e.jsx(L,{to:`/orders/${s.id}`,children:e.jsx(r,{size:"small",children:`#${s.display_id}`})})]}):null},ce=(s,t)=>/{.*?}/.test(s)?s.replace(/{.*?}/,t):null,oe=({cartId:s})=>{const{t}=d(),{store:a,isLoading:i,isError:n,error:c}=q(),o=a!=null&&a.payment_link_template?ce(a.payment_link_template,s):null;if(n)throw c;return i?e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center gap-x-4 px-6 py-4",children:[e.jsx(N,{className:"w-[120px]"}),e.jsx(N,{className:"w-full max-w-[190px]"})]}):o?e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center gap-x-4 px-6 py-4",children:[e.jsx(r,{size:"small",leading:"compact",weight:"plus",children:t("draftOrders.paymentLinkLabel")}),e.jsxs("div",{className:"flex w-full items-start gap-x-1 overflow-hidden",children:[e.jsx(L,{to:o,rel:"noopener",target:"_blank",className:"w-fit overflow-hidden",children:e.jsx(r,{size:"small",className:"truncate",children:o})}),e.jsx(j,{className:"text-ui-fg-muted",content:s})]})]}):e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-start gap-x-4 px-6 py-4",children:[e.jsx(r,{size:"small",leading:"compact",weight:"plus",children:t("draftOrders.cartIdLabel")}),e.jsxs("div",{className:"flex w-full items-start gap-x-1 overflow-hidden",children:[e.jsx(r,{size:"small",className:"truncate",children:s}),e.jsx(j,{className:"text-ui-fg-muted",content:s})]})]})},de=({draftOrder:s})=>e.jsxs(v,{className:"divide-y divide-dashed p-0",children:[e.jsx(me,{}),e.jsx(pe,{draftOrder:s}),e.jsx(je,{draftOrder:s}),e.jsx(he,{draftOrder:s})]}),me=()=>{const{t:s}=d();return e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(b,{level:"h2",children:s("fields.summary")}),e.jsx(y,{groups:[{actions:[{label:s("orders.summary.allocateItems"),to:"#",icon:e.jsx(M,{})}]}]})]})},xe=({item:s,currencyCode:t,reservation:a})=>{const{t:i}=d();return e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-start gap-x-4 px-6 py-4",children:[e.jsx(r,{size:"small",leading:"compact",weight:"plus",className:"text-ui-fg-base",children:s.title}),e.jsxs("div",{className:"grid grid-cols-3 items-center gap-x-4",children:[e.jsx("div",{className:"flex items-center justify-end gap-x-4",children:e.jsx(r,{size:"small",children:m(s.unit_price,t)})}),e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx("div",{className:"w-fit min-w-[27px]",children:e.jsxs(r,{children:[e.jsx("span",{className:"tabular-nums",children:s.quantity}),"x"]})}),e.jsx("div",{className:"overflow-visible",children:e.jsx(_,{color:a?"green":"orange",className:"text-nowrap",children:i(a?"orders.reservations.allocatedLabel":"orders.reservations.notAllocatedLabel")})})]}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx(r,{size:"small",children:m(s.subtotal||0,t)})})]})]},s.id)},ue=({item:s,currencyCode:t,reservation:a})=>{const{t:i}=d();return e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-start gap-x-4 px-6 py-4",children:[e.jsxs("div",{className:"flex items-start gap-x-4",children:[e.jsx(ee,{src:s.thumbnail}),e.jsxs("div",{children:[e.jsx(r,{size:"small",leading:"compact",weight:"plus",className:"text-ui-fg-base",children:s.title}),s.variant.sku&&e.jsxs("div",{className:"flex items-center gap-x-1",children:[e.jsx(r,{size:"small",children:s.variant.sku}),e.jsx(j,{content:s.variant.sku,className:"text-ui-fg-muted"})]}),e.jsx(r,{size:"small",children:s.variant.title})]})]}),e.jsxs("div",{className:"grid grid-cols-3 items-center gap-x-4",children:[e.jsx("div",{className:"flex items-center justify-end gap-x-4",children:e.jsx(r,{size:"small",children:m(s.unit_price,t)})}),e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx("div",{className:"w-fit min-w-[27px]",children:e.jsxs(r,{children:[e.jsx("span",{className:"tabular-nums",children:s.quantity}),"x"]})}),e.jsx("div",{className:"overflow-visible",children:e.jsx(_,{color:a?"green":"orange",className:"text-nowrap",children:i(a?"orders.reservations.allocatedLabel":"orders.reservations.notAllocatedLabel")})})]}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx(r,{size:"small",children:m(s.subtotal||0,t)})})]})]},s.id)},pe=({draftOrder:s})=>{const{reservations:t,isError:a,error:i}=R({line_item_id:s.cart.items.map(l=>l.id)});if(a)throw i;const n=s.cart.items.filter(l=>l.variant_id!==null),c=s.cart.items.filter(l=>l.variant_id===null),o=n.length>0&&c.length>0;return console.log("customItems",c),e.jsxs("div",{children:[n.map(l=>{const x=t?t.find(u=>u.line_item_id===l.id):null;return e.jsx(ue,{item:l,currencyCode:s.cart.region.currency_code,reservation:x},l.id)}),o&&e.jsx(O,{variant:"dashed"}),c.map(l=>{const x=t?t.find(u=>u.line_item_id===l.id):null;return e.jsx(xe,{item:{id:l.id,title:l.title,unit_price:l.unit_price,subtotal:l.unit_price*l.quantity,quantity:l.quantity},currencyCode:s.cart.region.currency_code,reservation:x},l.id)})]})},g=({label:s,value:t,secondaryValue:a})=>e.jsxs("div",{className:"grid grid-cols-3 items-center",children:[e.jsx(r,{size:"small",leading:"compact",children:s}),e.jsx("div",{className:"text-right",children:e.jsx(r,{size:"small",leading:"compact",children:a})}),e.jsx("div",{className:"text-right",children:e.jsx(r,{size:"small",leading:"compact",children:t})})]}),ge=s=>{const{tax_total:t,subtotal:a=0,discount_total:i=0,gift_card_total:n=0,shipping_total:c=0}=s,o=a-i-n+c;return(t||0)/o*100},je=({draftOrder:s})=>{const{t}=d(),a=ge(s.cart).toFixed(2);return e.jsxs("div",{className:"text-ui-fg-subtle flex flex-col gap-y-2 px-6 py-4",children:[e.jsx(g,{label:t("fields.subtotal"),secondaryValue:t("general.items",{count:s.cart.items.length}),value:m(s.cart.subtotal||0,s.cart.region.currency_code)}),e.jsx(g,{label:t("fields.discount"),secondaryValue:s.cart.discounts.length>0?s.cart.discounts.map(i=>i.code).join(", "):"-",value:(s.cart.discount_total||0)>0?`- ${m(s.cart.discount_total||0,s.cart.region.currency_code)}`:"-"}),e.jsx(g,{label:t("fields.shipping"),secondaryValue:s.cart.shipping_methods.map(i=>i.shipping_option.name).join(", "),value:m(s.cart.shipping_total||0,s.cart.region.currency_code)}),e.jsx(g,{label:t("fields.tax"),secondaryValue:`${a||0} %`,value:s.cart.tax_total?m(s.cart.tax_total||0,s.cart.region.currency_code):"-"})]})},he=({draftOrder:s})=>{const{t}=d();return e.jsxs("div",{className:"text-ui-fg-base flex items-center justify-between px-6 py-4",children:[e.jsx(r,{size:"small",leading:"compact",weight:"plus",children:t("fields.total")}),e.jsx(r,{size:"small",leading:"compact",weight:"plus",children:se(s.cart.total||0,s.cart.region.currency_code)})]})},Ge=()=>{const{id:s}=W(),t=Y(),{draft_order:a,isLoading:i,isError:n,error:c}=$(s,{initialData:t});if(i||!a)return e.jsx("div",{children:"Loading..."});if(n)throw c;return e.jsxs("div",{className:"grid grid-cols-1 gap-x-4 xl:grid-cols-[1fr,400px]",children:[e.jsxs("div",{className:"flex flex-col gap-y-2",children:[e.jsx(le,{draftOrder:a}),e.jsx(de,{draftOrder:a}),e.jsx("div",{className:"flex flex-col gap-y-2 xl:hidden",children:e.jsx(k,{draftOrder:a})}),e.jsx(B,{data:a})]}),e.jsx("div",{className:"hidden flex-col gap-y-2 xl:flex",children:e.jsx(k,{draftOrder:a})}),e.jsx(Z,{})]})},fe=s=>({queryKey:H.detail(s),queryFn:async()=>V.admin.draftOrders.retrieve(s)}),Ue=async({params:s})=>{const t=s.id,a=fe(t);return w.getQueryData(a.queryKey)??await w.fetchQuery(a)};export{Ge as Component,Ue as loader};
