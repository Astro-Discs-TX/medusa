import{Y as v,m as g,a as L,j as e,u as x,T as p,i as E}from"./index-S--WvUSo.js";import{t as P}from"./zod-jt04JUtm.js";import{b as F,L as w}from"./react-router-dom-aSYyayiN.js";import{o as y,s as o,Z as M,n as j}from"./index-JzuMwgWW.js";import{r as b}from"./react-PzSkSLoa.js";import{u as V,F as s}from"./form-0PHaH8g8.js";import{d as H}from"./index.modern-Pe_E-6H8.js";import{L as z}from"./logo-box-TfH3D5h8.js";import{A as B}from"./index-99zzh8bn.js";import{m as u}from"./motion-jlFaYIfJ.js";import{t as $}from"./toast-4oQfF9Sm.js";import{T as U}from"./Trans-9IhttDMi.js";import{H as f}from"./heading-cSlef4Su.js";import{I as m}from"./input-A29ux7yj.js";import{A as q}from"./alert-dyv3SYtc.js";import{B as N}from"./button-Pc5Xo8ua.js";import"./react-dom-Og6--24v.js";import"./information-circle-solid-rXH6vJ5W.js";import"./label-HFq5fzpT.js";import"./tooltip-Ixyw9oT8.js";import"./x-circle-solid-rnqhxvfk.js";import"./check-circle-solid-7j4QonPK.js";import"./x-mark-mini-aYDSd38M.js";const O=(t="emailpass")=>v(n=>g.client.request("POST",`/auth/admin/${t}`,n)),R=t=>v(n=>g.client.request("POST",`/admin/invites/accept?token=${t}`,n.payload,{},{Authorization:`Bearer ${n.token}`})),Z=y({email:o().email(),first_name:o().min(1),last_name:o().min(1),password:o().min(1),repeat_password:o().min(1)}).superRefine(({password:t,repeat_password:n},i)=>{t!==n&&i.addIssue({code:M.custom,message:L.t("invite.passwordMismatch"),path:["repeat_password"]})}),we=()=>{const[t]=F(),[n,i]=b.useState(!1),l=t.get("token"),c=l?H(l):null,r=c&&J(c);return e.jsx("div",{className:"bg-ui-bg-base relative flex min-h-dvh w-dvw items-center justify-center p-4",children:e.jsxs("div",{className:"flex w-full max-w-[300px] flex-col items-center",children:[e.jsx(z,{className:"mb-4",checked:n,containerTransition:{duration:1.2,delay:.8,ease:[0,.71,.2,1.01]},pathTransition:{duration:1.3,delay:1.1,bounce:.6,ease:[.1,.8,.2,1.01]}}),e.jsx("div",{className:"max-h-[557px] w-full will-change-contents",children:r?e.jsx(B,{children:n?e.jsx(u.div,{initial:{opacity:0,scale:.4},animate:{opacity:1,scale:1},transition:{duration:1,delay:.6,ease:[0,.71,.2,1.01]},className:"w-full",children:e.jsx(Y,{})},"success-view"):e.jsx(u.div,{initial:!1,animate:{height:"557px",y:0},exit:{height:0,y:40},transition:{duration:.8,delay:.6,ease:[0,.71,.2,1.01]},className:"w-full will-change-transform",children:e.jsx(u.div,{initial:!1,animate:{opacity:1,scale:1},exit:{opacity:0,scale:.7},transition:{duration:.6,delay:0,ease:[0,.71,.2,1.01]},children:e.jsx(K,{onSuccess:()=>i(!0),token:l,invite:c})},"inner-create-account")},"create-account")}):e.jsx(D,{})})]})})},I=()=>{const{t}=x();return e.jsxs("div",{className:"flex w-full flex-col items-center",children:[e.jsx("div",{className:"my-6 h-px w-full border-b border-dotted"}),e.jsx("span",{className:"text-ui-fg-subtle txt-small",children:e.jsx(U,{t,i18nKey:"invite.alreadyHaveAccount",components:[e.jsx(w,{to:"/login",className:"text-ui-fg-interactive transition-fg hover:text-ui-fg-interactive-hover focus-visible:text-ui-fg-interactive-hover outline-none"},"login-link")]})})]})},D=()=>{const{t}=x();return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"flex flex-col items-center gap-y-1",children:[e.jsx(f,{children:t("invite.invalidTokenTitle")}),e.jsx(p,{size:"small",className:"text-ui-fg-subtle text-center",children:t("invite.invalidTokenHint")})]}),e.jsx(I,{})]})},K=({onSuccess:t,token:n})=>{const{t:i}=x(),[l,c]=b.useState(!1),r=V({resolver:P(Z),defaultValues:{email:"",first_name:"",last_name:"",password:"",repeat_password:""}}),{mutateAsync:T,isPending:A}=O(),{mutateAsync:C,isPending:S}=R(n),k=r.handleSubmit(async a=>{var h;try{const{token:d}=await T({email:a.email,password:a.password}),_={email:a.email,first_name:a.first_name,last_name:a.last_name};await C({payload:_,token:d}),t(),$.success(i("general.success"),{description:i("invite.toast.accepted"),dismissLabel:i("actions.close")})}catch(d){if(E(d)&&((h=d.response)==null?void 0:h.status)===400){r.setError("root",{type:"manual",message:i("invite.invalidInvite")}),c(!0);return}r.setError("root",{type:"manual",message:i("errors.serverError")})}});return e.jsxs("div",{className:"flex w-full flex-col items-center",children:[e.jsxs("div",{className:"mb-4 flex flex-col items-center",children:[e.jsx(f,{children:i("invite.title")}),e.jsx(p,{size:"small",className:"text-ui-fg-subtle text-center",children:i("invite.hint")})]}),e.jsx(s,{...r,children:e.jsxs("form",{onSubmit:k,className:"flex w-full flex-col gap-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-y-4",children:[e.jsx(s.Field,{control:r.control,name:"email",render:({field:a})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{children:i("fields.email")}),e.jsx(s.Control,{children:e.jsx(m,{autoComplete:"off",...a})}),e.jsx(s.ErrorMessage,{})]})}),e.jsx(s.Field,{control:r.control,name:"first_name",render:({field:a})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{children:i("fields.firstName")}),e.jsx(s.Control,{children:e.jsx(m,{autoComplete:"given-name",...a})}),e.jsx(s.ErrorMessage,{})]})}),e.jsx(s.Field,{control:r.control,name:"last_name",render:({field:a})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{children:i("fields.lastName")}),e.jsx(s.Control,{children:e.jsx(m,{autoComplete:"family-name",...a})}),e.jsx(s.ErrorMessage,{})]})}),e.jsx(s.Field,{control:r.control,name:"password",render:({field:a})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{children:i("fields.password")}),e.jsx(s.Control,{children:e.jsx(m,{autoComplete:"new-password",type:"password",...a})}),e.jsx(s.ErrorMessage,{})]})}),e.jsx(s.Field,{control:r.control,name:"repeat_password",render:({field:a})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{children:i("fields.repeatPassword")}),e.jsx(s.Control,{children:e.jsx(m,{autoComplete:"off",type:"password",...a})}),e.jsx(s.ErrorMessage,{})]})}),r.formState.errors.root&&e.jsx(q,{variant:"error",dismissible:!1,className:"text-balance",children:r.formState.errors.root.message})]}),e.jsx(N,{className:"w-full",type:"submit",isLoading:A||S,disabled:l,children:i("invite.createAccount")})]})}),e.jsx(I,{})]})},Y=()=>{const{t}=x();return e.jsxs("div",{className:"flex w-full flex-col items-center gap-y-6",children:[e.jsxs("div",{className:"flex flex-col items-center gap-y-1",children:[e.jsx(f,{children:t("invite.successTitle")}),e.jsx(p,{size:"small",className:"text-ui-fg-subtle text-center",children:t("invite.successHint")})]}),e.jsx(N,{variant:"secondary",asChild:!0,className:"w-full",children:e.jsx(w,{to:"/login",replace:!0,children:t("invite.successAction")})})]})},G=y({id:o(),jti:o(),exp:j(),iat:j()}),J=t=>G.safeParse(t).success;export{we as Component};
