import{V as D,W as p,Y as g,Z as m,X as q,u as S,j as e,T as A,a1 as P}from"./index-S--WvUSo.js";import{a as f}from"./route-focus-modal-MMx5Xnk0.js";import{t as E}from"./zod-jt04JUtm.js";import{r as K}from"./react-PzSkSLoa.js";import{u as Q,F as d}from"./form-0PHaH8g8.js";import{o as C,s as U}from"./index-JzuMwgWW.js";import{A as R}from"./action-menu-olZwXQ3q.js";import{u as H,a as O,D as z}from"./use-data-table-TeZp00wg.js";import{T as B}from"./Trans-9IhttDMi.js";import{A as Y}from"./arrow-path-LhKlAL5K.js";import{T as k}from"./trash-nTjeUaCp.js";import{u as L}from"./use-prompt-wB0F2CxI.js";import{H as w}from"./heading-cSlef4Su.js";import{I as V}from"./input-A29ux7yj.js";import{B as J}from"./button-Pc5Xo8ua.js";import{T as y}from"./tooltip-Ixyw9oT8.js";import{f as x}from"./format-vrL-wy9v.js";import{S as v}from"./status-badge-sML89E1A.js";import{c as W}from"./index-JDlOzmVl.js";import"./react-dom-Og6--24v.js";import"./react-router-dom-aSYyayiN.js";import"./drawer-H3TI1lDZ.js";import"./index-sF0hA49A.js";import"./prompt-LzbVPZYR.js";import"./information-circle-solid-rXH6vJ5W.js";import"./label-HFq5fzpT.js";import"./empty-table-content-i72rBIA2.js";import"./plus-mini-IRJECoWI.js";import"./index-1Zwdg31z.js";import"./use-date-Putn0_Ur.js";import"./date-picker-s8-9mila.js";import"./minus-E5-czcFC.js";import"./x-mark-mini-aYDSd38M.js";import"./index-7dV3TD85.js";import"./index-Hm2Uj9Gg.js";import"./lodash-5s15_I2H.js";import"./command-bar-wUgfUfvQ.js";const X="invites",c=q(X),Z=(s,r)=>{const{data:t,...i}=D({queryFn:()=>p.invites.list(s),queryKey:c.list(s),...r});return{...t,...i}},G=s=>g({mutationFn:r=>p.invites.create(r),onSuccess:(r,t,i)=>{var a;m.invalidateQueries({queryKey:c.lists()}),(a=s==null?void 0:s.onSuccess)==null||a.call(s,r,t,i)},...s}),$=(s,r)=>g({mutationFn:()=>p.invites.resend(s),onSuccess:(t,i,a)=>{var n;m.invalidateQueries({queryKey:c.lists()}),m.invalidateQueries({queryKey:c.detail(s)}),(n=r==null?void 0:r.onSuccess)==null||n.call(r,t,i,a)},...r}),ee=(s,r)=>g({mutationFn:()=>p.invites.delete(s),onSuccess:(t,i,a)=>{var n;m.invalidateQueries({queryKey:c.lists()}),m.invalidateQueries({queryKey:c.detail(s)}),(n=r==null?void 0:r.onSuccess)==null||n.call(r,t,i,a)},...r}),se=({prefix:s,pageSize:r=20})=>{const t=H(["offset","q","order","created_at","updated_at"],s),{offset:i,created_at:a,updated_at:n,q:l,order:u}=t;return{searchParams:{limit:r,offset:i?Number(i):0,order:u,created_at:a?JSON.parse(a):void 0,updated_at:n?JSON.parse(n):void 0,q:l},raw:t}},re=C({email:U().email()}),h=10,M="usr_invite",te=()=>{const{t:s}=S(),r=Q({defaultValues:{email:""},resolver:E(re)}),{raw:t,searchParams:i}=se({prefix:M,pageSize:h}),{invites:a,count:n,isPending:l,isError:u,error:I}=Z(i),b=ie(),{table:T}=O({data:a??[],columns:b,count:n,enablePagination:!0,getRowId:o=>o.id,pageSize:h}),{mutateAsync:_,isPending:N}=G(),F=r.handleSubmit(async o=>{await _({email:o.email},{onSuccess:()=>{r.reset()}})});if(u)throw I;return e.jsx(f.Form,{form:r,children:e.jsxs("form",{onSubmit:F,className:"flex h-full flex-col overflow-hidden",children:[e.jsx(f.Header,{}),e.jsx(f.Body,{className:"flex flex-1 flex-col overflow-hidden",children:e.jsx("div",{className:"flex flex-1 flex-col items-center overflow-y-auto",children:e.jsxs("div",{className:"flex w-full max-w-[720px] flex-col gap-y-8 px-2 py-16",children:[e.jsxs("div",{children:[e.jsx(w,{children:s("users.inviteUser")}),e.jsx(A,{size:"small",className:"text-ui-fg-subtle",children:s("users.inviteUserHint")})]}),e.jsxs("div",{className:"flex flex-col gap-y-4",children:[e.jsx("div",{className:"grid grid-cols-2 gap-4",children:e.jsx(d.Field,{control:r.control,name:"email",render:({field:o})=>e.jsxs(d.Item,{children:[e.jsx(d.Label,{children:s("fields.email")}),e.jsx(d.Control,{children:e.jsx(V,{...o})}),e.jsx(d.ErrorMessage,{})]})})}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx(J,{size:"small",variant:"secondary",type:"submit",isLoading:N,children:s("users.sendInvite")})})]}),e.jsxs("div",{className:"flex flex-col gap-y-4",children:[e.jsx(w,{level:"h2",children:s("users.pendingInvites")}),e.jsx(P,{className:"overflow-hidden p-0",children:e.jsx(z,{table:T,columns:b,count:n,pageSize:h,prefix:M,pagination:!0,search:!0,isLoading:l,queryObject:t,orderBy:["email","created_at","updated_at"]})})]})]})})})]})})},ae=({invite:s})=>{const{mutateAsync:r}=ee(s.id),{mutateAsync:t}=$(s.id),i=L(),{t:a}=S(),n=async()=>{await i({title:a("general.areYouSure"),description:a("users.deleteInviteWarning",{email:s.email}),cancelText:a("actions.cancel"),confirmText:a("actions.delete")})&&await r()},l=async()=>{await t()};return e.jsx(R,{groups:[{actions:[{icon:e.jsx(Y,{}),label:a("users.resendInvite"),onClick:l}]},{actions:[{icon:e.jsx(k,{}),label:a("actions.delete"),onClick:n}]}]})},j=W(),ie=()=>{const{t:s}=S();return K.useMemo(()=>[j.accessor("email",{header:s("fields.email"),cell:({getValue:r})=>r()}),j.accessor("accepted",{header:s("fields.status"),cell:({getValue:r,row:t})=>{const i=r(),a=new Date(t.original.expires_at)<new Date;return i?e.jsx(y,{content:s("users.acceptedOnDate",{date:x(new Date(t.original.updated_at),"dd MMM, yyyy")}),children:e.jsx(v,{color:"green",children:s("users.inviteStatus.accepted")})}):a?e.jsx(y,{content:s("users.expiredOnDate",{date:x(new Date(t.original.expires_at),"dd MMM, yyyy")}),children:e.jsx(v,{color:"red",children:s("users.inviteStatus.expired")})}):e.jsx(y,{content:e.jsx(B,{i18nKey:"users.validFromUntil",components:[e.jsx("span",{className:"font-medium"},"from"),e.jsx("span",{className:"font-medium"},"untill")],values:{from:x(new Date(t.original.created_at),"dd MMM, yyyy"),until:x(new Date(t.original.expires_at),"dd MMM, yyyy")}}),children:e.jsx(v,{color:"orange",children:s("users.inviteStatus.pending")})})}}),j.display({id:"actions",cell:({row:r})=>e.jsx(ae,{invite:r.original})})],[s])},Be=()=>e.jsx(f,{children:e.jsx(te,{})});export{Be as Component};
