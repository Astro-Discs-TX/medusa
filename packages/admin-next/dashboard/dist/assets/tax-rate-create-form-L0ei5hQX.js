import{u as N,j as t,T as se,bP as ie,d as de,aa as Y}from"./index-S--WvUSo.js";import{t as ue}from"./zod-jt04JUtm.js";import{u as pe,a as z,F as m}from"./form-0PHaH8g8.js";import{o as oe,b as L,a as me,s as M,n as fe}from"./index-JzuMwgWW.js";import{r as S}from"./react-PzSkSLoa.js";import{b as he}from"./react-router-dom-aSYyayiN.js";import{P as ge}from"./percentage-input-hee_tAkG.js";import{S as X}from"./split-view-l-bJVVse.js";import{u as xe,a as J}from"./route-focus-modal-MMx5Xnk0.js";import{d as Ce}from"./tax-rates-TgwHqykr.js";import{b as Se}from"./tax-regions-jathV60U.js";import{u as re,a as q,D as $}from"./use-data-table-TeZp00wg.js";import{b as _e,u as Pe,a as je}from"./use-product-table-columns-k99B-kCF.js";import{C as U}from"./checkbox-8MlXzZCx.js";import{c as B}from"./index-JDlOzmVl.js";import{a as be,u as Te}from"./use-customer-group-table-columns-uQ7G548z.js";import{c as ye}from"./collections-1ZxhMSyG.js";import{u as ve}from"./customer-groups-G4KCvF3b.js";import{u as we}from"./product-types-gZDu6wo-.js";import{f as Oe}from"./products-_PEbH1CR.js";import{B as E}from"./button-Pc5Xo8ua.js";import{L as Re}from"./list-summary-5vNt7oxx.js";import{H as ke}from"./heading-cSlef4Su.js";import{S as G}from"./select-Z4sV_-wF.js";import{I as ne}from"./input-A29ux7yj.js";import{S as Ie}from"./switch-VR1xZXYU.js";const De=2;function Ue({labels:o,type:s,onClick:e}){const{t:a}=N(),_=!!o.length;return t.jsx("div",{className:"text-center",children:t.jsxs("div",{className:"bg-ui-bg-field shadow-borders-base inline-flex items-center divide-x overflow-hidden rounded-md",children:[t.jsxs(se,{as:"span",size:"small",leading:"compact",weight:"plus",className:"text-ui-fg-muted shrink-0 px-2 py-1",children:[a("taxRates.fields.appliesTo")," ",a(`taxRates.fields.${s}`)]}),t.jsx("div",{className:"text-ui-fg-subtle max-w-[240px] shrink-0",children:t.jsx(E,{type:"button",variant:"transparent",size:"small",disabled:_,onClick:()=>e(),className:"txt-compact-small-plus disabled:text-ui-fg-subtle rounded-none",children:o.length&&t.jsx(Re,{inline:!0,n:De,className:"!txt-compact-small-plus max-w-[200px]",list:o})})})]})})}const Ne=B(),Ae=()=>{const o=_e();return S.useMemo(()=>[Ne.display({id:"select",header:({table:s})=>t.jsx(U,{checked:s.getIsSomePageRowsSelected()?"indeterminate":s.getIsAllPageRowsSelected(),onCheckedChange:e=>s.toggleAllPageRowsSelected(!!e)}),cell:({row:s})=>t.jsx(U,{checked:s.getIsSelected(),onCheckedChange:e=>s.toggleSelected(!!e),onClick:e=>{e.stopPropagation()}})}),...o],[o])},Ee=B(),ze=()=>{const o=be();return S.useMemo(()=>[Ee.display({id:"select",header:({table:s})=>t.jsx(U,{checked:s.getIsSomePageRowsSelected()?"indeterminate":s.getIsAllPageRowsSelected(),onCheckedChange:e=>s.toggleAllPageRowsSelected(!!e)}),cell:({row:s})=>t.jsx(U,{checked:s.getIsSelected(),onCheckedChange:e=>s.toggleSelected(!!e),onClick:e=>{e.stopPropagation()}})}),...o],[o])},Le=()=>{const{t:o}=N();return[{label:o("fields.createdAt"),key:"created_at"},{label:o("fields.updatedAt"),key:"updated_at"}].map(e=>({key:e.key,label:e.label,type:"date"}))},ae=B(),Ge=()=>{const{t:o}=N();return S.useMemo(()=>[ae.display({id:"select",header:({table:s})=>t.jsx(U,{checked:s.getIsSomePageRowsSelected()?"indeterminate":s.getIsAllPageRowsSelected(),onCheckedChange:e=>s.toggleAllPageRowsSelected(!!e)}),cell:({row:s})=>t.jsx(U,{checked:s.getIsSelected(),onCheckedChange:e=>s.toggleSelected(!!e),onClick:e=>{e.stopPropagation()}})}),ae.accessor("value",{header:o("fields.value"),cell:({getValue:s})=>s()})],[o])},Fe=()=>{const{t:o}=N();return[{label:o("fields.createdAt"),key:"created_at"},{label:o("fields.updatedAt"),key:"updated_at"}].map(e=>({key:e.key,label:e.label,type:"date"}))},Me=({pageSize:o=50,prefix:s})=>{const e=re(["offset","q","order","created_at","updated_at"],s);return{searchParams:{limit:o,offset:e.offset?Number(e.offset):0,q:e.q,created_at:e.created_at?JSON.parse(e.created_at):void 0,updated_at:e.updated_at?JSON.parse(e.updated_at):void 0,order:e.order},raw:e}},Q=B(),qe=()=>{const{t:o}=N();return S.useMemo(()=>[Q.display({id:"select",header:({table:s})=>t.jsx(U,{checked:s.getIsSomePageRowsSelected()?"indeterminate":s.getIsAllPageRowsSelected(),onCheckedChange:e=>s.toggleAllPageRowsSelected(!!e)}),cell:({row:s})=>t.jsx(U,{checked:s.getIsSelected(),onCheckedChange:e=>s.toggleSelected(!!e),onClick:e=>{e.stopPropagation()}})}),Q.accessor("title",{header:o("fields.title")}),Q.accessor("handle",{header:o("fields.handle"),cell:({getValue:s})=>`/${s()}`}),Q.accessor("products",{header:o("fields.products"),cell:({getValue:s})=>{var a;const e=(a=s())==null?void 0:a.length;return t.jsx("span",{children:e||"-"})}})],[o])},$e=()=>{const{t:o}=N();return[{label:o("fields.createdAt"),key:"created_at"},{label:o("fields.updatedAt"),key:"updated_at"}].map(e=>({key:e.key,label:e.label,type:"date"}))},Be=({pageSize:o=50,prefix:s})=>{const e=re(["offset","q","order","title","handle","discount_condition_id","created_at","updated_at"],s);return{searchParams:{limit:o,offset:e.offset?Number(e.offset):0,q:e.q,title:e.title,handle:e.handle,discount_condition_id:e.discount_condition_id,created_at:e.created_at?JSON.parse(e.created_at):void 0,updated_at:e.updated_at?JSON.parse(e.updated_at):void 0,order:e.order},raw:e}},le=B(),He=()=>{const{t:o}=N();return S.useMemo(()=>[le.display({id:"select",header:({table:s})=>t.jsx(U,{checked:s.getIsSomePageRowsSelected()?"indeterminate":s.getIsAllPageRowsSelected(),onCheckedChange:e=>s.toggleAllPageRowsSelected(!!e)}),cell:({row:s})=>t.jsx(U,{checked:s.getIsSelected(),onCheckedChange:e=>s.toggleSelected(!!e),onClick:e=>{e.stopPropagation()}})}),le.accessor("value",{header:o("fields.value")})],[o])},Ve=()=>{const{t:o}=N();return[{label:o("fields.createdAt"),key:"created_at"},{label:o("fields.updatedAt"),key:"updated_at"}].map(e=>({key:e.key,label:e.label,type:"date"}))},Ye=({pageSize:o=50,prefix:s})=>{const e=re(["offset","q","order","value","discount_condition_id","created_at","updated_at"],s);return{searchParams:{limit:o,offset:e.offset?Number(e.offset):0,q:e.q,discount_condition_id:e.discount_condition_id,created_at:e.created_at?JSON.parse(e.created_at):void 0,updated_at:e.updated_at?JSON.parse(e.updated_at):void 0,order:e.order},raw:e}};var u=(o=>(o.PRODUCT="products",o.PRODUCT_TYPE="product_types",o.PRODUCT_COLLECTION="product_collections",o.PRODUCT_TAG="product_tags",o.CUSTOMER_GROUP="customer_groups",o))(u||{});const b=50,W="product",K="product_type",ee="product_collection",ce="customer_group",te="customer_group",H=(o=[])=>o.reduce((s,{value:e})=>(s[e]=!0,s),{}),V=({onSave:o})=>{const{t:s}=N();return t.jsxs("div",{className:"flex items-center justify-end gap-x-2 border-t p-4",children:[t.jsx(X.Close,{type:"button",asChild:!0,children:t.jsx(E,{variant:"secondary",size:"small",children:s("actions.cancel")})}),t.jsx(E,{size:"small",type:"button",onClick:o,children:s("actions.save")})]})},Je=({selected:o=[],onSave:s})=>{const[e,a]=S.useState(H(o)),[_,h]=S.useState(o),{searchParams:v,raw:w}=Pe({pageSize:b,prefix:W}),{products:d,count:g,isLoading:O,isError:T,error:R}=Oe({...v},{keepPreviousData:!0}),y=c=>{const l=typeof c=="function"?c(e):c,f=Object.keys(l).filter(r=>l[r]!==e[r]);if(f.length){const r=(d==null?void 0:d.filter(i=>f.includes(i.id)))??[];if(r.length>0){const i=r.map(p=>({label:p.title,value:p.id}));h(p=>{const D=p.filter(n=>n.value in l);return Array.from(new Set([...D,...i]))})}a(l)}const x=Object.keys(e).filter(r=>l[r]!==e[r]);x.length&&(h(r=>r.filter(i=>!x.includes(i.value))),a(l))},j=()=>{s(_)},P=Ae(),k=je(),{table:I}=q({data:d??[],columns:P,count:g,enablePagination:!0,getRowId:c=>c.id,pageSize:b,enableRowSelection:!0,rowSelection:{state:e,updater:y},prefix:W});if(T)throw R;return t.jsxs("div",{className:"flex size-full flex-col overflow-hidden",children:[t.jsx($,{table:I,columns:P,pageSize:b,count:g,queryObject:w,pagination:!0,search:!0,filters:k,isLoading:O,layout:"fill",orderBy:["title","created_at","updated_at"],prefix:W}),t.jsx(V,{onSave:j})]})},Qe=({selected:o=[],onSave:s})=>{const[e,a]=S.useState(H(o)),[_,h]=S.useState(o),{searchParams:v,raw:w}=Te({pageSize:b,prefix:W}),{customer_groups:d,count:g,isLoading:O,isError:T,error:R}=ve({...v},{keepPreviousData:!0}),y=c=>{const l=typeof c=="function"?c(e):c,f=Object.keys(l).filter(r=>l[r]!==e[r]);if(f.length){const r=(d==null?void 0:d.filter(i=>f.includes(i.id)))??[];if(r.length>0){const i=r.map(p=>({label:p.name,value:p.id}));h(p=>{const D=p.filter(n=>n.value in l);return Array.from(new Set([...D,...i]))})}a(l)}const x=Object.keys(e).filter(r=>l[r]!==e[r]);x.length&&(h(r=>r.filter(i=>!x.includes(i.value))),a(l))},j=()=>{s(_)},P=ze(),k=Le(),{table:I}=q({data:d??[],columns:P,count:g,enablePagination:!0,getRowId:c=>c.id,pageSize:b,enableRowSelection:!0,rowSelection:{state:e,updater:y},prefix:ce});if(T)throw R;return t.jsxs("div",{className:"flex size-full flex-col overflow-hidden",children:[t.jsx($,{table:I,columns:P,pageSize:b,count:g,queryObject:w,pagination:!0,search:!0,filters:k,isLoading:O,layout:"fill",orderBy:["name","created_at","updated_at"],prefix:ce}),t.jsx(V,{onSave:j})]})},Xe=({onSave:o,selected:s=[]})=>{const[e,a]=S.useState(H(s)),[_,h]=S.useState(s),{searchParams:v,raw:w}=Me({pageSize:b,prefix:K}),{product_types:d,count:g,isLoading:O,isError:T,error:R}=we({...v},{keepPreviousData:!0}),y=c=>{const l=typeof c=="function"?c(e):c,f=Object.keys(l).filter(r=>l[r]!==e[r]);if(f.length){const r=(d==null?void 0:d.filter(i=>f.includes(i.id)))??[];if(r.length>0){const i=r.map(p=>({label:p.value,value:p.id}));h(p=>{const D=p.filter(n=>n.value in l);return Array.from(new Set([...D,...i]))})}a(l)}const x=Object.keys(e).filter(r=>l[r]!==e[r]);x.length&&(h(r=>r.filter(i=>!x.includes(i.value))),a(l))},j=()=>{o(_)},P=Ge(),k=Fe(),{table:I}=q({data:d??[],columns:P,count:g,enablePagination:!0,getRowId:c=>c.id,pageSize:b,enableRowSelection:!0,rowSelection:{state:e,updater:y},prefix:K});if(T)throw R;return t.jsxs("div",{className:"flex size-full flex-col overflow-hidden",children:[t.jsx($,{table:I,columns:P,pageSize:b,count:g,queryObject:w,pagination:!0,search:!0,filters:k,isLoading:O,layout:"fill",orderBy:["value","created_at","updated_at"],prefix:K}),t.jsx(V,{onSave:j})]})},We=({onSave:o,selected:s=[]})=>{const[e,a]=S.useState(H(s)),[_,h]=S.useState(s),{searchParams:v,raw:w}=Be({pageSize:b,prefix:ee}),{collections:d,count:g,isPending:O,isError:T,error:R}=ye({...v},{keepPreviousData:!0}),y=c=>{const l=typeof c=="function"?c(e):c,f=Object.keys(l).filter(r=>l[r]!==e[r]);if(f.length){const r=(d==null?void 0:d.filter(i=>f.includes(i.id)))??[];if(r.length>0){const i=r.map(p=>({label:p.title,value:p.id}));h(p=>{const D=p.filter(n=>n.value in l);return Array.from(new Set([...D,...i]))})}a(l)}const x=Object.keys(e).filter(r=>l[r]!==e[r]);x.length&&(h(r=>r.filter(i=>!x.includes(i.value))),a(l))},j=()=>{o(_)},P=qe(),k=$e(),{table:I}=q({data:d??[],columns:P,count:g,enablePagination:!0,getRowId:c=>c.id,pageSize:b,enableRowSelection:!0,rowSelection:{state:e,updater:y},prefix:ee});if(T)throw R;return t.jsxs("div",{className:"flex size-full flex-col overflow-hidden",children:[t.jsx($,{table:I,columns:P,pageSize:b,count:g,queryObject:w,pagination:!0,search:!0,filters:k,isLoading:O,layout:"fill",orderBy:["title","handle","created_at","updated_at"],prefix:ee}),t.jsx(V,{onSave:j})]})},Ze=({onSave:o,selected:s=[]})=>{const[e,a]=S.useState(H(s)),[_,h]=S.useState(s),{searchParams:v,raw:w}=Ye({pageSize:b,prefix:te}),{product_tags:d,count:g,isLoading:O,isError:T,error:R}=ie({...v},{keepPreviousData:!0}),y=c=>{const l=typeof c=="function"?c(e):c,f=Object.keys(l).filter(r=>l[r]!==e[r]);if(f.length){const r=(d==null?void 0:d.filter(i=>f.includes(i.id)))??[];if(r.length>0){const i=r.map(p=>({label:p.value,value:p.id}));h(p=>{const D=p.filter(n=>n.value in l);return Array.from(new Set([...D,...i]))})}a(l)}const x=Object.keys(e).filter(r=>l[r]!==e[r]);x.length&&(h(r=>r.filter(i=>!x.includes(i.value))),a(l))},j=()=>{o(_)},P=He(),k=Ve(),{table:I}=q({data:d??[],columns:P,count:g,enablePagination:!0,getRowId:c=>c.id,pageSize:b,enableRowSelection:!0,rowSelection:{state:e,updater:y},prefix:te});if(T)throw R;return t.jsxs("div",{className:"flex size-full flex-col overflow-hidden",children:[t.jsx($,{table:I,columns:P,pageSize:b,count:g,queryObject:w,pagination:!0,search:!0,filters:k,isLoading:O,layout:"fill",orderBy:["title","handle","created_at","updated_at"],prefix:te}),t.jsx(V,{onSave:j})]})},Ke=({product:o,productType:s,customerGroup:e,productCollection:a,productTag:_,selected:h})=>{switch(h){case u.PRODUCT:return t.jsx(Je,{...o});case u.PRODUCT_TYPE:return t.jsx(Xe,{...s});case u.PRODUCT_COLLECTION:return t.jsx(We,{...a});case u.PRODUCT_TAG:return t.jsx(Ze,{..._});case u.CUSTOMER_GROUP:return t.jsx(Qe,{...e});default:return null}},et=oe({[u.PRODUCT]:L(),[u.PRODUCT_COLLECTION]:L(),[u.PRODUCT_TAG]:L(),[u.PRODUCT_TYPE]:L(),[u.CUSTOMER_GROUP]:L()}),F=me(oe({label:M(),value:M()})),tt=oe({tax_region_id:M(),name:M(),code:M(),rate:fe(),is_combinable:L().default(!1),selected_condition_types:et,products:F,product_types:F,product_collections:F,product_tags:F,customer_groups:F}),Ot=({taxRegion:o})=>{const{t:s}=N(),{handleSuccess:e}=xe(),a=pe({defaultValues:{selected_condition_types:{[u.PRODUCT]:!0,[u.PRODUCT_TYPE]:!1,[u.PRODUCT_COLLECTION]:!1,[u.PRODUCT_TAG]:!1,[u.CUSTOMER_GROUP]:!1},products:[],product_types:[],product_collections:[],product_tags:[],customer_groups:[]},resolver:ue(tt)}),{tax_regions:_}=Se({parent_id:o.id,province_code:{$ne:"null"}}),{mutateAsync:h,isPending:v}=Ce(),w=a.handleSubmit(async n=>{var C;await h({name:n.name,code:n.code,rate:n.rate,is_combinable:n.is_combinable,tax_region_id:n.tax_region_id,rules:((C=n.products)==null?void 0:C.map(A=>({reference:"product",reference_id:A.value})))||[]},{onSuccess:()=>e(`/settings/taxes/${o.id}`)})}),[d,g]=S.useState(!1),[O,T]=S.useState(!1),[R,y]=S.useState(null),j=z({name:"selected_condition_types",control:a.control}),P=z({control:a.control,name:"products"}),k=z({control:a.control,name:"product_collections"}),I=z({control:a.control,name:"product_types"}),c=z({control:a.control,name:"product_tags"}),l=z({control:a.control,name:"customer_groups"}),f=n=>C=>{a.setValue(n,C,{shouldDirty:!0,shouldTouch:!0}),g(!1)},x=Object.keys(j||{}).filter(n=>j[n]).sort(),r=n=>{const C={...a.getValues().selected_condition_types};C[n]?delete C[n]:C[n]=!0,a.setValue("selected_condition_types",C,{shouldDirty:!0,shouldTouch:!0})},i=()=>{a.setValue("selected_condition_types",{[u.PRODUCT]:!1,[u.PRODUCT_TYPE]:!1,[u.PRODUCT_COLLECTION]:!1,[u.PRODUCT_TAG]:!1,[u.CUSTOMER_GROUP]:!1},{shouldDirty:!0,shouldTouch:!0})},[,p]=he(),D=n=>{n||(y(null),p({},{replace:!0})),g(n)};return t.jsx(J.Form,{form:a,children:t.jsxs("form",{onSubmit:w,className:"flex h-full flex-col",children:[t.jsx(J.Header,{children:t.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[t.jsx(J.Close,{asChild:!0,children:t.jsx(E,{variant:"secondary",size:"small",children:s("actions.cancel")})}),t.jsx(E,{type:"submit",size:"small",isLoading:v,children:s("actions.save")})]})}),t.jsx(J.Body,{className:"flex h-full w-full flex-col items-center overflow-hidden",children:t.jsxs(X,{open:d,onOpenChange:D,children:[t.jsx(X.Content,{children:t.jsx("div",{className:de("flex flex-col overflow-auto py-16",{"items-center":!d}),children:t.jsxs("div",{className:"flex w-full max-w-[720px] flex-col gap-y-8",children:[t.jsxs("div",{children:[t.jsx(ke,{className:"text-left",children:s("taxRates.create.title")}),t.jsx(se,{className:"text-ui-fg-subtle txt-small",children:s("taxRates.create.description")})]}),t.jsx(m.Field,{control:a.control,name:"tax_region_id",render:({field:{ref:n,onChange:C,...A}})=>t.jsxs(m.Item,{children:[t.jsx(m.Label,{children:s("fields.province")}),t.jsx(m.Control,{children:t.jsxs(G,{...A,onValueChange:C,children:[t.jsx(G.Trigger,{ref:n,children:t.jsx(G.Value,{})}),t.jsx(G.Content,{children:_==null?void 0:_.map(Z=>t.jsx(G.Item,{value:Z.id,children:Z.province_code},Z.id))})]})}),t.jsx(m.ErrorMessage,{})]})}),t.jsx(m.Field,{control:a.control,name:"name",render:({field:n})=>t.jsxs(m.Item,{children:[t.jsx(m.Label,{children:s("fields.name")}),t.jsx(m.Control,{children:t.jsx(ne,{...n})})]})}),t.jsx(m.Field,{control:a.control,name:"rate",render:({field:n})=>t.jsxs(m.Item,{children:[t.jsx(m.Label,{children:s("fields.rate")}),t.jsx(m.Control,{children:t.jsx(ge,{...n,value:n.value,onChange:C=>{C.target.value&&n.onChange(parseInt(C.target.value))}})})]})}),t.jsx(m.Field,{control:a.control,name:"code",render:({field:n})=>t.jsxs(m.Item,{children:[t.jsx(m.Label,{children:s("fields.code")}),t.jsx(m.Control,{children:t.jsx(ne,{...n})})]})}),o.parent_id&&t.jsx(m.Field,{control:a.control,name:"is_combinable",render:({field:{value:n,onChange:C,...A}})=>t.jsxs(m.Item,{children:[t.jsx(m.Label,{children:s("taxRates.fields.isCombinable")}),t.jsx(m.Control,{children:t.jsx(Ie,{...A,checked:n,onCheckedChange:C})})]})}),t.jsxs("div",{className:"flex flex-col gap-y-8",children:[x.length>0&&t.jsx("div",{className:"flex flex-col items-start gap-y-4",children:x.map(n=>{if(n in(j||{})){const C=a.getValues(n)||[];return t.jsx(Ue,{type:n,labels:C.map(A=>A.label),onClick:()=>{y(n),g(!0)}},n)}})}),t.jsxs("div",{className:"flex items-center gap-x-2",children:[t.jsxs(Y,{open:O,onOpenChange:n=>{n&&T(n)},children:[t.jsx(Y.Trigger,{asChild:!0,children:t.jsx(E,{variant:"secondary",size:"small",children:s("discounts.conditions.manageTypesAction")})}),t.jsx(Y.Content,{onInteractOutside:n=>{T(!0)},children:Object.values(u).map(n=>t.jsx(Y.CheckboxItem,{checked:j[n],onCheckedChange:()=>r(n),children:t.jsx(se,{size:"small",weight:j[n]?"plus":"regular",children:s(`fields.${n}`)})},n))})]}),x.length>0&&t.jsx(E,{variant:"transparent",size:"small",type:"button",onClick:i,className:"text-ui-fg-muted hover:text-ui-fg-subtle",children:s("actions.clearAll")})]})]})]})})}),t.jsx(X.Drawer,{children:t.jsx(Ke,{product:{selected:P,onSave:f(u.PRODUCT)},productCollection:{selected:k,onSave:f(u.PRODUCT_COLLECTION)},productType:{selected:I,onSave:f(u.PRODUCT_TYPE)},productTag:{selected:c,onSave:f(u.PRODUCT_TAG)},customerGroup:{selected:l,onSave:f(u.CUSTOMER_GROUP)},selected:R})})]})})]})})};export{u as C,Ot as T,Ue as a,Ke as b};
