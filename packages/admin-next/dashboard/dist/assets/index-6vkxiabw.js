import{u as b,a2 as E,j as e,T as L}from"./index-S--WvUSo.js";import{t as C}from"./zod-jt04JUtm.js";import{u as I,F as a}from"./form-0PHaH8g8.js";import{d as S}from"./index.modern-Pe_E-6H8.js";import{a as O,c as F,L as v,N as M}from"./react-router-dom-aSYyayiN.js";import{o as R,s as u,Z as $}from"./index-JzuMwgWW.js";import{r as m}from"./react-PzSkSLoa.js";import{L as D}from"./logo-box-TfH3D5h8.js";import{T as _}from"./Trans-9IhttDMi.js";import{H}from"./heading-cSlef4Su.js";import{I as w}from"./input-A29ux7yj.js";import{B as j}from"./button-Pc5Xo8ua.js";import"./react-dom-Og6--24v.js";import"./information-circle-solid-rXH6vJ5W.js";import"./label-HFq5fzpT.js";import"./tooltip-Ixyw9oT8.js";import"./motion-jlFaYIfJ.js";var B=Object.defineProperty,p=Object.getOwnPropertySymbols,P=Object.prototype.hasOwnProperty,y=Object.prototype.propertyIsEnumerable,g=(s,t,r)=>t in s?B(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,Z=(s,t)=>{for(var r in t||(t={}))P.call(t,r)&&g(s,r,t[r]);if(p)for(var r of p(t))y.call(t,r)&&g(s,r,t[r]);return s},z=(s,t)=>{var r={};for(var o in s)P.call(s,o)&&t.indexOf(o)<0&&(r[o]=s[o]);if(s!=null&&p)for(var o of p(s))t.indexOf(o)<0&&y.call(s,o)&&(r[o]=s[o]);return r};const N=m.forwardRef((s,t)=>{var r=s,{color:o="currentColor"}=r,n=z(r,["color"]);return m.createElement("svg",Z({xmlns:"http://www.w3.org/2000/svg",width:20,height:20,fill:"none",ref:t},n),m.createElement("path",{stroke:o,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M10 5.833v4.375l2.5 1.459m5-1.667a7.5 7.5 0 1 1-15 0 7.5 7.5 0 0 1 15 0Z"}))});N.displayName="Clock";const K=R({email:u().email(),new_password:u(),repeat_new_password:u()}).superRefine(({new_password:s,repeat_new_password:t},r)=>{s!==t&&r.addIssue({code:$.custom,message:"Passwords do not match",path:["repeat_new_password"]})}),de=()=>{const{t:s}=b(),t=O(),{token:r}=F();let o="valid";const n=r?S(r):null;n||(o="invalid");const d=n?new Date(n.exp*1e3):null;d&&d<new Date&&(o="expired");const c=`/reset-password${n?`?email=${n.email}`:""}`,i=I({resolver:C(K),defaultValues:{email:(n==null?void 0:n.email)||"",new_password:"",repeat_new_password:""}}),{mutateAsync:f,isLoading:h}=E({retry:!1}),x=i.handleSubmit(async({new_password:l})=>{await f({password:l,token:r},{onSuccess:()=>{t("/orders")},onError:W=>{i.setError("root",{type:"manual",message:s("errors.serverError")})}})}),[T,k]={valid:[s("resetPassword.title"),s("resetPassword.newPasswordHint")],invalid:[s("resetPassword.invalidTokenTitle"),s("resetPassword.invalidTokenHint")],expired:[s("resetPassword.expiredTokenTitle"),s("resetPassword.invalidTokenHint")]}[o];return e.jsx("div",{className:"min-h-dvh w-dvw bg-ui-bg-base flex items-center justify-center",children:e.jsxs("div",{className:"m-4 flex w-full max-w-[300px] flex-col items-center",children:[e.jsx(D,{className:"mb-4"}),e.jsxs("div",{className:"mb-4 flex flex-col items-center",children:[e.jsx(H,{children:T}),e.jsx(L,{size:"small",className:"text-ui-fg-subtle text-pretty text-center",children:k})]}),o==="valid"?e.jsx(a,{...i,children:e.jsxs("form",{onSubmit:x,className:"flex w-full flex-col gap-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-y-4",children:[e.jsx(a.Field,{control:i.control,name:"email",render:({field:l})=>e.jsxs(a.Item,{children:[e.jsx(a.Label,{children:s("fields.email")}),e.jsx(a.Control,{children:e.jsx(w,{autoComplete:"off",...l,disabled:!0})}),e.jsx(a.ErrorMessage,{})]})}),e.jsx(a.Field,{control:i.control,name:"new_password",render:({field:l})=>e.jsxs(a.Item,{children:[e.jsx(a.Label,{children:s("fields.newPassword")}),e.jsx(a.Control,{children:e.jsx(w,{autoComplete:"new-password",type:"password",...l})}),e.jsx(a.ErrorMessage,{})]})}),e.jsx(a.Field,{control:i.control,name:"repeat_new_password",render:({field:l})=>e.jsxs(a.Item,{children:[e.jsx(a.Label,{children:s("fields.repeatNewPassword")}),e.jsx(a.Control,{children:e.jsx(w,{autoComplete:"off",type:"password",...l})}),e.jsx(a.ErrorMessage,{})]})}),i.formState.errors.root&&e.jsx("span",{children:i.formState.errors.root.message})]}),e.jsx(j,{className:"w-full",type:"submit",isLoading:h,children:s("resetPassword.resetPassword")}),d&&e.jsx(V,{expiresAt:d})]})}):e.jsx(j,{variant:"secondary",asChild:!0,className:"w-full",children:e.jsx(v,{to:c,replace:!0,children:s("resetPassword.goToResetPassword")})}),e.jsx("div",{className:"my-6 h-px w-full border-b border-dotted"}),e.jsx("span",{className:"text-ui-fg-subtle txt-small",children:e.jsx(_,{t:s,i18nKey:"resetPassword.backToLogin",components:[e.jsx(v,{to:"/login",className:"text-ui-fg-interactive transition-fg hover:text-ui-fg-interactive-hover focus-visible:text-ui-fg-interactive-hover outline-none"},"login-link")]})})]})})},V=({expiresAt:s})=>{const{t}=b(),[r,o]=m.useState(Math.floor((s.getTime()-Date.now())/1e3)),n=15*60;m.useEffect(()=>{const x=setInterval(()=>{o(Math.floor((s.getTime()-Date.now())/1e3))},1e3);return()=>clearInterval(x)},[s]);const d=Math.floor(r/60),c=r%60,i=`${d}:${c<10?`0${c}`:c}`,f=(r/n*100).toFixed(2);return r<=0?e.jsx(M,{to:".",replace:!0}):e.jsxs("div",{className:"bg-ui-bg-subtle border-ui-border-base txt-compact-small relative w-full rounded-lg border p-2",children:[e.jsx("div",{className:"absolute inset-0 flex overflow-hidden rounded-lg",children:e.jsx("div",{className:"bg-ui-bg-subtle-hover h-full transition-[width]",style:{width:`${f}%`}})}),e.jsxs("div",{className:"text-ui-fg-subtle relative z-10 flex items-center gap-x-2",children:[e.jsx(N,{className:"text-ui-tag-neutral-icon"}),e.jsx("span",{children:e.jsx(_,{t,i18nKey:"resetPassword.tokenExpiresIn",values:{time:i},components:[e.jsx("span",{className:"tabular-nums"},"countdown")]})})]})]})};export{de as Component};
