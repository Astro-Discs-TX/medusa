import{u as F,j as e,T as _}from"./index-S--WvUSo.js";import{u as R,R as d}from"./route-focus-modal-MMx5Xnk0.js";import{u as q,F as t}from"./form-0PHaH8g8.js";import{a as w,b as I}from"./reservations-e8r1gx2W.js";import{z as j}from"./index-JzuMwgWW.js";import{t as k}from"./zod-jt04JUtm.js";import{t as C}from"./toast-4oQfF9Sm.js";import{S as u}from"./select-Z4sV_-wF.js";import{I as E}from"./input-A29ux7yj.js";import{T as N}from"./textarea-D4fuXHvE.js";import{B as S}from"./button-Pc5Xo8ua.js";import{u as T}from"./inventory-EQcmxo3i.js";import{u as L}from"./stock-locations-5f5MPAbM.js";import{c as z}from"./react-router-dom-aSYyayiN.js";import{H as M}from"./heading-cSlef4Su.js";import"./react-PzSkSLoa.js";import"./react-dom-Og6--24v.js";import"./drawer-H3TI1lDZ.js";import"./index-sF0hA49A.js";import"./prompt-LzbVPZYR.js";import"./information-circle-solid-rXH6vJ5W.js";import"./label-HFq5fzpT.js";import"./tooltip-Ixyw9oT8.js";import"./x-circle-solid-rnqhxvfk.js";import"./check-circle-solid-7j4QonPK.js";import"./index-Hm2Uj9Gg.js";import"./triangles-mini-HukRlWGp.js";const V=j.object({location_id:j.string(),description:j.string().optional(),quantity:j.number().min(1)}),f=({title:o,value:a})=>e.jsxs("div",{className:"grid grid-cols-2 divide-x",children:[e.jsx(_,{className:"px-2 py-1.5",size:"small",leading:"compact",children:o}),e.jsx(_,{className:"px-2 py-1.5",size:"small",leading:"compact",children:a})]}),A=o=>({quantity:o.quantity,location_id:o.location_id,description:o.description??void 0}),B=({reservation:o,item:a,locations:l})=>{const{t:s}=F(),{handleSuccess:h}=R(),n=q({defaultValues:A(o),resolver:k(V)}),{mutateAsync:i}=w(o.id),x=n.handleSubmit(async r=>{i(r,{onSuccess:()=>{h(),C.success(s("general.success"),{dismissLabel:s("actions.close"),description:s("inventory.reservation.updateSuccessToast")})}})}),v=n.watch("quantity"),p=n.watch("location_id"),m=a.location_levels.find(r=>r.location_id===p);return e.jsx(d.Form,{form:n,children:e.jsxs("form",{onSubmit:x,className:"flex flex-1 flex-col overflow-hidden",children:[e.jsxs(d.Body,{className:"flex flex-1 flex-col gap-y-8 overflow-auto",children:[e.jsx(t.Field,{control:n.control,name:"location_id",render:({field:{onChange:r,value:y,ref:g,...b}})=>e.jsxs(t.Item,{children:[e.jsx(t.Label,{children:s("inventory.reservation.location")}),e.jsx(t.Control,{children:e.jsxs(u,{value:y,onValueChange:c=>{r(c)},...b,children:[e.jsx(u.Trigger,{ref:g,children:e.jsx(u.Value,{})}),e.jsx(u.Content,{children:(l||[]).map(c=>e.jsx(u.Item,{value:c.id,children:c.name},c.id))})]})}),e.jsx(t.ErrorMessage,{})]})}),e.jsxs("div",{className:"text-ui-fg-subtle shadow-elevation-card-rest grid grid-rows-4 divide-y rounded-lg border",children:[e.jsx(f,{title:s("fields.title"),value:a.title??a.sku}),e.jsx(f,{title:s("fields.sku"),value:a.sku}),e.jsx(f,{title:s("fields.inStock"),value:m.stocked_quantity}),e.jsx(f,{title:s("inventory.available"),value:m.stocked_quantity-v})]}),e.jsx(t.Field,{control:n.control,name:"quantity",render:({field:{onChange:r,value:y,...g}})=>e.jsxs(t.Item,{children:[e.jsx(t.Label,{children:s("inventory.reservation.reservedAmount")}),e.jsx(t.Control,{children:e.jsx(E,{type:"number",min:0,max:m.available_quantity+o.quantity,value:y||"",onChange:b=>{const c=b.target.value;r(c===""?null:parseFloat(c))},...g})}),e.jsx(t.ErrorMessage,{})]})}),e.jsx(t.Field,{control:n.control,name:"description",render:({field:r})=>e.jsxs(t.Item,{children:[e.jsx(t.Label,{optional:!0,children:s("fields.description")}),e.jsx(t.Control,{children:e.jsx(N,{...r})}),e.jsx(t.ErrorMessage,{})]})})]}),e.jsx(d.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(d.Close,{asChild:!0,children:e.jsx(S,{variant:"secondary",size:"small",children:s("actions.cancel")})}),e.jsx(S,{type:"submit",size:"small",isLoading:!1,children:s("actions.save")})]})})]})})},xe=()=>{var p;const{id:o}=z(),{t:a}=F(),{reservation:l,isPending:s,isError:h,error:n}=I(o),{inventory_item:i}=T(l==null?void 0:l.inventory_item_id,{enabled:!!l}),{stock_locations:x}=L({id:(p=i==null?void 0:i.location_levels)==null?void 0:p.map(m=>m.location_id)},{enabled:!!(i!=null&&i.location_levels)}),v=!s&&l&&i&&x;if(h)throw n;return e.jsxs(d,{children:[e.jsx(d.Header,{children:e.jsx(M,{children:a("inventory.reservation.editItemDetails")})}),v&&e.jsx(B,{locations:x,reservation:l,item:i})]})};export{xe as Component};
