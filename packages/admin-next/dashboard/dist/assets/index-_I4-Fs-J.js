import{u as h,j as e,a1 as j,T as o,aJ as C,ap as T,Z as g,aH as w,m as D}from"./index-S--WvUSo.js";import{J as S}from"./json-view-section-Dui2O31i.js";import{b as N,d as z}from"./customers--tqEK1Bz.js";import{A as y}from"./action-menu-olZwXQ3q.js";import{a as G,c as _,d as P,O as q}from"./react-router-dom-aSYyayiN.js";import{P as b}from"./pencil-square-u3fizEAQ.js";import{T as E}from"./trash-nTjeUaCp.js";import{t as f}from"./toast-4oQfF9Sm.js";import{u as L}from"./use-prompt-wB0F2CxI.js";import{H as v}from"./heading-cSlef4Su.js";import{S as A}from"./status-badge-sML89E1A.js";import{r as H}from"./react-PzSkSLoa.js";import{a as Q,D as R}from"./use-data-table-TeZp00wg.js";import{u as B}from"./customer-groups-G4KCvF3b.js";import{u as I,a as J}from"./use-customer-group-table-columns-uQ7G548z.js";import{u as O}from"./use-customer-group-table-filters-_AvOD74H.js";import{c as k}from"./index-JDlOzmVl.js";import"./react-dom-Og6--24v.js";import"./badge-99FyByJO.js";import"./drawer-H3TI1lDZ.js";import"./index-sF0hA49A.js";import"./x-mark-mini-aYDSd38M.js";import"./information-circle-solid-rXH6vJ5W.js";import"./x-circle-solid-rnqhxvfk.js";import"./check-circle-solid-7j4QonPK.js";import"./prompt-LzbVPZYR.js";import"./button-Pc5Xo8ua.js";import"./input-A29ux7yj.js";import"./label-HFq5fzpT.js";import"./empty-table-content-i72rBIA2.js";import"./plus-mini-IRJECoWI.js";import"./index-1Zwdg31z.js";import"./use-date-Putn0_Ur.js";import"./format-vrL-wy9v.js";import"./date-picker-s8-9mila.js";import"./minus-E5-czcFC.js";import"./index-7dV3TD85.js";import"./index-Hm2Uj9Gg.js";import"./lodash-5s15_I2H.js";import"./command-bar-wUgfUfvQ.js";import"./text-cell-OtkuJsO8.js";import"./placeholder-cell-O6UVTGmQ.js";const F=({customer:t})=>{const{t:s}=h(),r=L(),a=G(),{mutateAsync:i}=N(t.id),n=[t.first_name,t.last_name].filter(Boolean).join(" "),c=t.has_account?"green":"orange",l=t.has_account?s("customers.fields.registered"):s("customers.fields.guest"),m=async()=>{await r({title:s("customers.delete.title"),description:s("customers.delete.description",{email:t.email}),verificationInstruction:s("general.typeToConfirm"),verificationText:t.email,confirmText:s("actions.delete"),cancelText:s("actions.cancel")})&&await i(void 0,{onSuccess:()=>{f.success(s("general.success"),{description:s("customers.delete.successToast",{email:t.email}),dismissLabel:s("actions.close")}),a("/customers",{replace:!0})},onError:p=>{f.error(s("general.error"),{description:p.message,dismissLabel:s("actions.close")})}})};return e.jsxs(j,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(v,{children:t.email}),e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx(A,{color:c,children:l}),e.jsx(y,{groups:[{actions:[{label:s("actions.edit"),icon:e.jsx(b,{}),to:"edit"}]},{actions:[{label:s("actions.delete"),icon:e.jsx(E,{}),onClick:m}]}]})]})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[e.jsx(o,{size:"small",leading:"compact",weight:"plus",children:s("fields.name")}),e.jsx(o,{size:"small",leading:"compact",children:n||"-"})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[e.jsx(o,{size:"small",leading:"compact",weight:"plus",children:s("fields.company")}),e.jsx(o,{size:"small",leading:"compact",children:t.company_name||"-"})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[e.jsx(o,{size:"small",leading:"compact",weight:"plus",children:s("fields.phone")}),e.jsx(o,{size:"small",leading:"compact",children:t.phone||"-"})]})]})},x=10,K=({customer:t})=>{const{raw:s,searchParams:r}=I({pageSize:x}),{customer_groups:a,count:i,isLoading:n,isError:c,error:l}=B({...r,fields:"+customers.id",customers:{id:t.id}},{placeholderData:T}),m=O(),u=$(),{table:p}=Q({data:a??[],columns:u,count:i,getRowId:d=>d.id,enablePagination:!0,enableRowSelection:!0,pageSize:x});if(c||c)throw l;return e.jsxs(j,{className:"divide-y p-0",children:[e.jsx("div",{className:"flex items-center justify-between px-6 py-4",children:e.jsx(v,{level:"h2",children:C("customerGroups.domain")})}),e.jsx(R,{table:p,columns:u,pageSize:x,isLoading:n,count:i,navigateTo:d=>`/customer-groups/${d.id}`,filters:m,search:!0,pagination:!0,orderBy:["name","created_at","updated_at"],queryObject:s})]})},M=({group:t})=>{const{t:s}=h();return e.jsx(y,{groups:[{actions:[{label:s("actions.edit"),icon:e.jsx(b,{}),to:`/customer-groups/${t.id}/edit`}]}]})},Z=k(),$=()=>{const t=J();return H.useMemo(()=>[...t,Z.display({id:"actions",cell:({row:s})=>e.jsx(M,{group:s.original})})],[t])},Re=()=>{const{id:t}=_(),s=P(),{customer:r,isLoading:a,isError:i,error:n}=z(t,void 0,{initialData:s});if(a||!r)return e.jsx("div",{children:"Loading..."});if(i)throw n;return e.jsxs("div",{className:"flex flex-col gap-y-2",children:[e.jsx(F,{customer:r}),e.jsx(K,{customer:r}),e.jsx(S,{data:r}),e.jsx(q,{})]})},V=t=>({queryKey:w.detail(t),queryFn:async()=>D.admin.customers.retrieve(t)}),Be=async({params:t})=>{const s=t.id,r=V(s);return g.getQueryData(r.queryKey)??await g.fetchQuery(r)};export{Re as Component,Be as loader};
