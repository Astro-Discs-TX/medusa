import{u as re,j as t,d as ne,T as M,aa as y,Z as V,W as le}from"./index-S--WvUSo.js";import{u as ce,a as C}from"./route-focus-modal-MMx5Xnk0.js";import{u as ie,a as ae,t as de}from"./tax-rates-TgwHqykr.js";import{a as me}from"./tax-regions-jathV60U.js";import{t as ue}from"./zod-jt04JUtm.js";import{u as pe,a as m,F as c}from"./form-0PHaH8g8.js";import{o as U,b as u,a as xe,s as O,n as fe}from"./index-JzuMwgWW.js";import{r as S}from"./react-PzSkSLoa.js";import{b as he,c as _e}from"./react-router-dom-aSYyayiN.js";import{P as Ce}from"./percentage-input-hee_tAkG.js";import{S as D}from"./split-view-l-bJVVse.js";import{C as o,a as ge,b as je}from"./tax-rate-create-form-L0ei5hQX.js";import{B as b}from"./button-Pc5Xo8ua.js";import{H as Te}from"./heading-cSlef4Su.js";import{I as q}from"./input-A29ux7yj.js";import{S as ye}from"./switch-VR1xZXYU.js";import"./react-dom-Og6--24v.js";import"./drawer-H3TI1lDZ.js";import"./index-sF0hA49A.js";import"./prompt-LzbVPZYR.js";import"./information-circle-solid-rXH6vJ5W.js";import"./label-HFq5fzpT.js";import"./tooltip-Ixyw9oT8.js";import"./use-data-table-TeZp00wg.js";import"./empty-table-content-i72rBIA2.js";import"./plus-mini-IRJECoWI.js";import"./index-1Zwdg31z.js";import"./use-date-Putn0_Ur.js";import"./format-vrL-wy9v.js";import"./date-picker-s8-9mila.js";import"./minus-E5-czcFC.js";import"./x-mark-mini-aYDSd38M.js";import"./index-7dV3TD85.js";import"./index-Hm2Uj9Gg.js";import"./lodash-5s15_I2H.js";import"./index-JDlOzmVl.js";import"./command-bar-wUgfUfvQ.js";import"./use-product-table-columns-k99B-kCF.js";import"./product-types-gZDu6wo-.js";import"./sales-channels--fho5-f4.js";import"./products-_PEbH1CR.js";import"./placeholder-cell-O6UVTGmQ.js";import"./product-cell-gRltbXZC.js";import"./thumbnail-gerN888-.js";import"./status-cell-9XExsAIG.js";import"./checkbox-8MlXzZCx.js";import"./use-customer-group-table-columns-uQ7G548z.js";import"./text-cell-OtkuJsO8.js";import"./collections-1ZxhMSyG.js";import"./customer-groups-G4KCvF3b.js";import"./customers--tqEK1Bz.js";import"./list-summary-5vNt7oxx.js";import"./select-Z4sV_-wF.js";import"./triangles-mini-HukRlWGp.js";const be=U({[o.PRODUCT]:u(),[o.PRODUCT_TYPE]:u(),[o.PRODUCT_COLLECTION]:u(),[o.PRODUCT_TAG]:u(),[o.CUSTOMER_GROUP]:u()}),_=xe(U({label:O(),value:O()})),Oe=U({name:O().optional(),code:O().optional(),rate:fe().optional(),is_combinable:u().optional(),selected_condition_types:be,products:_,product_types:_,product_collections:_,product_tags:_,customer_groups:_}),ve=({taxRegion:i,taxRate:r})=>{var L,N,F,G,k,A;const{t:n}=re(),{handleSuccess:v}=ce(),a=(L=r.rules)==null?void 0:L.filter(e=>e.reference=="product"),d=(N=r.rules)==null?void 0:N.filter(e=>e.reference=="product_type"),g=(F=r.rules)==null?void 0:F.filter(e=>e.reference=="product_collection"),j=(G=r.rules)==null?void 0:G.filter(e=>e.reference=="product_tag"),T=(k=r.rules)==null?void 0:k.filter(e=>e.reference=="customer_group"),l=pe({defaultValues:{name:r.name,code:r.code||void 0,rate:r.rate||void 0,is_combinable:r.is_combinable,selected_condition_types:{[o.PRODUCT]:!!(a!=null&&a.length),[o.PRODUCT_TYPE]:!!(d!=null&&d.length),[o.PRODUCT_COLLECTION]:!!(g!=null&&g.length),[o.PRODUCT_TAG]:!!(j!=null&&j.length),[o.CUSTOMER_GROUP]:!!(T!=null&&T.length)},products:a.map(e=>({label:e.reference,value:e.reference_id})),product_types:d.map(e=>({label:e.reference,value:e.reference_id})),product_collections:g.map(e=>({label:e.reference,value:e.reference_id})),product_tags:j.map(e=>({label:e.reference,value:e.reference_id})),customer_groups:T.map(e=>({label:e.reference,value:e.reference_id}))},resolver:ue(Oe)}),{mutateAsync:z,isPending:Q}=ie(r.id),p=(e,s)=>(s==null?void 0:s.map(h=>({reference:e,reference_id:h.value})))||[],Y=l.handleSubmit(async e=>{const s=[...p("product",e.products),...p("product_type",e.product_types),...p("product_collection",e.product_collections),...p("product_tag",e.product_tags),...p("customer_group",e.customer_groups)];await z({name:e.name,code:e.code||void 0,rate:e.rate,is_combinable:e.is_combinable,rules:s},{onSuccess:()=>v(`/settings/taxes/${i.id}`)})}),[E,P]=S.useState(!1),[B,I]=S.useState(!1),[H,w]=S.useState(null),x=m({name:"selected_condition_types",control:l.control}),K=m({control:l.control,name:"products"}),$=m({control:l.control,name:"product_collections"}),W=m({control:l.control,name:"product_types"}),Z=m({control:l.control,name:"product_tags"}),J=m({control:l.control,name:"customer_groups"}),f=e=>s=>{l.setValue(e,s,{shouldDirty:!0,shouldTouch:!0}),P(!1)},R=Object.keys(x||{}).filter(e=>x[e]).sort(),X=e=>{const s={...l.getValues().selected_condition_types};s[e]?delete s[e]:s[e]=!0,l.setValue("selected_condition_types",s,{shouldDirty:!0,shouldTouch:!0})},ee=()=>{l.setValue("selected_condition_types",{[o.PRODUCT]:!1,[o.PRODUCT_TYPE]:!1,[o.PRODUCT_COLLECTION]:!1,[o.PRODUCT_TAG]:!1,[o.CUSTOMER_GROUP]:!1},{shouldDirty:!0,shouldTouch:!0})},[,te]=he(),oe=e=>{e||(w(null),te({},{replace:!0})),P(e)};return t.jsx(C.Form,{form:l,children:t.jsxs("form",{onSubmit:Y,className:"flex h-full flex-col",children:[t.jsx(C.Header,{children:t.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[t.jsx(C.Close,{asChild:!0,children:t.jsx(b,{variant:"secondary",size:"small",children:n("actions.cancel")})}),t.jsx(b,{type:"submit",size:"small",isLoading:Q,children:n("actions.save")})]})}),t.jsx(C.Body,{className:"flex h-full w-full flex-col items-center overflow-hidden",children:t.jsxs(D,{open:E,onOpenChange:oe,children:[t.jsx(D.Content,{children:t.jsx("div",{className:ne("flex flex-col overflow-auto",{"items-center":!E}),children:t.jsxs("div",{className:"flex w-full max-w-[720px] flex-col gap-y-8 py-16",children:[t.jsxs("div",{children:[t.jsx(Te,{className:"text-left",children:n("taxRates.edit.title")}),t.jsx(M,{className:"text-ui-fg-subtle txt-small",children:n("taxRates.edit.description")})]}),t.jsx(c.Field,{control:l.control,name:"name",render:({field:e})=>t.jsxs(c.Item,{children:[t.jsx(c.Label,{children:n("fields.name")}),t.jsx(c.Control,{children:t.jsx(q,{...e})})]})}),t.jsx(c.Field,{control:l.control,name:"rate",render:({field:e})=>t.jsxs(c.Item,{children:[t.jsx(c.Label,{children:n("fields.rate")}),t.jsx(c.Control,{children:t.jsx(Ce,{...e,value:e.value,onChange:s=>{s.target.value&&e.onChange(parseInt(s.target.value))}})})]})}),t.jsx(c.Field,{control:l.control,name:"code",render:({field:e})=>t.jsxs(c.Item,{children:[t.jsx(c.Label,{children:n("fields.code")}),t.jsx(c.Control,{children:t.jsx(q,{...e})})]})}),((A=r.tax_region)==null?void 0:A.parent_id)&&t.jsx(c.Field,{control:l.control,name:"is_combinable",render:({field:{ref:e,onChange:s,value:h,...se}})=>t.jsxs(c.Item,{children:[t.jsx(c.Label,{children:n("taxRates.fields.isCombinable")}),t.jsx(c.Control,{children:t.jsx(ye,{...se,checked:h,onCheckedChange:s})})]})}),!r.is_default&&t.jsxs("div",{className:"flex flex-col gap-y-8",children:[R.length>0&&t.jsx("div",{className:"flex flex-col items-start gap-y-4",children:R.map(e=>{if(e in(x||{})){const s=l.getValues(e)||[];return t.jsx(ge,{type:e,labels:s.map(h=>h.value),onClick:()=>{w(e),P(!0)}},e)}})}),t.jsxs("div",{className:"flex items-center gap-x-2",children:[t.jsxs(y,{open:B,onOpenChange:e=>{e&&I(e)},children:[t.jsx(y.Trigger,{asChild:!0,children:t.jsx(b,{variant:"secondary",size:"small",children:n("discounts.conditions.manageTypesAction")})}),t.jsx(y.Content,{onInteractOutside:()=>I(!1),children:Object.values(o).map(e=>t.jsx(y.CheckboxItem,{checked:x[e],onCheckedChange:()=>X(e),children:t.jsx(M,{size:"small",weight:x[e]?"plus":"regular",children:n(`fields.${e}`)})},e))})]}),R.length>0&&t.jsx(b,{variant:"transparent",size:"small",type:"button",onClick:ee,className:"text-ui-fg-muted hover:text-ui-fg-subtle",children:n("actions.clearAll")})]})]})]})})}),t.jsx(D.Drawer,{children:t.jsx(je,{product:{selected:K,onSave:f(o.PRODUCT)},productCollection:{selected:$,onSave:f(o.PRODUCT_COLLECTION)},productType:{selected:W,onSave:f(o.PRODUCT_TYPE)},productTag:{selected:Z,onSave:f(o.PRODUCT_TAG)},customerGroup:{selected:J,onSave:f(o.CUSTOMER_GROUP)},selected:H})})]})})]})})},Rt=()=>{const i=_e(),{tax_region:r}=me(i.id),{tax_rate:n,isLoading:v,isError:a,error:d}=ae(i.taxRateId);if(v)return t.jsx("div",{children:"Loading..."});if(a)throw d;return r&&n&&t.jsx(C,{children:t.jsx(ve,{taxRegion:r,taxRate:n})})},Pe=i=>({queryKey:de.detail(i),queryFn:async()=>le.taxes.retrieveTaxRate(i)}),St=async({params:i})=>{const r=i.taxRateId,n=Pe(r);return V.getQueryData(n.queryKey)??await V.fetchQuery(n)};export{Rt as Component,Rt as TaxRateEdit,St as loader};
