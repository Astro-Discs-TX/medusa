import{an as G,j as e,u as V,d as A,T as E,Z as k,W as U}from"./index-S--WvUSo.js";import{c as W,b as J,d as X}from"./react-router-dom-aSYyayiN.js";import{u as Y,a as b}from"./route-focus-modal-MMx5Xnk0.js";import{u as ee,F as r}from"./form-0PHaH8g8.js";import{t as ie}from"./zod-jt04JUtm.js";import{r as _,a as w}from"./react-PzSkSLoa.js";import{r as v,o as q,s as x,c as se,b as re}from"./index-JzuMwgWW.js";import{D as te,C as D}from"./currency-cell-td0Z0cRW.js";import{u as ne}from"./currencies--m0OMbks.js";import{c as R}from"./regions-en8xSoIX.js";import{c as oe}from"./index-JDlOzmVl.js";import{b as ae}from"./shipping-options-YVduyG9u.js";import{u as le}from"./shipping-profiles-CJfLxZ-F.js";import{a as z}from"./money-amount-helpers--myf8Rla.js";import{u as ce}from"./fulfillment-providers-VBjobkwb.js";import{f as pe}from"./format-provider-yygkXOZ0.js";import{P as j}from"./progress-tabs-S8wsVeqQ.js";import{B as M}from"./button-Pc5Xo8ua.js";import{H as de}from"./heading-cSlef4Su.js";import{R as L}from"./radio-group-asQL-yXP.js";import{I as me}from"./input-A29ux7yj.js";import{S as f}from"./select-Z4sV_-wF.js";import{S as ue}from"./switch-VR1xZXYU.js";import{s as he}from"./stock-locations-5f5MPAbM.js";import"./react-dom-Og6--24v.js";import"./drawer-H3TI1lDZ.js";import"./index-sF0hA49A.js";import"./prompt-LzbVPZYR.js";import"./information-circle-solid-rXH6vJ5W.js";import"./label-HFq5fzpT.js";import"./tooltip-Ixyw9oT8.js";import"./minus-E5-czcFC.js";import"./currencies-bd3ADI6s.js";import"./check-circle-solid-7j4QonPK.js";import"./index-7dV3TD85.js";import"./index-Hm2Uj9Gg.js";import"./triangles-mini-HukRlWGp.js";v(q({currency_prices:v(x().optional()),region_prices:v(x().optional())}));const fe=({form:a})=>{const{store:o,isLoading:s,isError:g,error:n}=G(),{currencies:c,isLoading:m}=ne({code:o==null?void 0:o.supported_currency_codes},{enabled:!!o}),{regions:u}=R(),[t,h]=_.useState({});_.useEffect(()=>{o!=null&&o.default_currency_code&&Object.keys(t).length===0&&h({...t,[o.default_currency_code]:"currency"})},[o,t]);const N=xe({currencies:c,regions:u}),S=s||m||!o||!c;if(g)throw n;const O=_.useMemo(()=>[[...c||[],...u||[]]],[c,u]);return e.jsx("div",{className:"flex size-full flex-col divide-y overflow-hidden",children:e.jsx(te,{columns:N,data:O,isLoading:S,state:a})})},I=oe(),xe=({currencies:a=[],regions:o=[]})=>{const{t:s}=V();return _.useMemo(()=>[...a.map(n=>I.display({header:s("fields.priceTemplate",{regionOrCountry:n.code.toUpperCase()}),cell:({row:c,table:m})=>e.jsx(D,{currency:n,meta:m.options.meta,field:`currency_prices.${n.code}`})})),...o.map(n=>I.display({header:s("fields.priceTemplate",{regionOrCountry:n.name}),cell:({row:c,table:m})=>e.jsx(D,{currency:a.find(u=>u.code===n.currency_code),meta:m.options.meta,field:`region_prices.${n.id}`})}))],[s,a,o])};var H=(a=>(a.FlatRate="flat",a.Calculated="calculated",a))(H||{});const ge=q({name:x().min(1),price_type:se(H),enabled_in_store:re().optional(),shipping_profile_id:x(),provider_id:x().min(1),region_prices:v(x(),x().optional()),currency_prices:v(x(),x().optional())});function je({zone:a,isReturn:o}){const{t:s}=V(),{handleSuccess:g}=Y(),[n,c]=w.useState("details"),{fulfillment_providers:m=[]}=ce({is_enabled:!0}),{regions:u=[]}=R({limit:999,fields:"id,currency_code"}),t=ee({defaultValues:{name:"",price_type:"flat",enabled_in_store:!0,shipping_profile_id:"",provider_id:"",region_prices:{},currency_prices:{}},resolver:ie(ge)}),h=t.watch("price_type")==="calculated",{mutateAsync:N,isPending:S}=ae(),{shipping_profiles:O}=le({limit:999}),B=t.handleSubmit(async i=>{const l=Object.entries(i.currency_prices).map(([p,y])=>{const T=y===""?void 0:z(Number(y),p);return{currency_code:p,amount:T}}).filter(p=>!!p.amount),d=new Map(u.map(p=>[p.id,p.currency_code])),K=Object.entries(i.region_prices).map(([p,y])=>{const T=d.get(p),Z=y===""?void 0:z(Number(y),T);return{region_id:p,amount:Z}}).filter(p=>!!p.amount);await N({name:i.name,price_type:i.price_type,service_zone_id:a.id,shipping_profile_id:i.shipping_profile_id,provider_id:i.provider_id,prices:[...l,...K],rules:[{value:o?'"true"':'"false"',attribute:"is_return",operator:"eq"},{value:i.enabled_in_store?'"true"':'"false"',attribute:"enabled_in_store",operator:"eq"}],type:{label:"Type label",description:"Type description",code:"type-code"}}),g()}),[P,C]=w.useState({pricing:"not-started",details:"not-started"}),Q=w.useCallback(async i=>{c(i)},[]),$=w.useCallback(async()=>{switch(n){case"details":{c("pricing");break}}},[n]),F=t.watch("name").length&&t.watch("shipping_profile_id")&&t.watch("provider_id");return _.useEffect(()=>{t.formState.isDirty?C(i=>({...i,details:"in-progress"})):C(i=>({...i,details:"not-started"}))},[t.formState.isDirty]),_.useEffect(()=>{if(n==="details"&&t.formState.isDirty&&C(i=>({...i,details:"in-progress"})),n==="pricing"){const i=t.getValues(["region_prices","currency_prices"]).map(Object.keys).some(l=>l.length);C(l=>({...l,details:"completed",pricing:i?"in-progress":"not-started"}))}},[n]),e.jsx(b.Form,{form:t,children:e.jsx("form",{className:"flex h-full flex-col overflow-hidden",onSubmit:B,children:e.jsxs(j,{value:n,className:"h-full",onValueChange:i=>Q(i),children:[e.jsxs(b.Header,{children:[e.jsxs(j.List,{className:"border-ui-border-base -my-2 ml-2 min-w-0 flex-1 border-l",children:[e.jsx(j.Trigger,{value:"details",status:P.details,className:"w-full max-w-[200px]",children:e.jsx("span",{className:"w-full cursor-auto overflow-hidden text-ellipsis whitespace-nowrap",children:s("shipping.shippingOptions.create.details")})}),!h&&e.jsx(j.Trigger,{value:"pricing",className:"w-full max-w-[200px]",status:P.pricing,disabled:!F,children:e.jsx("span",{className:"w-full overflow-hidden text-ellipsis whitespace-nowrap",children:s("shipping.shippingOptions.create.pricing")})})]}),e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(b.Close,{asChild:!0,children:e.jsx(M,{variant:"secondary",size:"small",children:s("actions.cancel")})}),e.jsx(M,{size:"small",className:"whitespace-nowrap",isLoading:S,onClick:$,disabled:!F,type:n==="pricing"||h?"submit":"button",children:s(n==="pricing"||h?"actions.save":"general.next")},n==="pricing"||h?"details":"pricing")]})]}),e.jsxs(b.Body,{className:A("flex h-full w-fit flex-col items-center divide-y overflow-hidden",{"mx-auto":n==="details"}),children:[e.jsx(j.Content,{value:"details",className:"h-full w-full",children:e.jsxs("div",{className:"container mx-auto w-[720px] px-1 py-8",children:[e.jsx(de,{className:"mb-12 mt-8 text-2xl",children:s(`shipping.${o?"returnOptions":"shippingOptions"}.create.title`,{zone:a.name})}),!o&&e.jsxs("div",{children:[e.jsx(E,{weight:"plus",children:s("shipping.shippingOptions.create.subtitle")}),e.jsx(E,{className:"text-ui-fg-subtle mb-8 mt-2",children:s("shipping.shippingOptions.create.description")})]}),e.jsx(r.Field,{control:t.control,name:"price_type",render:({field:i})=>e.jsxs(r.Item,{children:[e.jsx(r.Label,{children:s("shipping.shippingOptions.create.allocation")}),e.jsx(r.Control,{children:e.jsxs(L,{className:"flex justify-between gap-4",...i,onValueChange:i.onChange,children:[e.jsx(L.ChoiceBox,{className:"flex-1",value:"flat",label:s("shipping.shippingOptions.create.fixed"),description:s("shipping.shippingOptions.create.fixedDescription")}),e.jsx(L.ChoiceBox,{className:"flex-1",value:"calculated",label:s("shipping.shippingOptions.create.calculated"),description:s("shipping.shippingOptions.create.calculatedDescription")})]})}),e.jsx(r.ErrorMessage,{})]})}),e.jsx("div",{className:"mt-8 max-w-[50%] pr-2 ",children:e.jsx(r.Field,{control:t.control,name:"name",render:({field:i})=>e.jsxs(r.Item,{children:[e.jsx(r.Label,{children:s("fields.name")}),e.jsx(r.Control,{children:e.jsx(me,{...i})}),e.jsx(r.ErrorMessage,{})]})})}),e.jsxs("div",{className:"flex flex-col divide-y",children:[e.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-4",children:[e.jsx(r.Field,{control:t.control,name:"shipping_profile_id",render:({field:{onChange:i,...l}})=>e.jsxs(r.Item,{children:[e.jsx(r.Label,{children:s("shipping.shippingOptions.create.profile")}),e.jsx(r.Control,{children:e.jsxs(f,{...l,onValueChange:i,children:[e.jsx(f.Trigger,{ref:l.ref,children:e.jsx(f.Value,{})}),e.jsx(f.Content,{children:(O??[]).map(d=>e.jsx(f.Item,{value:d.id,children:d.name},d.id))})]})})]})}),e.jsx(r.Field,{control:t.control,name:"provider_id",render:({field:{onChange:i,...l}})=>e.jsxs(r.Item,{children:[e.jsx(r.Label,{children:s("shipping.shippingOptions.edit.provider")}),e.jsx(r.Control,{children:e.jsxs(f,{...l,onValueChange:i,children:[e.jsx(f.Trigger,{ref:l.ref,children:e.jsx(f.Value,{})}),e.jsx(f.Content,{children:m.map(d=>e.jsx(f.Item,{value:d.id,children:pe(d.id)},d.id))})]})})]})})]}),e.jsx("div",{className:"mt-8 pt-8",children:e.jsx(r.Field,{control:t.control,name:"enabled_in_store",render:({field:{value:i,onChange:l,...d}})=>e.jsxs(r.Item,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(r.Label,{children:s("shipping.shippingOptions.create.enable")}),e.jsx(r.Control,{children:e.jsx(ue,{...d,checked:!!i,onCheckedChange:l})})]}),e.jsx(r.Hint,{className:"!mt-1",children:s("shipping.shippingOptions.create.enableDescription")}),e.jsx(r.ErrorMessage,{})]})})})]})]})}),e.jsx(j.Content,{value:"pricing",className:"h-full w-full",style:{width:"100vw"},children:e.jsx(fe,{form:t})})]})]})})})}function ri(){var m,u,t;const{fset_id:a,zone_id:o}=W(),[s]=J(),g=s.has("is_return"),{stock_location:n}=X(),c=(t=(u=(m=n.fulfillment_sets)==null?void 0:m.find(h=>h.id===a))==null?void 0:u.service_zones)==null?void 0:t.find(h=>h.id===o);if(!c)throw new Error("Zone set doesn't exist");return e.jsx(b,{children:e.jsx(je,{zone:c,isReturn:g})})}const _e=a=>({queryKey:he.list(),queryFn:async()=>U.stockLocations.retrieve(a,{fields:"*fulfillment_sets,*fulfillment_sets.service_zones,*fulfillment_sets.service_zones.shipping_options"})}),ti=async({params:a})=>{const o=a.location_id,s=_e(o);return k.getQueryData(s.queryKey)??await k.fetchQuery(s)};export{ri as Component,ti as loader};
