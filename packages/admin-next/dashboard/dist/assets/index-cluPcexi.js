import{u as S,a4 as k,j as e,T as _,aL as R}from"./index-S--WvUSo.js";import{u as G,a as N}from"./route-focus-modal-MMx5Xnk0.js";import{f as A,o as F,s as p,a as T,b as d,d as g,n as l,l as w,u as z,g as V}from"./index-JzuMwgWW.js";import{t as B}from"./zod-jt04JUtm.js";import{a as P,F as s,u as X}from"./form-0PHaH8g8.js";import{r as H}from"./react-PzSkSLoa.js";import{C as K}from"./combobox-DjjFlb75.js";import{P as O}from"./percentage-input-hee_tAkG.js";import{g as U}from"./currencies-bd3ADI6s.js";import{R as v}from"./radio-group-asQL-yXP.js";import{T as D}from"./Trans-9IhttDMi.js";import{H as $}from"./heading-cSlef4Su.js";import{S as C}from"./select-Z4sV_-wF.js";import{I as h}from"./input-A29ux7yj.js";import{C as W}from"./currency-input-k1bgGOuE.js";import{T as q}from"./textarea-D4fuXHvE.js";import{C as J}from"./checkbox-8MlXzZCx.js";import{S as E}from"./switch-VR1xZXYU.js";import{D as L}from"./date-picker-s8-9mila.js";import{a as Q}from"./money-amount-helpers--myf8Rla.js";import{f as Y}from"./formatISODuration-S3SWj11X.js";import{B as M}from"./button-Pc5Xo8ua.js";import"./react-dom-Og6--24v.js";import"./react-router-dom-aSYyayiN.js";import"./drawer-H3TI1lDZ.js";import"./index-sF0hA49A.js";import"./prompt-LzbVPZYR.js";import"./information-circle-solid-rXH6vJ5W.js";import"./label-HFq5fzpT.js";import"./tooltip-Ixyw9oT8.js";import"./x-mark-mini-aYDSd38M.js";import"./triangles-mini-HukRlWGp.js";import"./plus-mini-IRJECoWI.js";import"./index-7dV3TD85.js";import"./index-Hm2Uj9Gg.js";import"./index-1Zwdg31z.js";import"./minus-E5-czcFC.js";var x=(i=>(i.FIXED="fixed",i.PERCENTAGE="percentage",i.FREE_SHIPPING="free_shipping",i))(x||{});const Z=({form:i})=>{const{t}=S(),{regions:u}=k(),f=P({control:i.control,name:"type"}),b=P({name:"regions",control:i.control}),j=f===x.FIXED,I=f===x.FREE_SHIPPING,r=H.useMemo(()=>{if(!(!b||!(u!=null&&u.length)))return u.find(n=>n.id===b[0])},[u,b]),{setValue:y}=i;return H.useEffect(()=>{y("regions",[]),y("value",void 0)},[f,y]),e.jsx("div",{className:"flex size-full flex-col items-center overflow-auto p-16",children:e.jsxs("div",{className:"flex w-full max-w-[736px] flex-col justify-center px-2 pb-2",children:[e.jsx("div",{className:"flex flex-col gap-y-1",children:e.jsx($,{children:t("discounts.createDiscountTitle")})}),e.jsxs("div",{className:"flex flex-col gap-y-8 divide-y [&>div]:pt-8",children:[e.jsxs("div",{className:"flex flex-col gap-y-8",children:[e.jsx(s.Field,{control:i.control,name:"type",render:({field:n})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{children:t("discounts.type")}),e.jsx(s.Control,{children:e.jsxs(v,{className:"flex justify-between gap-4",...n,onValueChange:n.onChange,children:[e.jsx(v.ChoiceBox,{className:"flex-1",value:x.PERCENTAGE,label:t("fields.percentage"),description:t("discounts.percentageDescription")}),e.jsx(v.ChoiceBox,{className:"flex-1",value:x.FIXED,label:t("discounts.fixedAmount"),description:t("discounts.fixedDescription")}),e.jsx(v.ChoiceBox,{className:"flex-1",value:x.FREE_SHIPPING,label:t("discounts.freeShipping"),description:t("discounts.shippingDescription")})]})}),e.jsx(s.ErrorMessage,{})]})}),e.jsx("div",{className:"grid grid-cols-2 gap-x-4",children:e.jsx(s.Field,{control:i.control,name:"regions",render:({field:{onChange:n,value:a,ref:o,...m}})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{children:t("discounts.chooseValidRegions")}),e.jsx(s.Control,{children:j?e.jsxs(C,{value:a[0],onValueChange:c=>{c&&n([c])},...m,children:[e.jsx(C.Trigger,{ref:o,children:e.jsx(C.Value,{})}),e.jsx(C.Content,{children:(u||[]).map(c=>e.jsx(C.Item,{value:c.id,children:c.name},c.id))})]}):e.jsx(K,{options:(u||[]).map(c=>({label:c.name,value:c.id})),value:a,onChange:n,...m})}),e.jsx(s.ErrorMessage,{})]})})}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-4",children:[e.jsx(s.Field,{control:i.control,name:"code",render:({field:n})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{children:t("fields.code")}),e.jsx(s.Control,{children:e.jsx(h,{...n})}),e.jsx(s.ErrorMessage,{})]})}),!I&&e.jsx(s.Field,{control:i.control,name:"value",render:({field:{onChange:n,...a}})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{tooltip:j&&!r&&t("discounts.selectRegionFirst"),children:t(j?"fields.amount":"fields.percentage")}),e.jsx(s.Control,{children:j?r?e.jsx(W,{min:0,onValueChange:n,code:r.currency_code,symbol:U(r.currency_code),...a}):e.jsx(h,{disabled:!0},"placeholder"):e.jsx(O,{min:0,max:100,...a,value:a.value||"",onChange:o=>{const m=o.target.value;n(m===""?null:parseFloat(m))}},"amount")}),e.jsx(s.ErrorMessage,{})]})})]}),e.jsx(_,{size:"small",leading:"compact",className:"text-ui-fg-subtle",children:e.jsx(D,{i18nKey:"discounts.titleHint",t,components:[e.jsx("br",{},"break")]})}),e.jsx(s.Field,{control:i.control,name:"description",render:({field:n})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{optional:!0,children:t("fields.description")}),e.jsx(s.Control,{children:e.jsx(q,{...n})}),e.jsx(s.ErrorMessage,{})]})}),e.jsx(s.Field,{control:i.control,name:"is_dynamic",render:({field:{value:n,onChange:a,...o}})=>e.jsx(s.Item,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(s.Control,{children:e.jsx(J,{checked:n,onCheckedChange:m=>a(m===!0),...o})}),e.jsx(s.Label,{className:"cursor-pointer",tooltip:t("discounts.templateHint"),children:t("discounts.isTemplateDiscount")})]})})})]}),e.jsxs("div",{className:"flex flex-col gap-y-8",children:[e.jsxs("div",{className:"flex flex-col gap-y-1",children:[e.jsx(_,{size:"large",leading:"compact",className:"text-ui-fg-base",weight:"plus",children:t("fields.configurations")}),e.jsx(_,{size:"small",leading:"compact",className:"text-ui-fg-subtle",children:e.jsx(D,{t,i18nKey:"discounts.codeHint",components:[e.jsx("br",{},"break")]})})]}),e.jsxs("div",{className:"flex flex-col gap-y-4",children:[e.jsx(s.Field,{control:i.control,name:"start_date_enabled",render:({field:{value:n,onChange:a,...o}})=>e.jsxs(s.Item,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(s.Label,{tooltip:"todo",children:t("discounts.hasStartDate")}),e.jsx(s.Control,{children:e.jsx(E,{...o,checked:!!n,onCheckedChange:a})})]}),e.jsx(s.Hint,{className:"!mt-1",children:t("discounts.startDateHint")}),e.jsx(s.ErrorMessage,{})]})}),i.watch("start_date_enabled")&&e.jsx(s.Field,{control:i.control,name:"start_date",render:({field:{value:n,onChange:a,ref:o,...m}})=>e.jsxs(s.Item,{children:[e.jsx("div",{className:"grid grid-cols-2 gap-x-4",children:e.jsx(s.Control,{children:e.jsx(L,{showTimePicker:!0,value:n??void 0,onChange:c=>{a(c??null)},...m})})}),e.jsx(s.ErrorMessage,{})]})})]}),e.jsxs("div",{className:"flex flex-col gap-y-4",children:[e.jsx(s.Field,{control:i.control,name:"end_date_enabled",render:({field:{value:n,onChange:a,...o}})=>e.jsxs(s.Item,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(s.Label,{tooltip:"todo",children:t("discounts.hasEndDate")}),e.jsx(s.Control,{children:e.jsx(E,{...o,checked:!!n,onCheckedChange:a})})]}),e.jsx(s.Hint,{className:"!mt-1",children:t("discounts.endDateHint")}),e.jsx(s.ErrorMessage,{})]})}),i.watch("end_date_enabled")&&e.jsx(s.Field,{control:i.control,name:"end_date",render:({field:{value:n,onChange:a,ref:o,...m}})=>e.jsxs(s.Item,{children:[e.jsx("div",{className:"grid grid-cols-2 gap-x-4",children:e.jsx(s.Control,{children:e.jsx(L,{showTimePicker:!0,value:n??void 0,onChange:c=>{a(c??null)},...m})})}),e.jsx(s.ErrorMessage,{})]})})]}),e.jsxs("div",{className:"flex flex-col gap-y-4",children:[e.jsx(s.Field,{control:i.control,name:"usage_limit_enabled",render:({field:n})=>e.jsxs(s.Item,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(s.Label,{tooltip:"todo",children:t("discounts.hasUsageLimit")}),e.jsx(s.Control,{children:e.jsx(E,{checked:!!n.value,onCheckedChange:n.onChange})})]}),e.jsx(s.Hint,{className:"!mt-1",children:t("discounts.usageLimitHint")}),e.jsx(s.ErrorMessage,{})]})}),i.watch("usage_limit_enabled")&&e.jsx(s.Field,{control:i.control,name:"usage_limit",render:({field:n})=>e.jsxs(s.Item,{children:[e.jsx(s.Control,{children:e.jsx("div",{className:"grid grid-cols-2 gap-x-4",children:e.jsx(h,{...n,type:"number",min:0,onChange:a=>{const o=a.target.value;o===""?n.onChange(null):n.onChange(Number(o))}})})}),e.jsx(s.ErrorMessage,{})]})})]}),e.jsxs("div",{className:"flex flex-col gap-y-4",children:[e.jsx(s.Field,{control:i.control,name:"valid_duration_enabled",render:({field:n})=>e.jsxs(s.Item,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(s.Label,{tooltip:"todo",children:t("discounts.hasDurationLimit")}),e.jsx(s.Control,{children:e.jsx(E,{checked:!!n.value,onCheckedChange:n.onChange})})]}),e.jsx(s.Hint,{className:"!mt-1",children:t("discounts.durationHint")}),e.jsx(s.ErrorMessage,{})]})}),i.watch("valid_duration_enabled")&&e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx(s.Field,{control:i.control,name:"years",render:({field:n})=>e.jsxs(s.Item,{className:"flex-1",children:[e.jsx(s.Label,{children:t("fields.years")}),e.jsx(s.Control,{children:e.jsx(h,{...n,type:"number",min:0,onChange:a=>{const o=a.target.value;o===""?n.onChange(null):n.onChange(Number(o))}})}),e.jsx(s.ErrorMessage,{})]})}),e.jsx(s.Field,{control:i.control,name:"months",render:({field:n})=>e.jsxs(s.Item,{className:"flex-1",children:[e.jsx(s.Label,{children:t("fields.months")}),e.jsx(s.Control,{children:e.jsx(h,{...n,type:"number",min:0,onChange:a=>{const o=a.target.value;o===""?n.onChange(null):n.onChange(Number(o))}})}),e.jsx(s.ErrorMessage,{})]})}),e.jsx(s.Field,{control:i.control,name:"days",render:({field:n})=>e.jsxs(s.Item,{className:"flex-1",children:[e.jsx(s.Label,{children:t("fields.days")}),e.jsx(s.Control,{children:e.jsx(h,{...n,type:"number",min:0,onChange:a=>{const o=a.target.value;o===""?n.onChange(null):n.onChange(Number(o))}})}),e.jsx(s.ErrorMessage,{})]})}),e.jsx(s.Field,{control:i.control,name:"hours",render:({field:n})=>e.jsxs(s.Item,{className:"flex-1",children:[e.jsx(s.Label,{children:t("fields.hours")}),e.jsx(s.Control,{children:e.jsx(h,{...n,type:"number",min:0,onChange:a=>{const o=a.target.value;o===""?n.onChange(null):n.onChange(Number(o))}})}),e.jsx(s.ErrorMessage,{})]})}),e.jsx(s.Field,{control:i.control,name:"minutes",render:({field:n})=>e.jsxs(s.Item,{className:"flex-1",children:[e.jsx(s.Label,{children:t("fields.minutes")}),e.jsx(s.Control,{children:e.jsx(h,{...n,type:"number",min:0,onChange:a=>{const o=a.target.value;o===""?n.onChange(null):n.onChange(Number(o))}})}),e.jsx(s.ErrorMessage,{})]})})]})]})]}),e.jsx("div",{className:"flex flex-col gap-y-8",children:e.jsxs("div",{className:"flex flex-col gap-y-1",children:[e.jsx(_,{size:"large",leading:"compact",className:"text-ui-fg-base",weight:"plus",children:t("fields.conditions")}),e.jsx(_,{size:"small",leading:"compact",className:"text-ui-fg-subtle",children:e.jsx(D,{t,i18nKey:"discounts.conditionsHint",components:[e.jsx("br",{},"break")]})})]})})]})]})})},ee=A("type",[F({code:p(),regions:T(p()).min(1),is_dynamic:d(),start_date:g().optional(),end_date:g().optional(),usage_limit:l().optional(),description:p().optional(),start_date_enabled:d().optional(),end_date_enabled:d().optional(),usage_limit_enabled:d().optional(),valid_duration_enabled:d().optional(),years:l().optional(),months:l().optional(),days:l().optional(),hours:l().optional(),minutes:l().optional(),value:l().min(0).max(100),type:w(x.PERCENTAGE)}),F({code:p(),regions:T(p()).min(1),is_dynamic:d(),start_date:g().optional(),end_date:g().optional(),usage_limit:l().optional(),description:p().optional(),start_date_enabled:d().optional(),end_date_enabled:d().optional(),usage_limit_enabled:d().optional(),valid_duration_enabled:d().optional(),years:l().optional(),months:l().optional(),days:l().optional(),hours:l().optional(),minutes:l().optional(),value:z([p(),l()]).refine(i=>{if(i==="")return!1;const t=Number(i);return isNaN(t)?!1:t>=0},"Amount must be a positive number"),type:w(x.FIXED)}),F({code:p(),regions:T(p()).min(1),is_dynamic:d(),start_date:g().optional(),end_date:g().optional(),usage_limit:l().optional(),description:p().optional(),start_date_enabled:d().optional(),end_date_enabled:d().optional(),usage_limit_enabled:d().optional(),valid_duration_enabled:d().optional(),years:l().optional(),months:l().optional(),days:l().optional(),hours:l().optional(),minutes:l().optional(),value:V(),type:w(x.FREE_SHIPPING)})]),se=()=>{const{t:i}=S(),{handleSuccess:t}=G(),u=X({defaultValues:{regions:[],is_dynamic:!1,type:x.PERCENTAGE},resolver:B(ee)}),{mutateAsync:f,isLoading:b}=R(),{regions:j}=k(),I=u.handleSubmit(async r=>{const y=()=>{if(r.type===x.FREE_SHIPPING)return 0;if(r.type===x.PERCENTAGE)return r.value;const o=typeof r.value=="string"?Number(r.value):r.value,m=j.find(c=>c.id===r.regions[0]);return Q(o,m.currency_code)},n={years:r.years,months:r.months,days:r.days,hours:r.hours,minutes:r.minutes},a=Object.values(n).every(o=>!o);await f({code:r.code,regions:r.regions,is_dynamic:r.is_dynamic,starts_at:r.start_date_enabled?r.start_date:void 0,ends_at:r.end_date_enabled?r.end_date:void 0,is_disabled:!1,usage_limit:r.usage_limit_enabled?r.usage_limit:void 0,valid_duration:r.valid_duration_enabled&&!a?Y(n):void 0,rule:{value:y(),type:r.type,description:r.description,allocation:"total"}},{onSuccess:({discount:o})=>{t(`../${o.id}`)}})});return e.jsx(N.Form,{form:u,children:e.jsxs("form",{onSubmit:I,className:"flex h-full flex-col",children:[e.jsx(N.Header,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(N.Close,{asChild:!0,children:e.jsx(M,{variant:"secondary",size:"small",children:i("actions.cancel")})}),e.jsx(M,{type:"submit",size:"small",isLoading:b,children:i("actions.save")})]})}),e.jsx(N.Body,{className:"flex flex-1 flex-col overflow-hidden",children:e.jsx("div",{className:"flex flex-1 flex-col items-center overflow-y-auto",children:e.jsx("div",{className:"flex h-full w-full",children:e.jsx(Z,{form:u})})})})]})})},Ae=()=>e.jsx(N,{children:e.jsx(se,{})});export{Ae as Component};
