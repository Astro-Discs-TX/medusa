import{u as x,j as e,T as j}from"./index-S--WvUSo.js";import{u as b,R as h}from"./route-focus-modal-MMx5Xnk0.js";import{t as y}from"./zod-jt04JUtm.js";import{u as v,F as r}from"./form-0PHaH8g8.js";import{o as _,s as p}from"./index-JzuMwgWW.js";import{C}from"./conditional-tooltip-KJH4b1Z4.js";import{e as w,d as N}from"./customers--tqEK1Bz.js";import{T}from"./trash-nTjeUaCp.js";import{A as F}from"./alert-dyv3SYtc.js";import{I as u}from"./input-A29ux7yj.js";import{B as f}from"./button-Pc5Xo8ua.js";import{m as I}from"./validation-CjPNSdXy.js";import{t as g}from"./toast-4oQfF9Sm.js";import{c as E}from"./react-router-dom-aSYyayiN.js";import{H as V}from"./heading-cSlef4Su.js";import"./react-PzSkSLoa.js";import"./react-dom-Og6--24v.js";import"./drawer-H3TI1lDZ.js";import"./index-sF0hA49A.js";import"./prompt-LzbVPZYR.js";import"./information-circle-solid-rXH6vJ5W.js";import"./label-HFq5fzpT.js";import"./tooltip-Ixyw9oT8.js";import"./x-mark-mini-aYDSd38M.js";import"./x-circle-solid-rnqhxvfk.js";import"./check-circle-solid-7j4QonPK.js";import"./cast-number-oeIUIgsb.js";function D({field:s,updateKey:t,updateValue:a,onDelete:n,isLast:i}){const{t:d}=x();return s.isDeleted||s.isIgnored?null:e.jsxs("tr",{className:"group divide-x [&:not(:last-child)]:border-b",children:[e.jsx("td",{children:e.jsx(u,{className:"rounded-none border-none bg-transparent !shadow-none",placeholder:d("fields.key"),defaultValue:s.key,onChange:m=>{t(m.currentTarget.value)}})}),e.jsxs("td",{className:"relative",children:[e.jsx(u,{className:"rounded-none border-none bg-transparent pr-[40px] !shadow-none",placeholder:d("fields.value"),defaultValue:s.value,onChange:m=>{a(m.currentTarget.value)}}),!i&&e.jsx(f,{size:"small",variant:"transparent",className:"text-ui-fg-subtle invisible absolute right-0 top-0 h-[32px] w-[32px] p-0 hover:bg-transparent group-hover:visible",type:"button",onClick:n,children:e.jsx(T,{})})]})]})}function L({form:s}){const{t}=x(),a=s.watch("metadata"),n=a.filter(l=>l.isIgnored),i=()=>{s.setValue(`metadata.${a.length?a.length:0}`,{key:"",value:""})},d=l=>c=>{s.setValue(`metadata.${l}.key`,c,{shouldDirty:!0}),l===a.length-1&&i()},m=l=>c=>{s.setValue(`metadata.${l}.value`,c,{shouldDirty:!0}),l===a.length-1&&i()},o=l=>()=>{s.setValue(`metadata.${l}.isDeleted`,!0,{shouldDirty:!0})};return e.jsxs("div",{children:[e.jsx(j,{weight:"plus",size:"small",children:t("fields.metadata")}),e.jsxs("table",{className:"shadow-elevation-card-rest mt-2 w-full table-fixed overflow-hidden rounded",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-ui-bg-field divide-x border-b",children:[e.jsx("th",{children:e.jsx(j,{className:"px-2 py-1 text-left",weight:"plus",size:"small",children:t("fields.key")})}),e.jsx("th",{children:e.jsx(j,{className:"px-2 py-1 text-left",weight:"plus",size:"small",children:t("fields.value")})})]})}),e.jsx("tbody",{children:a.map((l,c)=>e.jsx(D,{field:l,updateKey:d(c),updateValue:m(c),onDelete:o(c),isLast:c===a.length-1},c))})]}),!!n.length&&e.jsx(F,{variant:"warning",className:"mt-2",dismissible:!0,children:t("metadata.warnings.ignoredKeys",{keys:n.join(",")})})]})}const M=s=>s==null||typeof s=="string"||typeof s=="number"||typeof s=="boolean",S=s=>{const t=[];return s&&Object.entries(s).forEach(([a,n])=>{t.push({key:a,value:n,isInitial:!0,isIgnored:!M(n),isDeleted:!1})}),t.push({key:"",value:"",isInitial:!1,isIgnored:!1,isDeleted:!1}),t},z=s=>s.reduce((t,{key:a,value:n,isDeleted:i,isIgnored:d,isInitial:m})=>d?(t[a]=n,t):i&&m?(t[a]="",t):(a&&(t[a]=n),t),{}),K=_({email:p().email(),first_name:p().optional(),last_name:p().optional(),company_name:p().optional(),phone:p().optional(),metadata:I}),k=({customer:s})=>{const{t}=x(),{handleSuccess:a}=b(),n=v({defaultValues:{email:s.email||"",first_name:s.first_name||"",last_name:s.last_name||"",company_name:s.company_name||"",phone:s.phone||"",metadata:S(s.metadata)},resolver:y(K)}),{mutateAsync:i,isPending:d}=w(s.id),m=n.handleSubmit(async o=>{await i({email:s.has_account?void 0:o.email,first_name:o.first_name||null,last_name:o.last_name||null,phone:o.phone||null,company_name:o.company_name||null,metadata:z(o.metadata)},{onSuccess:({customer:l})=>{g.success(t("general.success"),{description:t("customers.edit.successToast",{email:l.email}),dismissLabel:t("actions.close")}),a()},onError:l=>{g.error(t("general.error"),{description:l.message,dismissLabel:t("actions.close")})}})});return e.jsx(h.Form,{form:n,children:e.jsxs("form",{onSubmit:m,className:"flex flex-1 flex-col",children:[e.jsx(h.Body,{children:e.jsxs("div",{className:"flex flex-col gap-y-4",children:[e.jsx(r.Field,{control:n.control,name:"email",render:({field:o})=>e.jsxs(r.Item,{children:[e.jsx(r.Label,{children:t("fields.email")}),e.jsx(r.Control,{children:e.jsx(C,{showTooltip:s.has_account,content:t("customers.edit.emailDisabledTooltip"),children:e.jsx(u,{...o,disabled:s.has_account})})}),e.jsx(r.ErrorMessage,{})]})}),e.jsx(r.Field,{control:n.control,name:"first_name",render:({field:o})=>e.jsxs(r.Item,{children:[e.jsx(r.Label,{children:t("fields.firstName")}),e.jsx(r.Control,{children:e.jsx(u,{...o})}),e.jsx(r.ErrorMessage,{})]})}),e.jsx(r.Field,{control:n.control,name:"last_name",render:({field:o})=>e.jsxs(r.Item,{children:[e.jsx(r.Label,{children:t("fields.lastName")}),e.jsx(r.Control,{children:e.jsx(u,{...o})}),e.jsx(r.ErrorMessage,{})]})}),e.jsx(r.Field,{control:n.control,name:"company_name",render:({field:o})=>e.jsxs(r.Item,{children:[e.jsx(r.Label,{children:t("fields.company")}),e.jsx(r.Control,{children:e.jsx(u,{...o})}),e.jsx(r.ErrorMessage,{})]})}),e.jsx(r.Field,{control:n.control,name:"phone",render:({field:o})=>e.jsxs(r.Item,{children:[e.jsx(r.Label,{children:t("fields.phone")}),e.jsx(r.Control,{children:e.jsx(u,{...o})}),e.jsx(r.ErrorMessage,{})]})}),e.jsx(L,{form:n})]})}),e.jsx(h.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(h.Close,{asChild:!0,children:e.jsx(f,{variant:"secondary",size:"small",children:t("actions.cancel")})}),e.jsx(f,{isLoading:d,type:"submit",variant:"primary",size:"small",children:t("actions.save")})]})})]})})},ce=()=>{const{t:s}=x(),{id:t}=E(),{customer:a,isLoading:n,isError:i,error:d}=N(t);if(i)throw d;return e.jsxs(h,{children:[e.jsx(h.Header,{children:e.jsx(V,{children:s("customers.edit.header")})}),!n&&a&&e.jsx(k,{customer:a})]})};export{ce as Component};
