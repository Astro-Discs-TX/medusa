import{u as x,j as s,ap as k}from"./index-S--WvUSo.js";import{u as v,a as c}from"./route-focus-modal-MMx5Xnk0.js";import{c as D,b as E}from"./api-keys-HCNnizij.js";import{t as M}from"./zod-jt04JUtm.js";import{r as C}from"./react-PzSkSLoa.js";import{u as z,H as B}from"./form-0PHaH8g8.js";import{o as H,a as I,s as L}from"./index-JzuMwgWW.js";import{a as F,D as N}from"./use-data-table-TeZp00wg.js";import{u as O}from"./sales-channels--fho5-f4.js";import{u as V,a as q}from"./use-sales-channel-table-query-O9OBIAwF.js";import{t as S}from"./toast-4oQfF9Sm.js";import{B as f}from"./button-Pc5Xo8ua.js";import{C as y}from"./checkbox-8MlXzZCx.js";import{T as G}from"./tooltip-Ixyw9oT8.js";import{c as Q}from"./index-JDlOzmVl.js";import{c as Z}from"./react-router-dom-aSYyayiN.js";import"./react-dom-Og6--24v.js";import"./drawer-H3TI1lDZ.js";import"./index-sF0hA49A.js";import"./heading-cSlef4Su.js";import"./prompt-LzbVPZYR.js";import"./information-circle-solid-rXH6vJ5W.js";import"./label-HFq5fzpT.js";import"./empty-table-content-i72rBIA2.js";import"./plus-mini-IRJECoWI.js";import"./index-1Zwdg31z.js";import"./use-date-Putn0_Ur.js";import"./format-vrL-wy9v.js";import"./date-picker-s8-9mila.js";import"./input-A29ux7yj.js";import"./minus-E5-czcFC.js";import"./x-mark-mini-aYDSd38M.js";import"./index-7dV3TD85.js";import"./index-Hm2Uj9Gg.js";import"./lodash-5s15_I2H.js";import"./command-bar-wUgfUfvQ.js";import"./products-_PEbH1CR.js";import"./status-cell-9XExsAIG.js";import"./text-cell-OtkuJsO8.js";import"./placeholder-cell-O6UVTGmQ.js";import"./x-circle-solid-rnqhxvfk.js";import"./check-circle-solid-7j4QonPK.js";const $=H({sales_channel_ids:I(L())}),u=50,J=({apiKey:i,preSelected:o=[]})=>{const{t:e}=x(),{handleSuccess:a}=v(),r=z({defaultValues:{sales_channel_ids:[]},resolver:M($)}),{setValue:l}=r,[n,m]=C.useState({}),{mutateAsync:p,isPending:j}=D(i),{raw:_,searchParams:b}=V({pageSize:u}),h=W(),{sales_channels:T,count:g,isLoading:A}=O({...b},{placeholderData:k}),P=t=>{const d=typeof t=="function"?t(n):t,K=Object.keys(d);l("sales_channel_ids",K,{shouldDirty:!0,shouldTouch:!0}),m(d)},{table:w}=F({data:T??[],columns:h,count:g,enablePagination:!0,enableRowSelection:t=>!o.includes(t.original.id),getRowId:t=>t.id,pageSize:u,rowSelection:{state:n,updater:P}}),R=r.handleSubmit(async t=>{await p({sales_channel_ids:t.sales_channel_ids},{onSuccess:()=>{S.success(e("general.success"),{description:e("apiKeyManagement.salesChannels.successToast",{count:t.sales_channel_ids.length}),dismissLabel:e("general.close")}),a()},onError:d=>{S.error(e("general.error"),{description:d.message,dismissLabel:e("general.close")})}})});return s.jsx(c.Form,{form:r,children:s.jsxs("form",{onSubmit:R,className:"flex h-full flex-col overflow-hidden",children:[s.jsx(c.Header,{children:s.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[r.formState.errors.sales_channel_ids&&s.jsx(B,{variant:"error",children:r.formState.errors.sales_channel_ids.message}),s.jsx(c.Close,{asChild:!0,children:s.jsx(f,{size:"small",variant:"secondary",children:e("actions.cancel")})}),s.jsx(f,{size:"small",type:"submit",isLoading:j,children:e("actions.save")})]})}),s.jsx(c.Body,{children:s.jsx(N,{table:w,columns:h,count:g,pageSize:u,pagination:!0,search:!0,isLoading:A,queryObject:_,orderBy:["name","created_at","updated_at"],layout:"fill"})})]})})},U=Q(),W=()=>{const{t:i}=x(),o=q();return C.useMemo(()=>[U.display({id:"select",header:({table:e})=>s.jsx(y,{checked:e.getIsSomePageRowsSelected()?"indeterminate":e.getIsAllPageRowsSelected(),onCheckedChange:a=>e.toggleAllPageRowsSelected(!!a)}),cell:({row:e})=>{const a=!e.getCanSelect(),r=e.getIsSelected()||a,l=s.jsx(y,{checked:r,disabled:a,onCheckedChange:n=>e.toggleSelected(!!n),onClick:n=>{n.stopPropagation()}});return a?s.jsx(G,{content:i("apiKeyManagement.salesChannels.alreadyAddedTooltip"),side:"right",children:l}):l}}),...o],[i,o])},Fe=()=>{var m;const{id:i}=Z(),{api_key:o,isLoading:e,isError:a,error:r}=E(i),l=(m=o==null?void 0:o.sales_channels)==null?void 0:m.map(p=>p.id),n=!e&&o;if(a)throw r;return s.jsx(c,{children:n&&s.jsx(J,{apiKey:i,preSelected:l})})};export{Fe as Component};
