import{a as I,j as e,u as d,T as f,r as C,i as S}from"./index-S--WvUSo.js";import{t as E}from"./zod-jt04JUtm.js";import{b as L,L as v}from"./react-router-dom-aSYyayiN.js";import{o as g,s as n,Z as A,n as k}from"./index-JzuMwgWW.js";import{r as w}from"./react-PzSkSLoa.js";import{u as F,F as s}from"./form-0PHaH8g8.js";import{d as M}from"./index.modern-Pe_E-6H8.js";import{L as H}from"./logo-box-TfH3D5h8.js";import{A as P}from"./index-99zzh8bn.js";import{m as u}from"./motion-jlFaYIfJ.js";import{T as V}from"./Trans-9IhttDMi.js";import{H as p}from"./heading-cSlef4Su.js";import{T as z}from"./tooltip-Ixyw9oT8.js";import{I as m}from"./input-A29ux7yj.js";import{A as B}from"./alert-dyv3SYtc.js";import{B as y}from"./button-Pc5Xo8ua.js";import"./react-dom-Og6--24v.js";import"./information-circle-solid-rXH6vJ5W.js";import"./label-HFq5fzpT.js";import"./x-mark-mini-aYDSd38M.js";import"./x-circle-solid-rnqhxvfk.js";import"./check-circle-solid-7j4QonPK.js";const R=g({email:n().email(),first_name:n().min(1),last_name:n().min(1),password:n().min(1),repeat_password:n().min(1)}).superRefine(({password:t,repeat_password:l},o)=>{t!==l&&o.addIssue({code:A.custom,message:I.t("invite.passwordMismatch"),path:["repeat_password"]})}),fe=()=>{const[t]=L(),[l,o]=w.useState(!1),r=t.get("token"),c=r?M(r):null,x=c&&q(c);return e.jsx("div",{className:"min-h-dvh w-dvw bg-ui-bg-base relative flex items-center justify-center p-4",children:e.jsxs("div",{className:"flex w-full max-w-[300px] flex-col items-center",children:[e.jsx(H,{className:"mb-4",checked:l,containerTransition:{duration:1.2,delay:.8,ease:[0,.71,.2,1.01]},pathTransition:{duration:1.3,delay:1.1,bounce:.6,ease:[.1,.8,.2,1.01]}}),e.jsx("div",{className:"max-h-[557px] w-full will-change-contents",children:x?e.jsx(P,{children:l?e.jsx(u.div,{initial:{opacity:0,scale:.4},animate:{opacity:1,scale:1},transition:{duration:1,delay:.6,ease:[0,.71,.2,1.01]},className:"w-full",children:e.jsx(K,{})},"success-view"):e.jsx(u.div,{initial:!1,animate:{height:"557px",y:0},exit:{height:0,y:40},transition:{duration:.8,delay:.6,ease:[0,.71,.2,1.01]},className:"w-full will-change-transform",children:e.jsx(u.div,{initial:!1,animate:{opacity:1,scale:1},exit:{opacity:0,scale:.7},transition:{duration:.6,delay:0,ease:[0,.71,.2,1.01]},children:e.jsx(D,{onSuccess:()=>o(!0),token:r,invite:c})},"inner-create-account")},"create-account")}):e.jsx(Z,{})})]})})},b=()=>{const{t}=d();return e.jsxs("div",{className:"flex w-full flex-col items-center",children:[e.jsx("div",{className:"my-6 h-px w-full border-b border-dotted"}),e.jsx("span",{className:"text-ui-fg-subtle txt-small",children:e.jsx(V,{t,i18nKey:"invite.alreadyHaveAccount",components:[e.jsx(v,{to:"/login",className:"text-ui-fg-interactive transition-fg hover:text-ui-fg-interactive-hover focus-visible:text-ui-fg-interactive-hover outline-none"},"login-link")]})})]})},Z=()=>{const{t}=d();return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"flex flex-col items-center gap-y-1",children:[e.jsx(p,{children:t("invite.invalidTokenTitle")}),e.jsx(f,{size:"small",className:"text-ui-fg-subtle text-center",children:t("invite.invalidTokenHint")})]}),e.jsx(b,{})]})},D=({onSuccess:t,token:l,invite:o})=>{const{t:r}=d(),[c,x]=w.useState(!1),a=F({resolver:E(R),defaultValues:{email:o.user_email,first_name:"",last_name:"",password:"",repeat_password:""}}),{mutateAsync:N,isLoading:T}=C(),_=a.handleSubmit(async i=>{await N({user:{first_name:i.first_name,last_name:i.last_name,password:i.password},token:l},{onSuccess:t,onError:j=>{var h;if(S(j)&&((h=j.response)==null?void 0:h.status)===400){a.setError("root",{type:"manual",message:r("invite.invalidInvite")}),x(!0);return}a.setError("root",{type:"manual",message:r("errors.serverError")})}})});return e.jsxs("div",{className:"flex w-full flex-col items-center",children:[e.jsxs("div",{className:"mb-4 flex flex-col items-center",children:[e.jsx(p,{children:r("invite.title")}),e.jsx(f,{size:"small",className:"text-ui-fg-subtle text-center",children:r("invite.hint")})]}),e.jsx(s,{...a,children:e.jsxs("form",{onSubmit:_,className:"flex w-full flex-col gap-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-y-4",children:[e.jsx(s.Field,{control:a.control,name:"email",render:({field:i})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{children:r("fields.email")}),e.jsx(s.Control,{children:e.jsx(z,{content:r("invite.emailTooltip"),children:e.jsx(m,{autoComplete:"off",...i,disabled:!0})})}),e.jsx(s.ErrorMessage,{})]})}),e.jsx(s.Field,{control:a.control,name:"first_name",render:({field:i})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{children:r("fields.firstName")}),e.jsx(s.Control,{children:e.jsx(m,{autoComplete:"given-name",...i})}),e.jsx(s.ErrorMessage,{})]})}),e.jsx(s.Field,{control:a.control,name:"last_name",render:({field:i})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{children:r("fields.lastName")}),e.jsx(s.Control,{children:e.jsx(m,{autoComplete:"family-name",...i})}),e.jsx(s.ErrorMessage,{})]})}),e.jsx(s.Field,{control:a.control,name:"password",render:({field:i})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{children:r("fields.password")}),e.jsx(s.Control,{children:e.jsx(m,{autoComplete:"new-password",type:"password",...i})}),e.jsx(s.ErrorMessage,{})]})}),e.jsx(s.Field,{control:a.control,name:"repeat_password",render:({field:i})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{children:r("fields.repeatPassword")}),e.jsx(s.Control,{children:e.jsx(m,{autoComplete:"off",type:"password",...i})}),e.jsx(s.ErrorMessage,{})]})}),a.formState.errors.root&&e.jsx(B,{variant:"error",dismissible:!1,className:"text-balance",children:a.formState.errors.root.message})]}),e.jsx(y,{className:"w-full",type:"submit",isLoading:T,disabled:c,children:r("invite.createAccount")})]})}),e.jsx(b,{})]})},K=()=>{const{t}=d();return e.jsxs("div",{className:"flex w-full flex-col items-center gap-y-6",children:[e.jsxs("div",{className:"flex flex-col items-center gap-y-1",children:[e.jsx(p,{children:t("invite.successTitle")}),e.jsx(f,{size:"small",className:"text-ui-fg-subtle text-center",children:t("invite.successHint")})]}),e.jsx(y,{variant:"secondary",asChild:!0,className:"w-full",children:e.jsx(v,{to:"/orders",replace:!0,children:t("invite.successAction")})})]})},$=g({invite_id:n(),role:n(),user_email:n().email(),iat:k()}),q=t=>$.safeParse(t).success;export{fe as Component};
