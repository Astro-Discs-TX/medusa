import{u as C,j as e}from"./index-S--WvUSo.js";import{u as z,a as n}from"./route-focus-modal-MMx5Xnk0.js";import{t as E}from"./zod-jt04JUtm.js";import{r as p}from"./react-PzSkSLoa.js";import{u as D,H as F}from"./form-0PHaH8g8.js";import{o as H,a as B,s as G}from"./index-JzuMwgWW.js";import{a as I,D as L}from"./use-data-table-TeZp00wg.js";import{d as M}from"./customer-groups-G4KCvF3b.js";import{u as N}from"./customers--tqEK1Bz.js";import{u as O,a as V,b as $}from"./use-customer-table-query-AiiD47-k.js";import{t as q}from"./toast-4oQfF9Sm.js";import{B as S}from"./button-Pc5Xo8ua.js";import{C as x}from"./checkbox-8MlXzZCx.js";import{T as Q}from"./tooltip-Ixyw9oT8.js";import{c as Z}from"./index-JDlOzmVl.js";import{c as J}from"./react-router-dom-aSYyayiN.js";import"./react-dom-Og6--24v.js";import"./drawer-H3TI1lDZ.js";import"./index-sF0hA49A.js";import"./heading-cSlef4Su.js";import"./prompt-LzbVPZYR.js";import"./information-circle-solid-rXH6vJ5W.js";import"./label-HFq5fzpT.js";import"./empty-table-content-i72rBIA2.js";import"./plus-mini-IRJECoWI.js";import"./index-1Zwdg31z.js";import"./use-date-Putn0_Ur.js";import"./format-vrL-wy9v.js";import"./date-picker-s8-9mila.js";import"./input-A29ux7yj.js";import"./minus-E5-czcFC.js";import"./x-mark-mini-aYDSd38M.js";import"./index-7dV3TD85.js";import"./index-Hm2Uj9Gg.js";import"./lodash-5s15_I2H.js";import"./command-bar-wUgfUfvQ.js";import"./placeholder-cell-O6UVTGmQ.js";import"./status-cell-9XExsAIG.js";import"./date-cell-G_vX9su2.js";import"./x-circle-solid-rnqhxvfk.js";import"./check-circle-solid-7j4QonPK.js";const K=H({customer_ids:B(G()).min(1)}),d=10,U=({customerGroupId:r})=>{const{t:i}=C(),{handleSuccess:f}=z(),s=D({defaultValues:{customer_ids:[]},resolver:E(K)}),{setValue:o}=s,[a,u]=p.useState({});p.useEffect(()=>{o("customer_ids",Object.keys(a).filter(t=>a[t]),{shouldDirty:!0,shouldTouch:!0})},[a,o]);const{searchParams:m,raw:j}=O({pageSize:d}),y=V(),{customers:b,count:h,isLoading:_,isError:T,error:w}=N({fields:"id,email,first_name,last_name,*groups",...m}),P=t=>{const c=typeof t=="function"?t(a):t,l=Object.keys(c);o("customer_ids",l,{shouldDirty:!0,shouldTouch:!0}),u(c)},g=X(),{table:A}=I({data:b??[],columns:g,count:h,enablePagination:!0,enableRowSelection:t=>{var c;return!((c=t.original.groups)!=null&&c.map(l=>l.id).includes(r))},getRowId:t=>t.id,pageSize:d,rowSelection:{state:a,updater:P}}),{mutateAsync:R,isPending:k}=M(r),v=s.handleSubmit(async t=>{await R({customer_ids:t.customer_ids.map(c=>({id:c}))},{onSuccess:()=>{q.success(i("general.success"),{description:i("customerGroups.customers.add.successToast",{count:t.customer_ids.length}),dismissLabel:i("actions.close")}),f(`/customer-groups/${r}`)}})});if(T)throw w;return e.jsx(n.Form,{form:s,children:e.jsxs("form",{className:"flex h-full flex-col overflow-hidden",onSubmit:v,children:[e.jsx(n.Header,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[s.formState.errors.customer_ids&&e.jsx(F,{variant:"error",children:s.formState.errors.customer_ids.message}),e.jsx(n.Close,{asChild:!0,children:e.jsx(S,{variant:"secondary",size:"small",children:i("actions.cancel")})}),e.jsx(S,{type:"submit",variant:"primary",size:"small",isLoading:k,children:i("actions.save")})]})}),e.jsx(n.Body,{className:"size-full overflow-hidden",children:e.jsx(L,{table:A,columns:g,pageSize:d,count:h,filters:y,orderBy:["email","first_name","last_name","has_account","created_at","updated_at"],isLoading:_,layout:"fill",search:!0,queryObject:j})})]})})},W=Z(),X=()=>{const{t:r}=C(),i=$();return p.useMemo(()=>[W.display({id:"select",header:({table:s})=>e.jsx(x,{checked:s.getIsSomePageRowsSelected()?"indeterminate":s.getIsAllPageRowsSelected(),onCheckedChange:o=>s.toggleAllPageRowsSelected(!!o)}),cell:({row:s})=>{const o=!s.getCanSelect(),a=s.getIsSelected()||o,u=e.jsx(x,{checked:a,disabled:o,onCheckedChange:m=>s.toggleSelected(!!m),onClick:m=>{m.stopPropagation()}});return o?e.jsx(Q,{content:r("customerGroups.customers.alreadyAddedTooltip"),side:"right",children:u}):u}}),...i],[r,i])},Me=()=>{const{id:r}=J();return e.jsx(n,{children:e.jsx(U,{customerGroupId:r})})};export{Me as Component};
