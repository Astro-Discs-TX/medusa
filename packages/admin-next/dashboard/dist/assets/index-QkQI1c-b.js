import{p as P,f as C,u as D,d as p}from"./promotions-hsTHlNrt.js";import{Z as N,W as S,u as n,j as e,a1 as g,T as i}from"./index-S--WvUSo.js";import{J as T}from"./json-view-section-Dui2O31i.js";import{r as _}from"./react-PzSkSLoa.js";import{A as f}from"./action-menu-olZwXQ3q.js";import{N as w}from"./empty-table-content-i72rBIA2.js";import{c as z,a as A,d as L,O as E}from"./react-router-dom-aSYyayiN.js";import{P as j}from"./pencil-square-u3fizEAQ.js";import{H as h}from"./heading-cSlef4Su.js";import{f as B}from"./format-vrL-wy9v.js";import{B as R}from"./badge-list-summary-xN70drfF.js";import{B as k}from"./badge-99FyByJO.js";import{P as o,g as q}from"./promotions-0QMhkDUf.js";import{T as I}from"./trash-nTjeUaCp.js";import{u as $}from"./use-prompt-wB0F2CxI.js";import{S as M}from"./status-badge-sML89E1A.js";import{C as Q}from"./copy-jbaNBJoS.js";import"./react-dom-Og6--24v.js";import"./drawer-H3TI1lDZ.js";import"./index-sF0hA49A.js";import"./x-mark-mini-aYDSd38M.js";import"./plus-mini-IRJECoWI.js";import"./button-Pc5Xo8ua.js";import"./tooltip-Ixyw9oT8.js";import"./prompt-LzbVPZYR.js";import"./input-A29ux7yj.js";import"./label-HFq5fzpT.js";import"./check-circle-solid-7j4QonPK.js";const V=s=>({queryKey:P.detail(s),queryFn:()=>S.promotions.retrieve(s)}),we=async({params:s})=>{const t=s.id,a=V(t);return N.getQueryData(a.queryKey)??await N.fetchQuery(a)};function v(s){return s?B(new Date(s),"dd MMM yyyy"):"-"}const H=({campaign:s})=>{const{t}=n();return e.jsxs(_.Fragment,{children:[e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[e.jsx(i,{size:"small",weight:"plus",leading:"compact",children:t("campaigns.fields.name")}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx(i,{size:"small",leading:"compact",className:"text-pretty",children:s==null?void 0:s.name})})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[e.jsx(i,{size:"small",weight:"plus",leading:"compact",children:t("campaigns.fields.identifier")}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx(i,{size:"small",leading:"compact",className:"text-pretty",children:s==null?void 0:s.campaign_identifier})})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[e.jsx(i,{size:"small",weight:"plus",leading:"compact",children:t("campaigns.fields.start_date")}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx(i,{size:"small",leading:"compact",className:"text-pretty",children:v(s==null?void 0:s.starts_at)})})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[e.jsx(i,{size:"small",weight:"plus",leading:"compact",children:t("campaigns.fields.end_date")||"-"}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx(i,{size:"small",leading:"compact",className:"text-pretty",children:v(s==null?void 0:s.ends_at)})})]})]})},b=({campaign:s})=>{const{t}=n(),{id:a}=z();return e.jsxs(g,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(h,{level:"h2",children:t("promotions.fields.campaign")}),e.jsx(f,{groups:[{actions:[{label:t("actions.edit"),to:"add-to-campaign",icon:e.jsx(j,{})}]}]})]}),s?e.jsx(H,{campaign:s}):e.jsx(w,{className:"h-[180px] p-6 text-center",title:"Not part of a campaign",message:"Add this promotion to an existing campaign",action:{to:`/promotions/${a}/add-to-campaign`,label:"Add to Campaign"},buttonVariant:"transparentIconLeft"})]})};function K({rule:s}){return e.jsx("div",{className:"bg-ui-bg-subtle shadow-borders-base flex justify-around rounded-md p-2 align-center",children:e.jsxs("div",{className:"flex text-ui-fg-subtle txt-compact-xsmall whitespace-nowrap items-center",children:[e.jsx(k,{size:"2xsmall",className:"mx-1 txt-compact-xsmall-plus tag-neutral-text truncate inline-block",children:s.attribute_label},"rule-attribute"),e.jsx("span",{className:"mx-1 txt-compact-2xsmall inline-block",children:s.operator_label}),e.jsx(R,{inline:!0,className:"!txt-compact-small-plus",list:s.values.map(t=>t.label)})]})})}const u=({rules:s,ruleType:t})=>{const{t:a}=n();return e.jsxs(g,{className:"p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx("div",{className:"flex flex-col",children:e.jsx(h,{children:a(`promotions.fields.conditions.${t}.title`)})}),e.jsx(f,{groups:[{actions:[{icon:e.jsx(j,{}),label:a("actions.edit"),to:`${t}/edit`}]}]})]}),e.jsxs("div",{className:"text-ui-fg-subtle flex flex-col gap-2 px-6 pb-4 pt-2",children:[!s.length&&e.jsx(w,{className:"h-[180px]",title:"No records yet.",message:"Please check back later or add a target condition today",action:{to:"/promotions",label:"Add condition"},buttonVariant:"transparentIconLeft"}),s.map(l=>e.jsx(K,{rule:l},`${l.id}-${l.attribute}`))]})]})},F=({promotion:s})=>{var r,y;const{t}=n(),a=$(),l=A(),{mutateAsync:d}=C(s.id),m=async()=>{await a({title:t("general.areYouSure"),description:t("promotions.deleteWarning",{code:s.code}),verificationInstruction:t("general.typeToConfirm"),verificationText:s.code,confirmText:t("actions.delete"),cancelText:t("actions.cancel")})&&await d(void 0,{onSuccess:()=>{l("/promotions",{replace:!0})}})},[x,c]={[o.DISABLED]:["grey",t("statuses.disabled")],[o.ACTIVE]:["green",t("statuses.active")],[o.SCHEDULED]:["orange",t("statuses.scheduled")],[o.EXPIRED]:["red",t("statuses.expired")]}[q(s)];return e.jsxs(g,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx("div",{className:"flex flex-col",children:e.jsx(h,{children:s.code})}),e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx(M,{color:x,children:c}),e.jsx(f,{groups:[{actions:[{icon:e.jsx(j,{}),label:t("actions.edit"),to:`/promotions/${s.id}/edit`}]},{actions:[{icon:e.jsx(I,{}),label:t("actions.delete"),onClick:m}]}]})]})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-start px-6 py-4",children:[e.jsx(i,{size:"small",weight:"plus",leading:"compact",children:t("promotions.fields.method")}),e.jsx(i,{size:"small",leading:"compact",className:"text-pretty",children:s.is_automatic?"Promotion code":"Automatic"})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[e.jsx(i,{size:"small",weight:"plus",leading:"compact",children:t("fields.code")}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(i,{size:"small",weight:"plus",leading:"compact",className:"text-pretty",children:s.code}),e.jsx(Q,{content:s.code,variant:"mini"})]})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-start px-6 py-4",children:[e.jsx(i,{size:"small",weight:"plus",leading:"compact",children:t("promotions.fields.type")}),e.jsx(i,{size:"small",leading:"compact",className:"text-pretty capitalize",children:s.type})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-start px-6 py-4",children:[e.jsx(i,{size:"small",weight:"plus",leading:"compact",children:t("promotions.fields.value")}),e.jsx(i,{size:"small",leading:"compact",className:"text-pretty",children:(r=s.application_method)==null?void 0:r.value})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-start px-6 py-4",children:[e.jsx(i,{size:"small",weight:"plus",leading:"compact",children:t("promotions.fields.allocation")}),e.jsx(i,{size:"small",leading:"compact",className:"text-pretty capitalize",children:(y=s.application_method)==null?void 0:y.allocation})]})]})},J={widgets:[]},O={widgets:[]},ze=()=>{const s=L(),{id:t}=z(),{promotion:a,isLoading:l}=D(t,{initialData:s}),{rules:d}=p(t,"rules"),{rules:m}=p(t,"target-rules"),{rules:x}=p(t,"buy-rules");return l||!a?e.jsx("div",{children:"Loading..."}):e.jsxs("div",{className:"flex flex-col gap-y-2",children:[O.widgets.map((c,r)=>e.jsx("div",{children:e.jsx(c.Component,{})},r)),e.jsxs("div",{className:"flex flex-col gap-x-4 xl:flex-row xl:items-start",children:[e.jsxs("div",{className:"flex w-full flex-col gap-y-2",children:[e.jsx(F,{promotion:a}),e.jsx(u,{rules:d||[],ruleType:"rules"}),e.jsx(u,{rules:m||[],ruleType:"target-rules"}),a.type==="buyget"&&e.jsx(u,{rules:x||[],ruleType:"buy-rules"}),e.jsx("div",{className:"flex w-full flex-col gap-y-2 xl:hidden",children:e.jsx(b,{campaign:a.campaign})}),J.widgets.map((c,r)=>e.jsx("div",{children:e.jsx(c.Component,{})},r)),e.jsx(T,{data:a})]}),e.jsx("div",{className:"hidden w-full max-w-[400px] flex-col gap-y-2 xl:flex",children:e.jsx(b,{campaign:a.campaign})})]}),e.jsx(E,{})]})};export{ze as Component,we as loader};
