import{u as he,j as e,d as p,T as K}from"./index-S--WvUSo.js";import{u as be,a as _}from"./route-focus-modal-MMx5Xnk0.js";import{a as ge,u as ye}from"./add-campaign-promotion-form-HDxFGkWW.js";import{b as je,c as F,d as O,e as _e}from"./promotions-hsTHlNrt.js";import{t as ve}from"./zod-jt04JUtm.js";import{r as j}from"./react-PzSkSLoa.js";import{u as Ce,c as V,a as T,F as o}from"./form-0PHaH8g8.js";import{P as Ne}from"./percentage-input-hee_tAkG.js";import{g as Re}from"./currencies-bd3ADI6s.js";import{R as E}from"./index-vIJsbe7W.js";import{z as s}from"./index-JzuMwgWW.js";import{T as U}from"./Trans-9IhttDMi.js";import{P as x}from"./progress-tabs-S8wsVeqQ.js";import{B}from"./button-Pc5Xo8ua.js";import{R as c}from"./radio-group-asQL-yXP.js";import{A as Pe}from"./alert-dyv3SYtc.js";import{I as $}from"./input-A29ux7yj.js";import{C as Te}from"./currency-input-k1bgGOuE.js";import"./react-dom-Og6--24v.js";import"./react-router-dom-aSYyayiN.js";import"./drawer-H3TI1lDZ.js";import"./index-sF0hA49A.js";import"./heading-cSlef4Su.js";import"./prompt-LzbVPZYR.js";import"./select-Z4sV_-wF.js";import"./index-Hm2Uj9Gg.js";import"./tooltip-Ixyw9oT8.js";import"./triangles-mini-HukRlWGp.js";import"./information-circle-solid-rXH6vJ5W.js";import"./label-HFq5fzpT.js";import"./combobox-DjjFlb75.js";import"./x-mark-mini-aYDSd38M.js";import"./plus-mini-IRJECoWI.js";import"./badge-99FyByJO.js";import"./check-circle-solid-7j4QonPK.js";import"./index-7dV3TD85.js";import"./x-circle-solid-rnqhxvfk.js";var n=(m=>(m.TYPE="type",m.PROMOTION="promotion",m.CAMPAIGN="campaign",m))(n||{});const S=s.array(s.object({id:s.string().optional(),attribute:s.string().min(1,{message:"Required field"}),operator:s.string().min(1,{message:"Required field"}),values:s.union([s.number().min(1,{message:"Required field"}),s.string().min(1,{message:"Required field"}),s.array(s.string()).min(1,{message:"Required field"})]),required:s.boolean().optional(),disguised:s.boolean().optional(),field_type:s.string().optional()})),Ae=s.object({template_id:s.string().optional(),campaign_id:s.string().optional(),existing:s.string().toLowerCase().optional(),is_automatic:s.string().toLowerCase(),code:s.string().min(1),type:s.enum(["buyget","standard"]),rules:S,application_method:s.object({allocation:s.enum(["each","across"]),value:s.number().min(0),max_quantity:s.number().optional(),target_rules:S,buy_rules:S.min(2).optional(),type:s.enum(["fixed","percentage"]),target_type:s.enum(["order","shipping_methods","items"])})}),q=[{id:"amount_off_products",type:"standard",title:"Amount off products",description:"Discount specific products or collection of products",defaults:{is_automatic:"false",type:"standard",application_method:{allocation:"each",target_type:"items",type:"fixed"}}},{id:"amount_off_order",type:"standard",title:"Amount off order",description:"Discounts the total order amount",defaults:{is_automatic:"false",type:"standard",application_method:{allocation:"across",target_type:"order",type:"fixed"}}},{id:"percentage_off_product",type:"standard",title:"Percentage off product",description:"Discounts a percentage off selected products",defaults:{is_automatic:"false",type:"standard",application_method:{allocation:"each",target_type:"items",type:"percentage"}}},{id:"percentage_off_order",type:"standard",title:"Percentage off order",description:"Discounts a percentage of the total order amount",defaults:{is_automatic:"false",type:"standard",application_method:{allocation:"across",target_type:"items",type:"percentage"}}}],Ie=({ruleAttributes:m,targetRuleAttributes:v,buyRuleAttributes:C,operators:f,rules:N,targetRules:b,buyRules:h,campaigns:R})=>{const[A,g]=j.useState(n.TYPE),[k,I]=j.useState(!1),{t:a}=he(),{handleSuccess:H}=be(),P=t=>t.map(l=>{var d;return{id:l.id,required:l.required,field_type:l.field_type,disguised:l.disguised,attribute:l.attribute,operator:l.operator,values:(d=l==null?void 0:l.values)==null?void 0:d.map(u=>u.value)}}),r=Ce({defaultValues:{campaign_id:void 0,template_id:q[0].id,existing:"true",is_automatic:"false",code:"",type:"standard",rules:P(N),application_method:{allocation:"each",type:"fixed",target_type:"items",max_quantity:1,target_rules:P(b),buy_rules:P(h)}},resolver:ve(Ae)}),{fields:W,append:J,remove:Q,update:X}=V({control:r.control,name:"rules",keyName:"rules_id"}),{fields:Z,append:ee,remove:te,update:oe}=V({control:r.control,name:"application_method.target_rules",keyName:"target_rules_id"}),{fields:ae,append:re,remove:se,update:ie}=V({control:r.control,name:"application_method.buy_rules",keyName:"buy_rules_id"}),{mutateAsync:le}=je(),ne=r.handleSubmit(async t=>{const{existing:l,is_automatic:d,template_id:u,application_method:M,rules:pe,...xe}=t,{target_rules:G=[],buy_rules:z=[],...fe}=M,w=[...b.filter(i=>!!i.disguised),...h.filter(i=>!!i.disguised)].map(i=>i.attribute),Y={};for(const i of[...G,...z])w.includes(i.attribute)&&(Y[i.attribute]=i.values);le({...xe,rules:pe.map(i=>({operator:i.operator,attribute:i.attribute,values:i.values})),application_method:{...fe,...Y,target_rules:G.filter(i=>!w.includes(i.attribute)).map(i=>({operator:i.operator,attribute:i.attribute,values:i.values})),buy_rules:z.filter(i=>!w.includes(i.attribute)).map(i=>({operator:i.operator,attribute:i.attribute,values:i.values}))},is_automatic:d==="true"}).then(()=>H())},async t=>{}),ce=async()=>{switch(A){case n.TYPE:g(n.PROMOTION);break;case n.PROMOTION:await r.trigger()&&g(n.CAMPAIGN);break;case n.CAMPAIGN:break}},de=t=>{switch(t){case n.TYPE:I(!1),g(t);break;case n.PROMOTION:I(!1),g(t);break;case n.CAMPAIGN:I(!1),g(t);break}},L=T({control:r.control,name:"template_id"});j.useMemo(()=>{const t=q.find(l=>l.id===L);if(t)for(const[l,d]of Object.entries(t.defaults))if(typeof d=="object")for(const[u,M]of Object.entries(d))r.setValue(`application_method.${u}`,M);else r.setValue(l,d)},[L]);const D=T({control:r.control,name:"application_method.type"})==="fixed",ue=T({control:r.control,name:"application_method.allocation"})==="each",y=T({control:r.control,name:"type"})==="standard";j.useEffect(()=>{y?r.setValue("application_method.buy_rules",void 0):r.setValue("application_method.buy_rules",P(h))},[y]);const me=j.useMemo(()=>k?"completed":"not-started",[k]);return e.jsx(_.Form,{form:r,children:e.jsx("form",{className:"flex h-full flex-col overflow-scroll",onSubmit:ne,children:e.jsxs(x,{value:A,onValueChange:t=>de(t),children:[e.jsx(_.Header,{children:e.jsxs("div",{className:"flex w-full items-center justify-between gap-x-4",children:[e.jsx("div",{className:"-my-2 w-full max-w-[400px] border-l",children:e.jsxs(x.List,{className:"grid w-full grid-cols-3",children:[e.jsx(x.Trigger,{className:"w-full",value:n.TYPE,status:me,children:a("fields.type")}),e.jsx(x.Trigger,{className:"w-full",value:n.PROMOTION,children:a("fields.details")}),e.jsx(x.Trigger,{className:"w-full",value:n.CAMPAIGN,children:a("promotions.fields.campaign")})]})}),e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx(_.Close,{asChild:!0,children:e.jsx(B,{variant:"secondary",size:"small",children:a("actions.cancel")})}),A===n.CAMPAIGN?e.jsx(B,{type:"submit",size:"small",isLoading:!1,children:a("actions.save")},"save-btn"):e.jsx(B,{type:"button",onClick:ce,size:"small",children:a("actions.continue")},"continue-btn")]})]})}),e.jsxs(_.Body,{className:"mx-auto my-20 w-[800px]",children:[e.jsx(x.Content,{value:n.TYPE,children:e.jsx(o.Field,{control:r.control,name:"template_id",render:({field:t})=>e.jsxs(o.Item,{children:[e.jsx(o.Label,{children:a("promotions.fields.type")}),e.jsx(o.Control,{children:e.jsx(c,{className:"flex-col gap-y-3",...t,onValueChange:t.onChange,children:q.map(l=>e.jsx(c.ChoiceBox,{value:l.id,label:l.title,description:l.description,className:p("",{"border-ui-border-interactive border-2":l.id===t.value})},l.id))},"template_id")}),e.jsx(o.ErrorMessage,{})]})})}),e.jsxs(x.Content,{value:n.PROMOTION,className:"flex flex-1 flex-col gap-10",children:[r.formState.errors.root&&e.jsx(Pe,{variant:"error",dismissible:!1,className:"text-balance",children:r.formState.errors.root.message}),e.jsx(o.Field,{control:r.control,name:"is_automatic",render:({field:t})=>e.jsxs(o.Item,{children:[e.jsx(o.Label,{children:"Method"}),e.jsx(o.Control,{children:e.jsxs(c,{className:"flex gap-y-3",...t,value:t.value,onValueChange:t.onChange,children:[e.jsx(c.ChoiceBox,{value:"false",label:a("promotions.form.method.code.title"),description:a("promotions.form.method.code.description"),className:p("basis-1/2",{"border-ui-border-interactive border-2":t.value==="false"})}),e.jsx(c.ChoiceBox,{value:"true",label:a("promotions.form.method.automatic.title"),description:a("promotions.form.method.automatic.description"),className:p("basis-1/2",{"border-ui-border-interactive border-2":t.value==="true"})})]})}),e.jsx(o.ErrorMessage,{})]})}),e.jsx("div",{className:"flex gap-y-4",children:e.jsx(o.Field,{control:r.control,name:"code",render:({field:t})=>e.jsxs(o.Item,{className:"basis-1/2",children:[e.jsx(o.Label,{children:a("promotions.form.code.title")}),e.jsx(o.Control,{children:e.jsx($,{...t,placeholder:"SUMMER15"})}),e.jsx(K,{size:"small",leading:"compact",className:"text-ui-fg-subtle",children:e.jsx(U,{t:a,i18nKey:"promotions.form.code.description",components:[e.jsx("br",{},"break")]})})]})})}),e.jsx(o.Field,{control:r.control,name:"application_method.type",render:({field:t})=>e.jsxs(o.Item,{children:[e.jsx(o.Label,{children:a("promotions.fields.value_type")}),e.jsx(o.Control,{children:e.jsxs(c,{className:"flex gap-y-3",...t,onValueChange:t.onChange,children:[e.jsx(c.ChoiceBox,{value:"fixed",label:a("promotions.form.value_type.fixed.title"),description:a("promotions.form.value_type.fixed.description"),className:p("basis-1/2",{"border-ui-border-interactive border-2":t.value==="fixed"})}),e.jsx(c.ChoiceBox,{value:"percentage",label:a("promotions.form.value_type.percentage.title"),description:a("promotions.form.value_type.percentage.description"),className:p("basis-1/2",{"border-ui-border-interactive border-2":t.value==="percentage"})})]})}),e.jsx(o.ErrorMessage,{})]})}),e.jsx("div",{className:"flex gap-y-4",children:e.jsx(o.Field,{control:r.control,name:"application_method.value",render:({field:{onChange:t,value:l,...d}})=>e.jsxs(o.Item,{className:"basis-1/2",children:[e.jsx(o.Label,{children:a(D?"fields.amount":"fields.percentage")}),e.jsx(o.Control,{children:D?e.jsx(Te,{min:0,onValueChange:u=>{t(u?parseInt(u):"")},code:"USD",symbol:Re("USD"),...d,value:l}):e.jsx(Ne,{className:"text-right",min:0,max:100,...d,value:l,onChange:u=>{t(u.target.value===""?null:parseInt(u.target.value))}},"amount")}),e.jsx(o.ErrorMessage,{})]})})}),e.jsx(o.Field,{control:r.control,name:"type",render:({field:t})=>e.jsxs(o.Item,{children:[e.jsx(o.Label,{children:a("promotions.fields.type")}),e.jsx(o.Control,{children:e.jsxs(c,{className:"flex gap-y-3",...t,onValueChange:t.onChange,children:[e.jsx(c.ChoiceBox,{value:"standard",label:a("promotions.form.type.standard.title"),description:a("promotions.form.type.standard.description"),className:p("basis-1/2",{"border-ui-border-interactive border-2":t.value==="standard"})}),e.jsx(c.ChoiceBox,{value:"buyget",label:a("promotions.form.type.buyget.title"),description:a("promotions.form.type.buyget.description"),className:p("basis-1/2",{"border-ui-border-interactive border-2":t.value==="buyget"})})]})}),e.jsx(o.ErrorMessage,{})]})}),y&&e.jsx(o.Field,{control:r.control,name:"application_method.allocation",render:({field:t})=>e.jsxs(o.Item,{children:[e.jsx(o.Label,{children:a("promotions.fields.allocation")}),e.jsx(o.Control,{children:e.jsxs(c,{className:"flex gap-y-3",...t,onValueChange:t.onChange,children:[e.jsx(c.ChoiceBox,{value:"each",label:a("promotions.form.allocation.each.title"),description:a("promotions.form.allocation.each.description"),className:p("basis-1/2",{"border-ui-border-interactive border-2":t.value==="each"})}),e.jsx(c.ChoiceBox,{value:"across",label:a("promotions.form.allocation.across.title"),description:a("promotions.form.allocation.across.description"),className:p("basis-1/2",{"border-ui-border-interactive border-2":t.value==="across"})})]})}),e.jsx(o.ErrorMessage,{})]})}),y&&ue&&e.jsx("div",{className:"flex gap-y-4",children:e.jsx(o.Field,{control:r.control,name:"application_method.max_quantity",render:({field:t})=>e.jsxs(o.Item,{className:"basis-1/2",children:[e.jsx(o.Label,{children:a("promotions.form.max_quantity.title")}),e.jsx(o.Control,{children:e.jsx($,{...r.register("application_method.max_quantity",{valueAsNumber:!0}),type:"number",min:1,placeholder:"3"})}),e.jsx(K,{size:"small",leading:"compact",className:"text-ui-fg-subtle",children:e.jsx(U,{t:a,i18nKey:"promotions.form.max_quantity.description",components:[e.jsx("br",{},"break")]})})]})})}),e.jsx(E,{form:r,ruleType:"rules",attributes:m,operators:f,fields:W,appendRule:J,removeRule:Q,updateRule:X}),e.jsx(E,{form:r,ruleType:"target-rules",attributes:v,operators:f,fields:Z,appendRule:ee,removeRule:te,updateRule:oe,scope:"application_method.target_rules"}),!y&&e.jsx(E,{form:r,ruleType:"buy-rules",attributes:C,operators:f,fields:ae,appendRule:re,removeRule:se,updateRule:ie,scope:"application_method.buy_rules"})]}),e.jsx(x.Content,{value:n.CAMPAIGN,className:"flex flex-col items-center",children:e.jsx(ge,{form:r,campaigns:R})})]})]})})})},ht=()=>{const{attributes:m}=F("rules"),{attributes:v}=F("target-rules"),{attributes:C}=F("buy-rules"),{rules:f}=O(null,"rules"),{rules:N}=O(null,"target-rules"),{rules:b}=O(null,"buy-rules"),{operators:h}=_e(),{campaigns:R}=ye();return e.jsx(_,{children:f&&b&&N&&R&&h&&m&&v&&C&&e.jsx(Ie,{ruleAttributes:m,targetRuleAttributes:v,buyRuleAttributes:C,operators:h,rules:f,targetRules:N,buyRules:b,campaigns:R})})};export{ht as Component};
