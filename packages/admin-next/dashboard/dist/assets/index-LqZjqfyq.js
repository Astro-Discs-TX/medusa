import{u as N,j as e,T as y}from"./index-S--WvUSo.js";import{o as k,s as x,n as M}from"./index-JzuMwgWW.js";import{u as z,a as d}from"./route-focus-modal-MMx5Xnk0.js";import{t as L}from"./zod-jt04JUtm.js";import{a as B}from"./react-PzSkSLoa.js";import{u as E,F as s}from"./form-0PHaH8g8.js";import{C as b}from"./combobox-DjjFlb75.js";import{a as H}from"./inventory-EQcmxo3i.js";import{u as P}from"./reservations-e8r1gx2W.js";import{u as A}from"./stock-locations-5f5MPAbM.js";import{t as V}from"./toast-4oQfF9Sm.js";import{B as g}from"./button-Pc5Xo8ua.js";import{H as $}from"./heading-cSlef4Su.js";import{I as G}from"./input-A29ux7yj.js";import{T as D}from"./textarea-D4fuXHvE.js";import"./react-dom-Og6--24v.js";import"./react-router-dom-aSYyayiN.js";import"./drawer-H3TI1lDZ.js";import"./index-sF0hA49A.js";import"./prompt-LzbVPZYR.js";import"./information-circle-solid-rXH6vJ5W.js";import"./label-HFq5fzpT.js";import"./tooltip-Ixyw9oT8.js";import"./x-mark-mini-aYDSd38M.js";import"./triangles-mini-HukRlWGp.js";import"./plus-mini-IRJECoWI.js";import"./x-circle-solid-rnqhxvfk.js";import"./check-circle-solid-7j4QonPK.js";const J=k({inventory_item_id:x().min(1),location_id:x().min(1),quantity:M().min(1),description:x().optional()}),u=({title:i,value:p})=>e.jsxs("div",{className:"grid grid-cols-2 divide-x",children:[e.jsx(y,{className:"px-2 py-1.5",size:"small",leading:"compact",children:i}),e.jsx(y,{className:"px-2 py-1.5",size:"small",leading:"compact",children:p})]}),K=()=>{var j,v;const{t:i}=N(),{handleSuccess:p}=z(),[h,_]=B.useState(null),a=E({defaultValues:{inventory_item_id:"",location_id:"",quantity:0,description:""},resolver:L(J)}),{inventory_items:m}=H({q:h},{enabled:!!h}),C=a.watch("inventory_item_id"),o=m==null?void 0:m.find(t=>t.id===C),S=a.watch("location_id"),n=(j=o==null?void 0:o.location_levels)==null?void 0:j.find(t=>t.location_id===S),q=a.watch("quantity"),{stock_locations:w}=A({id:((v=o==null?void 0:o.location_levels)==null?void 0:v.map(t=>t.location_id))??[]},{enabled:!!o}),{mutateAsync:F,isPending:R}=P(),T=a.handleSubmit(async t=>{await F(t,{onSuccess:({reservation:l})=>{V.success(i("general.success"),{dismissLabel:i("actions.close"),description:i("inventory.reservation.successToast")}),p(`/reservations/${l.id}`)}})});return e.jsx(d.Form,{form:a,children:e.jsxs("form",{onSubmit:T,children:[e.jsx(d.Header,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(d.Close,{asChild:!0,children:e.jsx(g,{variant:"secondary",size:"small",children:i("actions.cancel")})}),e.jsx(g,{type:"submit",variant:"primary",size:"small",isLoading:R,children:i("actions.reservation")})]})}),e.jsx(d.Body,{className:"flex flex-col items-center pt-[72px]",children:e.jsxs("div",{className:"flex w-full max-w-[720px] flex-col gap-y-8",children:[e.jsx($,{children:i("inventory.reservation.create")}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(s.Field,{control:a.control,name:"inventory_item_id",render:({field:{value:t,onChange:l,...c}})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{children:i("inventory.reservation.itemToReserve")}),e.jsx(s.Control,{children:e.jsx(b,{onSearchValueChange:r=>_(r),value:t,onChange:r=>{l(r)},...c,options:(m??[]).map(r=>({label:r.title??r.sku,value:r.id}))})})]})},"inventory_item_id"),e.jsx(s.Field,{control:a.control,name:"location_id",render:({field:{value:t,onChange:l,...c}})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{children:i("fields.location")}),e.jsx(s.Control,{children:e.jsx(b,{disabled:!!o,value:t,onChange:r=>{l(r)},...c,options:(w??[]).map(r=>({label:r.name,value:r.id}))})})]})},"location_id")]}),e.jsxs("div",{className:"text-ui-fg-subtle shadow-elevation-card-rest grid grid-rows-4 divide-y rounded-lg border",children:[e.jsx(u,{title:i("fields.title"),value:(o==null?void 0:o.title)??(o==null?void 0:o.sku)??"-"}),e.jsx(u,{title:i("fields.sku"),value:(o==null?void 0:o.sku)??"-"}),e.jsx(u,{title:i("fields.inStock"),value:(n==null?void 0:n.stocked_quantity)??"-"}),e.jsx(u,{title:i("inventory.available"),value:n?n.available_quantity-q:"-"})]}),e.jsx("div",{className:"w-full lg:w-1/2",children:e.jsx(s.Field,{control:a.control,name:"quantity",render:({field:{onChange:t,value:l,...c}})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{children:i("fields.quantity")}),e.jsx(s.Control,{children:e.jsx(G,{type:"number",placeholder:i("inventory.reservation.quantityPlaceholder"),min:0,max:n?n.available_quantity:0,value:l||"",onChange:r=>{const f=r.target.value;t(f===""?null:parseFloat(f))},...c})}),e.jsx(s.ErrorMessage,{})]})})}),e.jsx(s.Field,{control:a.control,name:"description",render:({field:t})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{optional:!0,children:i("fields.description")}),e.jsx(s.Control,{children:e.jsx(D,{...t,placeholder:i("inventory.reservation.descriptionPlaceholder")})}),e.jsx(s.ErrorMessage,{})]})})]})})]})})},be=()=>e.jsx(d,{children:e.jsx(K,{})});export{be as Component};
