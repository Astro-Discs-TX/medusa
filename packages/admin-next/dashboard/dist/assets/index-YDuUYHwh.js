import{u as N,al as D,j as e,T as I,am as L}from"./index-S--WvUSo.js";import{u as M,R as j}from"./route-focus-modal-MMx5Xnk0.js";import{t as T}from"./zod-jt04JUtm.js";import{p as H}from"./index-zCI1L4vn.js";import{r as k}from"./react-PzSkSLoa.js";import{u as S,F as s}from"./form-0PHaH8g8.js";import{o as O,b as f,d as y,u as m,s as u,n as x}from"./index-JzuMwgWW.js";import{p as P}from"./common-Hakaf8MH.js";import{T as R}from"./Trans-9IhttDMi.js";import{D as C}from"./date-picker-s8-9mila.js";import{S as p}from"./switch-VR1xZXYU.js";import{I as h}from"./input-A29ux7yj.js";import{B as v}from"./button-Pc5Xo8ua.js";import{f as z}from"./formatISODuration-S3SWj11X.js";import{c as B}from"./react-router-dom-aSYyayiN.js";import{H as A}from"./heading-cSlef4Su.js";import"./react-dom-Og6--24v.js";import"./drawer-H3TI1lDZ.js";import"./index-sF0hA49A.js";import"./prompt-LzbVPZYR.js";import"./information-circle-solid-rXH6vJ5W.js";import"./label-HFq5fzpT.js";import"./tooltip-Ixyw9oT8.js";import"./index-1Zwdg31z.js";import"./minus-E5-czcFC.js";import"./index-Hm2Uj9Gg.js";const K=O({start_date_enabled:f(),start_date:y(),end_date_enabled:f(),end_date:y().nullish(),enable_usage_limit:f(),usage_limit:m([u(),x()]).optional(),enable_duration:f(),years:m([u(),x()]).optional(),months:m([u(),x()]).optional(),days:m([u(),x()]).optional(),hours:m([u(),x()]).optional(),minutes:m([u(),x()]).optional()}),U=({discount:o})=>{const{t:l}=N(),{handleSuccess:g}=M(),d=k.useMemo(()=>o.valid_duration?H(o.valid_duration):{years:0,months:0,days:0,hours:0,minutes:0},[o]),t=S({defaultValues:{start_date_enabled:!!o.starts_at,start_date:new Date(o.starts_at),enable_usage_limit:!!o.usage_limit,usage_limit:o.usage_limit||"",enable_duration:!!o.valid_duration,end_date_enabled:!!o.ends_at,end_date:o.ends_at?new Date(o.ends_at):null,years:d.years||"",months:d.months||"",days:d.days||"",hours:d.hours||"",minutes:d.minutes||""},resolver:T(K)}),{mutateAsync:b,isLoading:w}=D(o.id),E=n=>{if(Object.values(n).every(i=>!i))return null;const r=Object.entries(n).reduce((i,[c,_])=>_?{...i,[c]:Number(_)}:i,{});return z(r)},F=t.handleSubmit(async n=>{const a=P(n,["years","months","days","hours","minutes"]),r=E(a),i=n.enable_usage_limit&&!isNaN(Number(n.usage_limit))?Number(n.usage_limit):null;await b({starts_at:n.start_date,ends_at:n.end_date_enabled?n.end_date:null,usage_limit:i,valid_duration:n.enable_duration&&r?r:null},{onSuccess:()=>{g()}})});return e.jsx(j.Form,{form:t,children:e.jsxs("form",{onSubmit:F,className:"flex h-full flex-col",children:[e.jsx(j.Body,{children:e.jsxs("div",{className:"flex h-full flex-col gap-y-8",children:[e.jsx("div",{className:"flex flex-col gap-y-4",children:e.jsx(I,{size:"small",leading:"compact",className:"text-ui-fg-subtle",children:e.jsx(R,{t:l,i18nKey:"discounts.codeHint",components:[e.jsx("br",{},"break")]})})}),e.jsxs("div",{className:"flex flex-col gap-y-4",children:[e.jsx(s.Field,{control:t.control,name:"start_date_enabled",render:()=>e.jsxs(s.Item,{children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx(s.Label,{tooltip:"todo",children:l("discounts.hasStartDate")})}),e.jsx(s.Hint,{className:"!mt-1",children:l("discounts.startDateHint")}),e.jsx(s.ErrorMessage,{})]})}),e.jsx(s.Field,{control:t.control,name:"start_date",render:({field:{value:n,onChange:a,ref:r,...i}})=>e.jsxs(s.Item,{children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx(s.Control,{children:e.jsx(C,{showTimePicker:!0,value:n??void 0,onChange:c=>{a(c??null)},...i})})}),e.jsx(s.ErrorMessage,{})]})})]}),e.jsxs("div",{className:"flex flex-col gap-y-4",children:[e.jsx(s.Field,{control:t.control,name:"end_date_enabled",render:({field:{value:n,onChange:a,...r}})=>e.jsxs(s.Item,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(s.Label,{tooltip:"todo",children:l("discounts.hasEndDate")}),e.jsx(s.Control,{children:e.jsx(p,{...r,checked:n,onCheckedChange:a})})]}),e.jsx(s.Hint,{className:"!mt-1",children:l("discounts.endDateHint")}),e.jsx(s.ErrorMessage,{})]})}),t.watch("end_date_enabled")&&e.jsx(s.Field,{control:t.control,name:"end_date",render:({field:{value:n,onChange:a,ref:r,...i}})=>e.jsxs(s.Item,{children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx(s.Control,{children:e.jsx(C,{showTimePicker:!0,value:n??void 0,onChange:c=>{a(c??null)},...i})})}),e.jsx(s.ErrorMessage,{})]})})]}),e.jsxs("div",{className:"flex flex-col gap-y-4",children:[e.jsx(s.Field,{control:t.control,name:"enable_usage_limit",render:({field:n})=>e.jsxs(s.Item,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(s.Label,{tooltip:"todo",children:l("discounts.hasUsageLimit")}),e.jsx(s.Control,{children:e.jsx(s.Control,{children:e.jsx(p,{checked:!!n.value,onCheckedChange:n.onChange})})})]}),e.jsx(s.Hint,{className:"!mt-1",children:l("discounts.usageLimitHint")}),e.jsx(s.ErrorMessage,{})]})}),t.watch("enable_usage_limit")&&e.jsx(s.Field,{control:t.control,name:"usage_limit",render:({field:{value:n,onChange:a,...r}})=>e.jsxs(s.Item,{children:[e.jsx(s.Control,{children:e.jsx(h,{...r,type:"number",min:0,value:n??"",onChange:i=>{const c=i.target.value;a(c===""?null:Number(c))}})}),e.jsx(s.ErrorMessage,{})]})})]}),e.jsxs("div",{className:"flex flex-col gap-y-4",children:[e.jsx(s.Field,{control:t.control,name:"enable_duration",render:({field:n})=>e.jsxs(s.Item,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(s.Label,{tooltip:"todo",children:l("discounts.hasDurationLimit")}),e.jsx(s.Control,{children:e.jsx(s.Control,{children:e.jsx(p,{checked:!!n.value,onCheckedChange:n.onChange})})})]}),e.jsx(s.Hint,{className:"!mt-1",children:l("discounts.durationHint")}),e.jsx(s.ErrorMessage,{})]})}),t.watch("enable_duration")&&e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx(s.Field,{control:t.control,name:"years",render:({field:n})=>e.jsxs(s.Item,{className:"flex-1",children:[e.jsx(s.Label,{children:l("fields.years")}),e.jsx(s.Control,{children:e.jsx(h,{...n,type:"number",min:0,onChange:a=>{const r=a.target.value;r===""?n.onChange(null):n.onChange(Number(r))}})}),e.jsx(s.ErrorMessage,{})]})}),e.jsx(s.Field,{control:t.control,name:"months",render:({field:n})=>e.jsxs(s.Item,{className:"flex-1",children:[e.jsx(s.Label,{children:l("fields.months")}),e.jsx(s.Control,{children:e.jsx(h,{...n,type:"number",min:0,disabled:!t.watch("enable_duration"),onChange:a=>{const r=a.target.value;r===""?n.onChange(null):n.onChange(Number(r))}})}),e.jsx(s.ErrorMessage,{})]})}),e.jsx(s.Field,{control:t.control,name:"days",render:({field:n})=>e.jsxs(s.Item,{className:"flex-1",children:[e.jsx(s.Label,{children:l("fields.days")}),e.jsx(s.Control,{children:e.jsx(h,{...n,type:"number",min:0,disabled:!t.watch("enable_duration"),onChange:a=>{const r=a.target.value;r===""?n.onChange(null):n.onChange(Number(r))}})}),e.jsx(s.ErrorMessage,{})]})})]}),t.watch("enable_duration")&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(s.Field,{control:t.control,name:"hours",render:({field:n})=>e.jsxs(s.Item,{className:"flex-1",children:[e.jsx(s.Label,{children:l("fields.hours")}),e.jsx(s.Control,{children:e.jsx(h,{...n,type:"number",min:0,disabled:!t.watch("enable_duration"),onChange:a=>{const r=a.target.value;r===""?n.onChange(null):n.onChange(Number(r))}})}),e.jsx(s.ErrorMessage,{})]})}),e.jsx(s.Field,{control:t.control,name:"minutes",render:({field:n})=>e.jsxs(s.Item,{className:"flex-1",children:[e.jsx(s.Label,{children:l("fields.minutes")}),e.jsx(s.Control,{children:e.jsx(h,{...n,type:"number",min:0,disabled:!t.watch("enable_duration"),onChange:a=>{const r=a.target.value;r===""?n.onChange(null):(console.log(Number(r)),n.onChange(Number(r)))}})}),e.jsx(s.ErrorMessage,{})]})})]})]})]})}),e.jsx(j.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(j.Close,{asChild:!0,children:e.jsx(v,{size:"small",variant:"secondary",children:l("actions.cancel")})}),e.jsx(v,{size:"small",type:"submit",isLoading:w,children:l("actions.save")})]})})]})})},ge=()=>{const{id:o}=B(),{t:l}=N(),{discount:g,isLoading:d,isError:t,error:b}=L(o);if(t)throw b;return e.jsxs(j,{children:[e.jsx(j.Header,{children:e.jsx(A,{children:l("discounts.editDiscountConfiguration")})}),!d&&g&&e.jsx(U,{discount:g})]})};export{ge as Component};
