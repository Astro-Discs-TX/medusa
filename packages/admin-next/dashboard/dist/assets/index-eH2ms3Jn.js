import{j as e,d as w,T as o,u as b}from"./index-S--WvUSo.js";import{u as N,R as x}from"./route-focus-modal-MMx5Xnk0.js";import{d as z,u as _}from"./inventory-EQcmxo3i.js";import{u as S,c as I}from"./form-0PHaH8g8.js";import{C as k}from"./checkbox-8MlXzZCx.js";import{z as u}from"./index-JzuMwgWW.js";import{t as F}from"./zod-jt04JUtm.js";import{t as v}from"./toast-4oQfF9Sm.js";import{B as y}from"./button-Pc5Xo8ua.js";import{u as C}from"./stock-locations-5f5MPAbM.js";import{c as B}from"./react-router-dom-aSYyayiN.js";import{H as R}from"./heading-cSlef4Su.js";import"./react-PzSkSLoa.js";import"./react-dom-Og6--24v.js";import"./drawer-H3TI1lDZ.js";import"./index-sF0hA49A.js";import"./prompt-LzbVPZYR.js";import"./information-circle-solid-rXH6vJ5W.js";import"./label-HFq5fzpT.js";import"./tooltip-Ixyw9oT8.js";import"./index-Hm2Uj9Gg.js";import"./x-circle-solid-rnqhxvfk.js";import"./check-circle-solid-7j4QonPK.js";const T=({selected:i,onSelect:a,location:t})=>{var s,c,r;return e.jsxs("div",{className:w("flex w-full gap-x-2 rounded-lg border px-2 py-2",{"border-ui-border-interactive ":i}),onClick:()=>a(!i),children:[e.jsx("div",{className:"h-5 w-5",children:e.jsx(k,{checked:i})}),e.jsxs("div",{className:"flex w-full flex-col",children:[e.jsx(o,{size:"small",leading:"compact",weight:"plus",children:t.name}),e.jsx(o,{size:"small",leading:"compact",className:"text-ui-fg-subtle",children:[(s=t.address)==null?void 0:s.address_1,(c=t.address)==null?void 0:c.city,(r=t.address)==null?void 0:r.country_code].filter(d=>!!d).join(", ")})]})]})},A=u.object({locations:u.array(u.object({id:u.string(),location_id:u.string(),selected:u.boolean()}))}),D=(i,a)=>({locations:i.map(t=>({...t,location_id:t.id,selected:a.has(t.id)}))}),E=({item:i,locations:a})=>{var g;const t=new Set(((g=i.location_levels)==null?void 0:g.map(l=>l.location_id))??[]),{t:s}=b(),{handleSuccess:c}=N(),r=S({defaultValues:D(a,t),resolver:F(A)}),{fields:d,update:h}=I({control:r.control,name:"locations"}),{mutateAsync:f}=z(i.id),L=r.handleSubmit(async({locations:l})=>{const[p,j]=l.reduce((n,m)=>(!m.selected&&!t.has(m.location_id)||m.selected&&t.has(m.location_id)||(m.selected?n[0].push(m.location_id):n[1].push(m.location_id)),n),[[],[]]);if(p.length===0&&j.length===0)return c();try{await f({creates:p.map(n=>({location_id:n})),deletes:j}),c(),v.success(s("general.success"),{description:s("inventory.toast.update"),dismissLabel:s("actions.close")})}catch(n){v.error(s("general.error"),{description:n.message,dismissLabel:s("actions.close")})}});return e.jsx(x.Form,{form:r,children:e.jsxs("form",{onSubmit:L,className:"flex flex-1 flex-col overflow-hidden",children:[e.jsxs(x.Body,{className:"flex flex-1 flex-col gap-y-4 overflow-auto",children:[e.jsxs("div",{className:"text-ui-fg-subtle shadow-elevation-card-rest grid grid-rows-2 divide-y rounded-lg border",children:[e.jsxs("div",{className:"grid grid-cols-2 divide-x",children:[e.jsx(o,{className:"px-2 py-1.5",size:"small",leading:"compact",children:s("fields.title")}),e.jsx(o,{className:"px-2 py-1.5",size:"small",leading:"compact",children:i.title??"-"})]}),e.jsxs("div",{className:"grid grid-cols-2 divide-x",children:[e.jsx(o,{className:"px-2 py-1.5",size:"small",leading:"compact",children:s("fields.sku")}),e.jsx(o,{className:"px-2 py-1.5",size:"small",leading:"compact",children:i.sku})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(o,{size:"small",weight:"plus",leading:"compact",children:s("locations.domain")}),e.jsxs("div",{className:"text-ui-fg-subtle flex w-full justify-between",children:[e.jsx(o,{size:"small",leading:"compact",children:s("locations.selectLocations")}),e.jsxs(o,{size:"small",leading:"compact",children:["(",s("general.countOfTotalSelected",{count:d.filter(l=>l.selected).length,total:a.length}),")"]})]})]}),d.map((l,p)=>e.jsx(T,{selected:l.selected,location:l,onSelect:()=>h(p,{...l,selected:!l.selected})},l.id))]}),e.jsx(x.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(x.Close,{asChild:!0,children:e.jsx(y,{variant:"secondary",size:"small",children:s("actions.cancel")})}),e.jsx(y,{type:"submit",size:"small",isLoading:!1,children:s("actions.save")})]})})]})})},re=()=>{const{id:i}=B(),{t:a}=b(),{inventory_item:t,isPending:s,isError:c,error:r}=_(i),{stock_locations:d,isLoading:h}=C(),f=!s&&!h&&t&&d;if(c)throw r;return e.jsxs(x,{children:[e.jsx(x.Header,{children:e.jsx(R,{children:a("inventory.manageLocations")})}),f&&e.jsx(E,{item:t,locations:d})]})};export{re as Component};
