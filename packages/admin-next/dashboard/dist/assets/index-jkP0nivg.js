import{Z as $,W as q,j as e,a1 as z,u as g,T as f,aX as W,aY as Y}from"./index-S--WvUSo.js";import{s as B,h as K,i as Q,g as V,j as H,a as J}from"./stock-locations-5f5MPAbM.js";import{J as G}from"./json-view-section-Dui2O31i.js";import{r as x}from"./react-PzSkSLoa.js";import{A as y}from"./action-menu-olZwXQ3q.js";import{c as I}from"./countries-QR_y0WJ_.js";import{c as X}from"./shipping-options-YVduyG9u.js";import{f as U}from"./format-provider-yygkXOZ0.js";import{N as ee}from"./empty-table-content-i72rBIA2.js";import{L as D}from"./list-summary-5vNt7oxx.js";import{a as b,i as se}from"./shipping-options-USxwsD_1.js";import{a as C,d as ie,c as te,O as ne}from"./react-router-dom-aSYyayiN.js";import{P as ae}from"./plus-U36vXkkF.js";import{P as _}from"./pencil-square-u3fizEAQ.js";import{T as S}from"./trash-nTjeUaCp.js";import{t as d}from"./toast-4oQfF9Sm.js";import{u as O}from"./use-prompt-wB0F2CxI.js";import{H as E}from"./heading-cSlef4Su.js";import{S as re}from"./status-badge-sML89E1A.js";import{B as N}from"./button-Pc5Xo8ua.js";import{B as le}from"./badge-99FyByJO.js";import{u as oe}from"./sales-channels--fho5-f4.js";import{C as ce}from"./channels-RGu91Z80.js";import{T as pe}from"./Trans-9IhttDMi.js";import"./react-dom-Og6--24v.js";import"./drawer-H3TI1lDZ.js";import"./index-sF0hA49A.js";import"./x-mark-mini-aYDSd38M.js";import"./plus-mini-IRJECoWI.js";import"./tooltip-Ixyw9oT8.js";import"./information-circle-solid-rXH6vJ5W.js";import"./x-circle-solid-rnqhxvfk.js";import"./check-circle-solid-7j4QonPK.js";import"./prompt-LzbVPZYR.js";import"./input-A29ux7yj.js";import"./label-HFq5fzpT.js";import"./products-_PEbH1CR.js";var de=Object.defineProperty,w=Object.getOwnPropertySymbols,A=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable,k=(s,i,t)=>i in s?de(s,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[i]=t,me=(s,i)=>{for(var t in i||(i={}))A.call(i,t)&&k(s,t,i[t]);if(w)for(var t of w(i))F.call(i,t)&&k(s,t,i[t]);return s},ue=(s,i)=>{var t={};for(var n in s)A.call(s,n)&&i.indexOf(n)<0&&(t[n]=s[n]);if(s!=null&&w)for(var n of w(s))i.indexOf(n)<0&&F.call(s,n)&&(t[n]=s[n]);return t};const M=x.forwardRef((s,i)=>{var t=s,{color:n="currentColor"}=t,a=ue(t,["color"]);return x.createElement("svg",me({xmlns:"http://www.w3.org/2000/svg",width:20,height:20,fill:"none",ref:i},a),x.createElement("path",{stroke:n,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M7.5 5.625V12.5m5-5v6.875m.42 2.915 4.062-2.03a.937.937 0 0 0 .518-.84V4.018a.937.937 0 0 0-1.357-.839L12.92 4.79a.934.934 0 0 1-.838 0L7.919 2.71a.937.937 0 0 0-.838 0L3.018 4.74a.937.937 0 0 0-.518.84v10.403a.937.937 0 0 0 1.357.839L7.08 15.21a.934.934 0 0 1 .838 0l4.162 2.08a.939.939 0 0 0 .838 0v0Z"}))});M.displayName="Map";const fe=s=>({queryKey:B.detail(s),queryFn:async()=>q.stockLocations.retrieve(s,{fields:"name,*sales_channels,address.city,address.country_code,fulfillment_sets.type,fulfillment_sets.name,*fulfillment_sets.service_zones.geo_zones,*fulfillment_sets.service_zones,*fulfillment_sets.service_zones.shipping_options,*fulfillment_sets.service_zones.shipping_options.rules,*fulfillment_sets.service_zones.shipping_options.shipping_profile"})}),is=async({params:s})=>{const i=s.location_id,t=fe(i);return $.getQueryData(t.queryKey)??await $.fetchQuery(t)},xe=({location:s})=>e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"p-0",children:e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(E,{children:s.name}),e.jsx(ve,{location:s})]})}),e.jsx(P,{locationId:s.id,locationName:s.name,type:"pickup",fulfillmentSet:s.fulfillment_sets.find(i=>i.type==="pickup")}),e.jsx(P,{locationId:s.id,locationName:s.name,type:"delivery",fulfillmentSet:s.fulfillment_sets.find(i=>i.type==="delivery")})]});function Z({option:s,isReturn:i,fulfillmentSetId:t,locationId:n}){const a=O(),{t:r}=g(),c=se(s),{mutateAsync:l}=X(s.id),p=async()=>{if(await a({title:r("general.areYouSure"),description:r("shipping.shippingOptions.deleteWarning",{name:s.name}),confirmText:r("actions.delete"),cancelText:r("actions.cancel")}))try{await l(),d.success(r("general.success"),{description:r("shipping.shippingOptions.toast.delete",{name:s.name}),dismissLabel:r("actions.close")})}catch(u){d.error(r("general.error"),{description:u.message,dismissLabel:r("actions.close")})}};return e.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("span",{className:"txt-small font-medium",children:[s.name," - ",s.shipping_profile.name," (",U(s.provider_id),")"]})}),c&&e.jsx(le,{className:"mr-4",color:"purple",children:r("shipping.shippingOptions.inStore")}),e.jsx(y,{groups:[{actions:[{icon:e.jsx(_,{}),label:r("shipping.serviceZone.editOption"),to:`/settings/shipping/${n}/fulfillment-set/${t}/service-zone/${s.service_zone_id}/shipping-option/${s.id}/edit`},{label:r("shipping.serviceZone.editPrices"),icon:e.jsx(Y,{}),disabled:!0},{label:r("actions.delete"),icon:e.jsx(S,{}),onClick:p}]}]})]})}function ge({zone:s,locationId:i,fulfillmentSetId:t}){const{t:n}=g(),a=C(),r=s.shipping_options.filter(l=>!b(l)),c=s.shipping_options.filter(l=>b(l));return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-4 flex flex-col border-t border-dashed px-6 py-4",children:[e.jsxs("div",{className:"item-center flex justify-between",children:[e.jsx("span",{className:"text-ui-fg-subtle txt-small self-center font-medium",children:n("shipping.serviceZone.shippingOptions")}),e.jsx(N,{className:"text-ui-fg-interactive txt-small px-0 font-medium hover:bg-transparent",variant:"transparent",onClick:()=>a(`/settings/shipping/${i}/fulfillment-set/${t}/service-zone/${s.id}/shipping-option/create`),children:n("shipping.serviceZone.addOption")})]}),!!r.length&&e.jsx("div",{className:"shadow-elevation-card-rest bg-ui-bg-subtle mt-4 grid divide-y rounded-md",children:r.map(l=>e.jsx(Z,{option:l,locationId:i,fulfillmentSetId:t},l.id))})]}),e.jsxs("div",{className:"-mb-4 flex flex-col border-t border-dashed px-6 py-4",children:[e.jsxs("div",{className:"item-center flex justify-between",children:[e.jsx("span",{className:"text-ui-fg-subtle txt-small self-center font-medium",children:n("shipping.serviceZone.returnOptions")}),e.jsx(N,{className:"text-ui-fg-interactive txt-small px-0 font-medium hover:bg-transparent",variant:"transparent",onClick:()=>a(`/settings/shipping/${i}/fulfillment-set/${t}/service-zone/${s.id}/shipping-option/create?is_return`),children:n("shipping.serviceZone.addOption")})]}),!!c.length&&e.jsx("div",{className:"shadow-elevation-card-rest bg-ui-bg-subtle mt-4 grid divide-y rounded-md",children:c.map(l=>e.jsx(Z,{isReturn:!0,option:l,locationId:i,fulfillmentSetId:t},l.id))})]})]})}function he({zone:s,locationId:i,fulfillmentSetId:t}){const{t:n}=g(),a=O(),[r,c]=x.useState(!1),{mutateAsync:l}=H(t,s.id),p=async()=>{if(await a({title:n("general.areYouSure"),description:n("shipping.serviceZone.deleteWarning",{name:s.name}),confirmText:n("actions.delete"),cancelText:n("actions.cancel")}))try{await l(),d.success(n("general.success"),{description:n("shipping.serviceZone.toast.delete",{name:s.name}),dismissLabel:n("actions.close")})}catch(m){d.error(n("general.error"),{description:m.message,dismissLabel:n("actions.close")})}},h=x.useMemo(()=>s.geo_zones.filter(o=>o.type==="country").map(o=>o.country_code).map(o=>I.find(m=>m.iso_2===o)),s.geo_zones),[u,L]=x.useMemo(()=>{const o=s.shipping_options.filter(v=>!b(v)).length,m=s.shipping_options.filter(v=>b(v)).length;return[o,m]},[s.shipping_options]);return e.jsxs("div",{className:"py-4",children:[e.jsxs("div",{className:"flex flex-row items-center justify-between gap-x-4 px-6",children:[e.jsx("div",{className:"grow-0 rounded-lg border",children:e.jsx("div",{className:"bg-ui-bg-field m-1 rounded-md p-2",children:e.jsx(M,{className:"text-ui-fg-subtle"})})}),e.jsxs("div",{className:"grow-1 flex flex-1 flex-col",children:[e.jsx(f,{weight:"plus",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{list:h.map(o=>o.display_name),inline:!0,n:1}),e.jsx("span",{children:"·"}),e.jsxs(f,{className:"text-ui-fg-subtle txt-small",children:[u," ",n("shipping.serviceZone.optionsLength",{count:u})]}),e.jsx("span",{children:"·"}),e.jsxs(f,{className:"text-ui-fg-subtle txt-small",children:[L," ",n("shipping.serviceZone.returnOptionsLength",{count:L})]})]})]}),e.jsxs("div",{className:"itemx-center flex grow-0 gap-1",children:[e.jsx(N,{onClick:()=>c(o=>!o),className:"flex items-center justify-center",variant:"transparent",style:{transform:`translateY(${r?-2:-4}px)`,transition:".1s transform ease-in-out"},children:e.jsx(W,{style:{transform:`rotate(${r?180:0}deg)`,transition:".2s transform ease-in-out"}})}),e.jsx(y,{groups:[{actions:[{label:n("actions.edit"),icon:e.jsx(_,{}),to:`/settings/shipping/${i}/fulfillment-set/${t}/service-zone/${s.id}/edit`},{label:n("actions.delete"),icon:e.jsx(S,{}),onClick:p}]}]})]})]}),r&&e.jsx("div",{children:e.jsx(ge,{fulfillmentSetId:t,locationId:i,zone:s})})]})}function P(s){const{t:i}=g(),t=O(),n=C(),{fulfillmentSet:a,locationName:r,locationId:c,type:l}=s,p=!!a,h=!!(a!=null&&a.service_zones.length),{mutateAsync:u,isPending:L}=K(c),{mutateAsync:o}=Q(a==null?void 0:a.id),m=async()=>{try{await u({name:`${r} ${l==="pickup"?"pick up":l}`,type:l})}catch(j){d.error(i("general.error"),{description:j.message,dismissLabel:i("actions.close")})}},v=async()=>{if(await t({title:i("general.areYouSure"),description:i("shipping.fulfillmentSet.disableWarning",{name:a==null?void 0:a.name}),confirmText:i("actions.delete"),cancelText:i("actions.cancel")}))try{await o(),d.success(i("general.success"),{description:i("shipping.fulfillmentSet.toast.disable",{name:a==null?void 0:a.name}),dismissLabel:i("actions.close")})}catch(R){d.error(i("general.error"),{description:R.message,dismissLabel:i("actions.close")})}};return e.jsx(z,{className:"p-0",children:e.jsxs("div",{className:"flex flex-col divide-y",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(f,{size:"large",weight:"plus",className:"flex-1",as:"div",children:i(`shipping.fulfillmentSet.${l}.offers`)}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(re,{color:p?"green":"red",children:i(p?"statuses.enabled":"statuses.disabled")}),e.jsx(y,{groups:[{actions:[{icon:e.jsx(ae,{}),label:i("shipping.fulfillmentSet.addZone"),onClick:()=>n(`/settings/shipping/${c}/fulfillment-set/${a.id}/service-zones/create`),disabled:!p},{icon:e.jsx(_,{}),label:i(p?"actions.disable":"actions.enable"),onClick:p?v:m}]}]})]})]}),p&&!h&&e.jsxs("div",{className:"text-ui-fg-muted txt-medium flex flex-col items-center justify-center gap-y-4 py-8",children:[e.jsx(ee,{message:i("shipping.fulfillmentSet.placeholder"),className:"h-fit"}),e.jsx(N,{variant:"secondary",onClick:()=>n(`/settings/shipping/${c}/fulfillment-set/${a.id}/service-zones/create`),children:i("shipping.fulfillmentSet.addZone")})]}),h&&e.jsx("div",{className:"flex flex-col divide-y",children:a==null?void 0:a.service_zones.map(j=>e.jsx(he,{zone:j,locationId:c,fulfillmentSetId:a.id},j.id))})]})})}const ve=({location:s})=>{const i=C(),{t}=g(),{mutateAsync:n}=V(s.id),a=O(),r=async()=>{if(await a({title:t("general.areYouSure"),description:t("shipping.deleteLocationWarning",{name:s.name}),verificationText:s.name,verificationInstruction:t("general.typeToConfirm"),confirmText:t("actions.delete"),cancelText:t("actions.cancel")})){try{await n(void 0),d.success(t("general.success"),{description:t("shipping.toast.delete"),dismissLabel:t("actions.close")})}catch(l){d.error(t("general.error"),{description:l.message,dismissLabel:t("actions.close")})}i("/settings/shipping",{replace:!0})}};return e.jsx(y,{groups:[{actions:[{icon:e.jsx(_,{}),label:t("actions.edit"),to:"edit"}]},{actions:[{icon:e.jsx(S,{}),label:t("actions.delete"),onClick:r}]}]})};function T({location:s}){var a;const{t:i}=g(),{count:t}=oe(),n=!((a=s.sales_channels)!=null&&a.length);return e.jsxs("div",{className:"shadow-elevation-card-rest bg-ui-bg-base rounded-md p-4",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx(E,{level:"h2",children:i("shipping.salesChannels.title")}),e.jsx(y,{groups:[{actions:[{label:i("actions.edit"),to:"sales-channels/edit",icon:e.jsx(_,{})}]}]})]}),e.jsxs("div",{className:"grid grid-cols-[28px_1fr] items-center gap-x-3",children:[e.jsx("div",{className:"bg-ui-bg-base shadow-borders-base flex size-7 items-center justify-center rounded-md",children:e.jsx("div",{className:"bg-ui-bg-component flex size-6 items-center justify-center rounded-[4px]",children:e.jsx(ce,{className:"text-ui-fg-subtle"})})}),n?e.jsx(f,{size:"small",leading:"compact",className:"text-ui-fg-subtle",children:i("shipping.salesChannels.placeholder")}):e.jsx(D,{n:3,inline:!0,list:s.sales_channels.map(r=>r.name)})]}),e.jsx(f,{className:"text-ui-fg-subtle mt-4",size:"small",leading:"compact",children:e.jsx(pe,{i18nKey:"sales_channels.availableIn",values:{x:s.sales_channels.length,y:t},components:[e.jsx("span",{className:"text-ui-fg-base txt-compact-medium-plus"},"x"),e.jsx("span",{className:"text-ui-fg-base txt-compact-medium-plus"},"y")]})})]})}const ts=()=>{const s=ie(),{location_id:i}=te(),{stock_location:t,isPending:n,isError:a,error:r}=J(i,{fields:"name,*sales_channels,address.city,address.country_code,fulfillment_sets.type,fulfillment_sets.name,*fulfillment_sets.service_zones.geo_zones,*fulfillment_sets.service_zones,*fulfillment_sets.service_zones.shipping_options,*fulfillment_sets.service_zones.shipping_options.rules,*fulfillment_sets.service_zones.shipping_options.shipping_profile"},{initialData:s});if(n||!t)return e.jsx("div",{children:"Loading..."});if(a)throw r;return e.jsxs("div",{className:"flex flex-col gap-x-4 xl:flex-row xl:items-start",children:[e.jsxs("div",{className:"flex w-full flex-col gap-y-2",children:[e.jsx(xe,{location:t}),e.jsx("div",{className:"flex w-full flex-col gap-y-2 xl:hidden",children:e.jsx(T,{location:t})}),e.jsx(G,{data:t})]}),e.jsx("div",{className:"hidden w-full max-w-[400px] flex-col gap-y-2 xl:flex",children:e.jsx(T,{location:t})}),e.jsx(ne,{})]})};export{ts as Component,is as loader};
