export const metadata = {
  title: `${pageNumber} Brand Example: 2. Create Workflow`,
}

# {metadata.title}

The second step of creating the brand example is to define the workflow that's used to create a brand.

Workflows are useful to implement roll-back mechanisms to avoid data inconsistency when an error occurs.

## Create Workflow

Create the file `src/workflows/create-brand/index.ts` with the following content:

```ts
import {
  createWorkflow,
  WorkflowResponse
} from "@medusajs/workflows-sdk"

export type CreateBrandInput = {
  name: string
}

export const createBrandWorkflow = createWorkflow(
  "create-brand",
  (input: CreateBrandInput) => {
    // TODO
  }
)
```

For now, this workflow only defines its input. You'll create its step and use it in the workflow.

---

## Create Step

Create the file `src/workflows/create-brand/steps/create-brand.ts` with the following content:

```ts title="src/workflows/create-brand/steps/create-brand.ts"
import {
  createStep,
  StepResponse
} from "@medusajs/workflows-sdk"
import { CreateBrandInput } from ".."
import { BRAND_MODULE } from "../../../modules/brand"
import BrandModuleService from "../../../modules/brand/service"

export const createBrandStep = createStep(
  "create-brand-step",
  async (input: CreateBrandInput, { container }) => {
    const brandModuleService: BrandModuleService = container.resolve(
      BRAND_MODULE
    )

    const brand = await brandModuleService.createBrands(input)

    return new StepResponse(brand, brand.id)
  }
)
```

This defines a `createBrandStep`. In the step, you resolve the Brand Module's main service and use its generated `createBrands` method, which accepts one or more brands to create.

The step returns the created brand in the first parameter of the `StepResponse`'s constructor.

### Add Compensation Function to Step

The second parameter passed to the `StepResponse`'s constructor is passed to a compensation function. A compensation function rolls back changes made by the step.

To add the compensation function, pass a third parameter to `createStep`:

```ts title="src/workflows/create-brand/steps/create-brand.ts"
export const createBrandStep = createStep(
  // ...
  async (id: string, { container }) => {
    const brandModuleService: BrandModuleService = container.resolve(
      BRAND_MODULE
    )

    await brandModuleService.deleteBrands(id)
  }
)
```

The compensation function resolves the Brand Module's main service and uses its generated `deleteBrands` method to delete the brand created by the step. The `deleteBrands` method accepts an ID or an array of IDs of brands to delete.

So, when an error occurs during the workflow, the brand that was created by the step is deleted to maintain data consistency.

---

## Add Step to Workflow

Go back to the workflow at `src/workflows/create-brand/index.ts` and import the step you created:

```ts
import { createBrandStep } from "./steps/create-brand"
```

Then, replace the `TODO` with the following:

```ts
const brand = createBrandStep(input)

return new WorkflowResponse(brand)
```

You use the `createBrandStep` to create the brand and return it in the workflow's response.

---

## Next Steps

In the next step, you'll create an API route that exposes the workflow's functionality to admin users.
