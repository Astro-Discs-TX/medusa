import { CodeTabs, CodeTab } from "docs-ui"

export const metadata = {
  title: `Checkout Step 1: Enter Email`,
}

# {metadata.title}

The first step of the checkout process is to enter the customer's email. Then, use the [Update Cart API route](!api!/store#carts_postcartsid) to update the cart with the email.

<Note title="Tip">

If the customer is logged-in, you can pre-fill the email with the customer's email and skip this step.

</Note>

For example:

<CodeTabs group="store-request">
  <CodeTab label="Fetch API" value="fetch">

  ```ts
  fetch(`http://localhost:9000/store/regions`, {
    credentials: "include"
  })
  .then((res) => res.json())
  .then(({ regions }) => {
    // use regions...
    console.log(regions)
  })
  ```

  </CodeTab>
  <CodeTab label="React" value="react">

export const highlights = [
  ["18", "cartId", "Retrieve the cart's ID from `localStorage`."],
  ["20", "TODO", "Redirect your storefront to another page, such as the home page."],
  ["24", "fetch", "Retrieve the cart's details."],
  ["17"], ["18"], ["19"], ["20"], ["21"], ["22"], ["23"], ["24"]
]

  ```tsx highlights={highlights}
  "use client" // include with Next.js 13+

  import { useEffect, useState } from "react"
  import { HttpTypes } from "@medusajs/types"

  export default function CheckoutEmailStep () {
    const [cart, setCart] = useState<
      HttpTypes.StoreCart
    >()
    const [email, setEmail] = useState("")
    const [loading, setLoading] = useState(false)

    useEffect(() => {
      if (cart) {
        return
      }

      const cartId = localStorage.getItem("cart_id")
      if (!cartId) {
        // TODO redirect to another page
        return
      }

      fetch(`http://localhost:9000/store/carts/${cartId}`, {
        credentials: "include"
      })
      .then((res) => res.json())
      .then(({ cart: dataCart }) => {
        setCart(dataCart)
        if (dataCart.email) {
          setEmail(dataCart.email)
        }
      })
    }, [cart])

    const updateCartEmail = (
      e: React.MouseEvent<HTMLButtonElement, MouseEvent>
    ) => {
      if (!cart || !email.length) {
        return
      }

      e.preventDefault()
      setLoading(true)

      fetch(`http://localhost:9000/store/carts/${cart.id}`, {
        credentials: "include",
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          email
        })
      })
      .then((res) => res.json())
      .then(({ cart: updatedCart }) => {
        setCart(updatedCart)
      })
      .finally(() => setLoading(false))
    }

    return (
      <div>
        {!cart && <span>Loading...</span>}
        <input 
          type="email" 
          placeholder="Email" 
          value={email} 
          disabled={!cart}
          onChange={(e) => setEmail(e.target.value)}
        />
        <button
          disabled={!cart || !email || loading}
          onClick={updateCartEmail}
        >
          Set Email
        </button>
      </div>
    )
  }
  ```

  </CodeTab>
</CodeTabs>

{/* TODO add a link to regions object in API reference (once available). */}

The response has a `regions` field, which is an array of regions.
