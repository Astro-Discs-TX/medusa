---
tags:
  - customer
  - storefront
  - auth
---

import { CodeTabs, CodeTab } from "docs-ui"

export const metadata = {
  title: `Register Customer in Storefront`,
}

# {metadata.title}

In this guide, you'll learn how to register a customer in your storefront.

This guide covers registration using email and password. For authentication with third-party providers, refer to the [Third-Party Login](../third-party-login/page.mdx) guide.

## Register Customer Flow

To register a customer, you implement the following steps:

![A diagram illustrating the flow of the register customer flow](https://res.cloudinary.com/dza7lstvk/image/upload/v1743086184/Medusa%20Resources/register-flow_yv5uw2.jpg)

1. Show the customer a form to enter their details.
2. Send a `POST` request to the `/auth/customer/emailpass/register` API route to obtain a registration JWT token.
3. Send a request to the [Create Customer API route](!api!/store#customers_postcustomers) passing the registration JWT token in the header.

However, a customer may enter an email that's already used either by an admin user, another customer, or a [custom actor type](../../../commerce-modules/auth/auth-identity-and-actor-types/page.mdx). To handle this scenario:

- Try to obtain a login token by sending a `POST` request to the `/auth/customer/emailpass` API route. The customer is only allowed to register if their email and password match the existing identity. This allows admin users to log in or register as customers.
- If you obtained the login token successfully, create the customer using the login JWT token instead of the registration token. This will not remove the existing identity. So, for example, an admin user can also become a customer.

---

## How to Implement the Register Customer Flow

An example implemetation of the registration flow in a storefront:

<Note title="Tip">

Learn how to install and configure the JS SDK in the [JS SDK documentation](../../../js-sdk/page.mdx).

</Note>

<CodeTabs group="store-request">
  <CodeTab label="React" value="react">

export const highlights = [
  ["26", "register", "Send a request to obtain a registration JWT token."],
  ["30", "catch", "Maybe another identity exists with the same email."],
  ["33", "", "If an unexpected error occurs, exit the flow."],
  ["40", "login", "Try to obtain a login JWT token."],
  ["43", "catch", "The existing account belongs to another customer, so authentication failed."],
  ["56", "registrationToken", "Set the token to the login JWT token"],
  ["59", "setToken", "Set the token in the JS SDK to pass it in the header of subsequent requests."],
  ["63", "create", "Send a request to create the customer."],
  ["72", "clearToken", "Clear the token in the JS SDK so that it's not used in subsequent requests."],
  ["75", "TODO", "Redirect the customer to the log in page."],
  ["76", "catch", "Handle registration failure"],
]

  ```tsx highlights={highlights} collapsibleLines="83-121" expandButtonLabel="Show form"
  "use client" // include with Next.js 13+

  import { useState } from "react"
  import { sdk } from "@/lib/sdk"
  import { FetchError } from "@medusajs/js-sdk"

  export default function Register() {
    const [loading, setLoading] = useState(false)
    const [firstName, setFirstName] = useState("")
    const [lastName, setLastName] = useState("")
    const [email, setEmail] = useState("")
    const [password, setPassword] = useState("")

    const handleRegistration = async (
      e: React.MouseEvent<HTMLButtonElement, MouseEvent>
    ) => {
      e.preventDefault()
      if (!firstName || !lastName || !email || !password) {
        return
      }
      setLoading(true)

      let registrationToken = ""

      try {
        registrationToken = await sdk.auth.register("customer", "emailpass", {
          email,
          password,
        })
      } catch (error) {
        const fetchError = error as FetchError
        
        if (fetchError.statusText !== "Unauthorized" || fetchError.message !== "Identity with email already exists") {
          alert(`An error occured while creating account: ${fetchError}`)
          return
        }
        // another identity (for example, admin user)
        // exists with the same email. So, use the auth
        // flow to login and create a customer.
        const loginResponse = (await sdk.auth.login("customer", "emailpass", {
          email,
          password,
        }).catch((e) => {
          alert(`An error occured while creating account: ${e}`)
        }))

        if (!loginResponse) {
          return
        }

        if (typeof loginResponse !== "string") {
          alert("Authentication requires more actions, which isn't supported by this flow.")
          return
        }

        registrationToken = loginResponse
      }

      sdk.client.setToken(registrationToken)

      // create customer
      try {
        const { customer } = await sdk.store.customer.create({
          first_name: firstName,
          last_name: lastName,
          email,
        })
    
        setLoading(false)

        // clear the token
        sdk.client.clearToken()

        console.log(customer)
        // TODO redirect to login page
      } catch (error) {
        console.error(error)
        alert("Error: " + error)
        return
      }
    }

    return (
      <form>
        <input 
          type="text" 
          name="first_name"
          value={firstName}
          placeholder="First Name"
          onChange={(e) => setFirstName(e.target.value)}
        />
        <input 
          type="text" 
          name="last_name"
          value={lastName}
          placeholder="Last Name"
          onChange={(e) => setLastName(e.target.value)}
        />
        <input 
          type="email" 
          name="email"
          value={email}
          placeholder="Email"
          onChange={(e) => setEmail(e.target.value)}
        />
        <input 
          type="password" 
          name="password"
          value={password}
          placeholder="Password"
          onChange={(e) => setPassword(e.target.value)}
        />
        <button
          disabled={loading}
          onClick={handleRegistration}
        >
          Register
        </button>
      </form>
    )
  }
  ```

  </CodeTab>
  <CodeTab label="JS SDK" value="js-sdk">

export const fetchHighlights = [
  ["10", "register", "Send a request to obtain a registration JWT token."],
  ["14", "catch", "Maybe another identity exists with the same email."],
  ["24", "login", "Try to obtain a login JWT token."],
  ["27", "catch", "The existing account belongs to another customer, so authentication failed."],
  ["40", "registrationToken", "Set the token to the login JWT token"],
  ["43", "setToken", "Set the token in the JS SDK to pass it in the header of subsequent requests."],
  ["47", "create", "Send a request to create the customer."],
  ["54", "clearToken", "Clear the token in the JS SDK so that it's not used in subsequent requests."],
  ["57", "TODO", "Redirect the customer to the log in page."],
  ["58", "catch", "Handle registration failure"],
]

  ```ts highlights={fetchHighlights}
  // other imports...
  import { FetchError } from "@medusajs/js-sdk"

  const handleRegistration = async () => {

    let registrationToken = ""

    // obtain registration JWT token
    try {
      registrationToken = await sdk.auth.register("customer", "emailpass", {
        email,
        password,
      })
    } catch (error) {
      const fetchError = error as FetchError
      
      if (fetchError.statusText !== "Unauthorized" || fetchError.message !== "Identity with email already exists") {
        alert(`An error occured while creating account: ${fetchError}`)
        return
      }
      // another identity (for example, admin user)
      // exists with the same email. So, use the auth
      // flow to login and create a customer.
      const loginResponse = (await sdk.auth.login("customer", "emailpass", {
        email,
        password,
      }).catch((e) => {
        alert(`An error occured while creating account: ${e}`)
      }))

      if (!loginResponse) {
        return
      }

      if (typeof loginResponse !== "string") {
        alert("Authentication requires more actions, which isn't supported by this flow.")
        return
      }

      registrationToken = loginResponse
    }

    sdk.client.setToken(registrationToken)

    // create customer
    try {
      const { customer } = await sdk.store.customer.create({
        first_name: firstName,
        last_name: lastName,
        email,
      })

      // clear the token
      sdk.client.clearToken()

      console.log(customer)
      // TODO redirect to login page
    } catch (error) {
      console.error(error)
      alert("Error: " + error)
      return
    }
  }
  ```

  </CodeTab>
</CodeTabs>

In the above example, you create a `handleRegistration` function that:

- Obtains a registration JWT token from the `/auth/customer/emailpass/register` API route.
- If an error is thrown:
    - If the error is an existing identity error, try retrieving the login JWT token from `/auth/customer/emailpass` API route. This will fail if the existing identity has a different password, which doesn't allow the customer from registering.
    - For other errors, show an alert and exit execution.
- In the JS SDK, set the registration or login token using the `client.setToken` method. Then, all subsequent requests will use that token in the request header.
    - If you're not using the JS SDK, you must pass manually pass the registration or login JWT token as a Bearer token in the authorization header of the next request.
- Send a request to the [Create Customer API route](!api!/store#customers_postcustomers) to create the customer in Medusa.
    - If an error occurs, show an alert and exit execution.
- Once the customer is registered successfully, you can either redirect the customer to the login page or log them in automatically.
    - Make sure to clear the token in the JS SDK using the `client.clearToken` method so that it's not used in subsequent requests.

Refer to the [Login guide](../login/page.mdx) to learn how to log in the customer manually or automatically.
